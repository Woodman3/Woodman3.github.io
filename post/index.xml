<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on 木头人的小木屋</title><link>https://woodman3.github.io/post/</link><description>Recent content in Posts on 木头人的小木屋</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 30 Sep 2025 14:37:44 +0800</lastBuildDate><atom:link href="https://woodman3.github.io/post/index.xml" rel="self" type="application/rss+xml"/><item><title>备忘录：使用pprof 分析cpp程序</title><link>https://woodman3.github.io/p/%E5%A4%87%E5%BF%98%E5%BD%95%E4%BD%BF%E7%94%A8pprof-%E5%88%86%E6%9E%90cpp%E7%A8%8B%E5%BA%8F/</link><pubDate>Tue, 30 Sep 2025 14:37:44 +0800</pubDate><guid>https://woodman3.github.io/p/%E5%A4%87%E5%BF%98%E5%BD%95%E4%BD%BF%E7%94%A8pprof-%E5%88%86%E6%9E%90cpp%E7%A8%8B%E5%BA%8F/</guid><description>&lt;img src="https://woodman3.github.io/p/%E5%A4%87%E5%BF%98%E5%BD%95%E4%BD%BF%E7%94%A8pprof-%E5%88%86%E6%9E%90cpp%E7%A8%8B%E5%BA%8F/G2tOID9aoAAq-wu.jpg" alt="Featured image of post 备忘录：使用pprof 分析cpp程序" /&gt;&lt;h2 id="gperftools"&gt;gperftools
&lt;/h2&gt;&lt;p&gt;如果是用的ubuntu，可以直接使用apt来安装 &lt;code&gt;libgoogle-perftools-dev&lt;/code&gt;，包管理器会自动安装好unwind和graphiz，但是并不会安装pprof。&lt;/p&gt;
&lt;p&gt;在链接选项里加上&lt;code&gt;-lprofiler&lt;/code&gt;，但是如果代码里没用上&lt;code&gt;libprofiler.so&lt;/code&gt;里的东西的话实际产物是不会链接这个库的，所以你还许要加一个&lt;code&gt;-Wl,--no-as-needed&lt;/code&gt;来强制链接。&lt;/p&gt;
&lt;p&gt;运行前要设置一个环境变量&lt;code&gt;CPUPROFILE=./profile ./myprogram&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="pprof"&gt;pprof
&lt;/h2&gt;&lt;p&gt;pprof是go里的工具，所以你还需要把go装上才能用。哪怕你手动编译安装gperftool也没有。apt里的go版本太老，得自己去官网下载安装并设置对应的环境变量，在此不多说。&lt;/p&gt;
&lt;p&gt;go直接装包大概率会因为连不上github而装不上，可以配置goproxy的值来更改下载的地方，这个proxy类似镜像站。&lt;/p&gt;
&lt;p&gt;下载后的pprof在&lt;code&gt;~/go/bin&lt;/code&gt;下。&lt;/p&gt;
&lt;p&gt;使用&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;pprof --pdf a.out test.prof &amp;gt; test.pdf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;来生成分析的pdf报告。&lt;/p&gt;</description></item><item><title>我与dota2的十一年</title><link>https://woodman3.github.io/p/%E6%88%91%E4%B8%8Edota2%E7%9A%84%E5%8D%81%E4%B8%80%E5%B9%B4/</link><pubDate>Tue, 23 Sep 2025 22:12:40 +0800</pubDate><guid>https://woodman3.github.io/p/%E6%88%91%E4%B8%8Edota2%E7%9A%84%E5%8D%81%E4%B8%80%E5%B9%B4/</guid><description>&lt;img src="https://woodman3.github.io/p/%E6%88%91%E4%B8%8Edota2%E7%9A%84%E5%8D%81%E4%B8%80%E5%B9%B4/IMG_8356.png" alt="Featured image of post 我与dota2的十一年" /&gt;&lt;h2 id="引"&gt;引
&lt;/h2&gt;&lt;p&gt;ti14在前几天结束了，忽然间发现距离我第一次开始玩dota2这个游戏已经过去了快十一年，而上一次玩也已经是三年前了，有感而写。&lt;/p&gt;
&lt;h2 id="缘起"&gt;缘起
&lt;/h2&gt;&lt;p&gt;在我上小学的时候，周围的人大多在玩lol，可是lol需要实名认证，我的qq很早就绑定了我自己的身份证号，这直接导致了我玩不了lol。玩不了lol这件事给还在上小学时候的我上了朴素的一课：人不能太老实。我懒得注册小号，而qq又不能改身份证，所以很长一段时间我都在听同班的同学们讨论lol的打法，而我在一边只能看着。&lt;/p&gt;
&lt;p&gt;但是天无绝人之路，一个偶然的机会，我知道了世界上还有一个游戏叫dota2（后文简称dota），而且还比lol难，可以玩到比他们难的游戏让我有种小众的优越感，而且dota允许未成年人游玩，只是3小时后收益减半，5小时候收益归零而且不能继续玩，这倒是无所谓，因为dota的英雄不用买，而饰品又得花真金白银，这使得收益显得无可厚非。&lt;/p&gt;
&lt;p&gt;dota确实有些难，在新手教程时的反补甚至没有键位提示，我去百度搜才知道得按a键才能反补。通过新手教程后我兴奋的去开了一把匹配，然后毫不意外的被血虐了，玻璃心的我在游戏还没结束就被队友骂退了。那一夜我思索良久，决定还是从人机打起，在后面我断断续续的打了五十多把人机，才敢再次开始匹配。&lt;/p&gt;
&lt;p&gt;有了一些人机的经验后，打匹配多少也不至于被喷了，这时候dota的乐趣也显现出来了，长时间的对局和高强度的博弈，都让我彻底沉迷进这个游戏中。&lt;/p&gt;
&lt;h2 id="安利"&gt;安利
&lt;/h2&gt;&lt;p&gt;但是一个人打dota还是有些寂寞，于是我试图把这个游戏安利给我的一些朋友，但是我的朋友也在给我安利lol，我说我的qq号玩不了，“那你为什么不开小号呢？你不愿意接触我们玩的游戏，那我们又为什么要接触你的游戏呢？”。于是我注册了个小号去陪他们玩了几把lol，那几把lol也是我到现在为止打过的少数几把lol，lol这种英雄需要时间去挣金币来买，每周免费英雄轮换的机制也十分讨厌。我买的第一个英雄是大虫子，因为我在一个活动中抽到了他的皮肤。&lt;/p&gt;
&lt;p&gt;作为交换，我成功的把我的两个朋友拉过来打了dota，这两个朋友也是我到现在为止唯二成功安利成功的人。他们陪我打了很长一段时间。组成了我初中生涯的大部分游戏生活，后来上了高中，开始了寄宿生活后，打dota的时间就变少了，上大学后就几乎没打过了。&lt;/p&gt;
&lt;h2 id="一些回忆"&gt;一些回忆
&lt;/h2&gt;&lt;p&gt;小时候的电脑是老爸在电脑城配的垃圾电脑，四五千的价格连个独显都没有，intel的核显打起dota来连不仅所有特效都得关，分辨率调低，连渲染率都要调到一个比较低的挡位。后来我自己在淘宝上买了个独显，才勉强在一个说得过去的画面下顺利游玩。在我上考上高中后，买了我的第一台笔记本电脑，买的时候没注意显卡，买了1050ti显卡的笔记本，显存我记得只有6g。但是这个配置已经可以在1080p的分辨率下有一个不错的画面了。但是高中玩的少了。后来上了大学换了更好的电脑，虽然下载了dota2，但是再也没怎么玩过了。&lt;/p&gt;
&lt;p&gt;虽然我们一开始打的是国服，但是完美的服务器说不上是多好，掉线的情况时常发生，dota有暂停的好处也就显现了出来，有时候有人掉线，一般都会有人赞同，然后公屏打字：“2min”，意味等一会。但是一般等待的时间都不止两分钟。有时候这两分钟双方都会放下游戏里的爱恨，一起愉快的聊天，比如编造掉线的人要去晾衣服这种。现在想想，三个初中的孩子和一群老登在游戏聊这些家常，还挺有意思的。&lt;/p&gt;
&lt;p&gt;没换起源2引擎之前，十个人总是得在一个河道界面等四五分钟时间，如果太长就得重新匹配，而那个没连进去的人就有几分钟的不能匹配惩罚。有时候等的时间比较长，一群人就会在那个界面聊天。后来换了起源引擎，游戏匹配上后几乎秒进，第一次秒进的时候惊到了我，事实证明底层代码还是可以更新的。&lt;/p&gt;
&lt;p&gt;最深刻的一场对局是一次二打四，那时比赛打到二十分钟的时候我们非常劣势，然后我断线了，好不容易重连回来发现我的一个朋友和另外两个路人也退了，对面也退了一个。我是蓝猫，另一个朋友是火猫。我们两个继续打了下去，打的时候我开玩笑的说，这把打赢了我们可以吹一年，我们确实赢了。蓝猫有控火猫有输出，我们成功推下了对面。这局没有吹一年，我一直吹到了现在。&lt;/p&gt;
&lt;p&gt;dota的英雄太多了，所以一开始的时候我都不知道玩啥，恰好游戏里有一个全英雄挑战，我就把每一个英雄都玩了一遍，有些英雄我连跪了五六把才能赢一把，有些英雄玩着难而且不好玩，这个挑战也让我找到了自己喜欢的英雄，和一些赖皮的玩法。&lt;/p&gt;
&lt;p&gt;我开始注册max的账号，开始接触steam，折腾饰品和余额，一开始在steam的市场上卖饰品，后来发现可以通过max来购买饰品，那时候饰品市场还没那么繁荣。但是菠菜已经有了，我也会通过max的app来看看盘口。想不到我初中就接触了菠菜，但是那时我没有自己的手机，更没啥钱，所以几乎没怎么碰过。max上可以看自己对局的质量，我的对局都是normal，只有一局high，还是玩船长连跪六把打的high局，我也不知道为什么连跪六把能上high局。我玩的很菜，不到一千分的天梯水平，但是玩的很快乐。&lt;/p&gt;
&lt;p&gt;max社区后面也做大做强了，演变成了今天的小黑盒，变为了学生中最流行的游戏社区。而dota只是这个庞大社区中小小的一部分，音量甚至不如lol，而我也不再是学生了。&lt;/p&gt;
&lt;h2 id="ti"&gt;TI
&lt;/h2&gt;&lt;p&gt;ti是dota最大的比赛，也是我接触的第一个电子竞技比赛，那时ti最值得一提的就是那高的惊人的奖金池了，那时我可喜欢和lol的玩家说我们比赛的奖金比你们的高多了，lol的高管则在一篇报道中痛斥这种向玩家祈祷的行为他们是不会采用的。那时还流传着“cn dota,best dota&amp;quot;的神话，玩家们相信自己给v社氪的金都能被自己国家的选手们赢回来，因此也会有更强的氪金意愿。这么多年过去了，cn data的神话已经再也没人提了，奖金池也再也没人关心，电子竞技挣钱的大头也不再是玩家和厂商们的奖金池，而是各个商家的赞助和渠道的收入，这点倒是和传统体育赛事很像。打开b站上的电竞比赛永远都有着xx产商的赞助，或者xx选手的传闻。时代变了很多，但是ti还是那个样子，没有乱七八糟赞助广告，没有独家的观赛渠道，任何人都可以直播，甚至连高昂的奖金池也没有了，这种纯粹的竞赛在这个浮躁的世界是显得如此格格不入，这条路对吗？无人知晓，但是直到今天，这条道路依旧在延续着。&lt;/p&gt;
&lt;p&gt;以及小本子这种新型付费方式。后面小本子开始演变成了赛季通行证，成了大部分网络游戏的标配，包括氪金手游。曾经的小本子是个很有意思的东西，它的初衷是让你可以在游戏里观赛，当然哪怕你不买也可以在流媒体上看其他人的直播，没有限制。游戏里看在有解说的同时，可以自己看想要的信息，还可以自己研究比赛的录像，我认为这种游戏内看比赛的形式非常好。除了看比赛外，也可以通过完成任务来拿饰品，以前我们开玩笑说，把这些饰品拿完了再卖掉可以把买本子的钱挣回来，实际上我直到今天都没有卖掉这些东西。还有票选至宝选io，预测选手，都是非常有意思的东西，比今天的只是做任务拿奖励的通行证好上很多。&lt;/p&gt;
&lt;p&gt;如今dota自己却抛弃了小本子，令人感慨。我也开始厌烦这种模式，第一我没时间做这些狗屎任务，更不想充钱。小本子的初衷只是一张在游戏内观赛的门票和支持比赛的形式，现在却把游戏变得像上班一样，我恨它。&lt;/p&gt;
&lt;p&gt;cn dota曾经是一个传说，玩家们总是喜欢嘲讽隔壁lol的比赛打不过棒子，而在dota这的棒子则被cn打到关服。“cn dota，best dota”，“偶数年冠军”这都是dota玩家口中的佳话。除了这些赞扬，玩家对于职业选手的要求也非常高，比如“没有冠军，连呼吸都是错的”，有时候还嘲笑隔壁lol对于选手太过宽容，大搞饭圈，导致无法夺冠。这么多年过去了，对隔壁的嘲讽终究还是向回旋镖一样砸到了自己的头上。&lt;/p&gt;
&lt;p&gt;但是无可否认的是，cn dota确实有过一段黄金时代，但是黄金时代是何时结束的，就争论不一了。有的人说是在ti6是wings作为中国的最后一块遮羞布在夺冠后被资本搞解散的时候，有的人说是在ti8输掉了近在咫尺的冠军的时候，有人说是在ti10的假赛风波之后。无可争论的是，在ti10之后，属于cn dota的时代，结束了。&lt;/p&gt;
&lt;p&gt;看ti10的时候是我最投入的时候，那时我还是大二，刚刚转完专业，满怀着对未来的期待，不仅是对于自己的学业，还有对于cn dota的未来。那时的lgd如日中天，ame稳得好像失去过什么，在淘汰赛上高歌猛进。在胜者组决赛上的时候表现相当不错，和secret对决的最后翻盘更是令人称奇。看完胜决之后，我以为冠军已经是囊中之物，cn dota在四年无冠后总算可以扬眉吐气一把。总决赛那一天，我早早的洗完澡并去买了杯柠檬水和一只烤鸡。在自己的宿舍把柠檬水和伏特加混在一起就着烤鸡吃。我想看着lgd夺冠。但是我没看到，lgd在总决赛打的一坨狗屎，不仅仅是bp的问题，更像是装菜，比如很长一段时间都没有换中立装备，比如ame不合常理的深入带线和队友的见死不救，以及之前的比赛都知道要ban猛犸但是决赛不ban。比赛的疑点越来越多，甚至连雪碧之前的比赛都开始被人研究是否假赛。到底是纯菜还是假赛，我们已经无从知道，但是在那个时候开始，cn dota在我心中，大抵是死了。&lt;/p&gt;
&lt;p&gt;ti10过后，cn dota在ti的成绩就一落千丈了。别说冠亚了，四强都是奢望，中国赛区的直邀名额被砍，长期没有新鲜血液，打了快十多年了，打的还是那一群人，骂的还是那一群人， 看的还是那一群人。cn dota是什么时候死的呢？不知道了，现在的我们只能麻木的看着他腐败。&lt;/p&gt;
&lt;p&gt;再后来，便是亚运会，这次把电子竞技加入到了亚运会中，其中有一个项目便是dota，我们原认为，以cn dota的实力在亚洲这儿显然乱杀，但是在决赛上，差点输给了蒙古。甚至第一把还给了蒙古，要是最后真的在决赛上输给了蒙古，那cn dota可以彻底入土了，万幸的是最终还是赢下了比赛，但是赢得非常凶险。这个金牌和隔壁lol的铜牌相比还是非常亮眼的，给这个游戏注入了些许活力，但是不多。也许在另一个ti8或ti10赢了的世界线，cn dota依旧是半死不活的样子，想象中的一个名词拯救游戏的事情不会发生。&lt;/p&gt;
&lt;p&gt;曾经的我总是认为电子竞技也不输传统竞技，可以加入到传统的体育比赛中去，但是现在dota加入到了亚运赛的项目中，我却不再这么认为了，如果一个游戏的一切规则都掌握在一个公司手中，并且经常变动，观赏性很高但是观赏门槛也高，比赛的人大部分都驼背近视，它真的也算传统竞技吗？&lt;/p&gt;
&lt;p&gt;ti10结束后有民间选手办了一个互联网杯，各大公司派五个人在下班后打比赛，效果居然还不错，互联网公司的队名和以前打io时的队名有的一拼，乐子很足。也许这就是ti的初衷吧，一群爱好游戏的人聚一块打个游戏，就够了。可惜有华为开挂的消息传来，这个比赛最终还是不了了之。&lt;/p&gt;
&lt;p&gt;时间来到了ti14，也就是我写下这篇文章的这一年，在每年的ti我都会习惯性的去问问群友：“有希望吗？还是ame吗？”答案大都是，没有希望，还是ame。今年依旧如此，但是在小组赛中，两支中国队的表现很好，并且有些强队淹死在了小组赛。社区中开始起了久未燃起的邪念。但是邪念并没有持续多久，没几天其中一支队伍就淘汰了，死的相当难看，于是全村的希望又一次回到了lgd，哦不现在是xg的身上。几天过去，xg被踢入了败者组，一盘冷水浇在了社区那炽热的心上，到此为止了吧。社区的邪念从冠军滑坡为”没事的，六强也不错了，本来就一轮游的货色。“&lt;/p&gt;
&lt;p&gt;但是xg并未停下，”四强很可以了，好好打就行”，“季军是这几年最好的成绩了，就是可惜又要被pv骑脸。”，”什么叫又打入总决赛了？“，”什么叫又打满五场了？“，现实终究不是童话，有一次打满了bo5，又一次亚军，三个亚军终究无法合成一个冠军。也许这是最后一个亚军了吧。比起ti8的不甘，ti10的愤怒，这次只有技不如人。在第二天醒来后打开小黑盒看到3：2的时候，到没多少惊讶。&lt;/p&gt;
&lt;p&gt;人生总是充满遗憾，但是在cn dota的末法时代，还能有一个亚军，已是幸事。&lt;/p&gt;</description></item><item><title>游戏旅途中的孤独</title><link>https://woodman3.github.io/p/%E6%B8%B8%E6%88%8F%E6%97%85%E9%80%94%E4%B8%AD%E7%9A%84%E5%AD%A4%E7%8B%AC/</link><pubDate>Sun, 31 Aug 2025 15:18:38 +0800</pubDate><guid>https://woodman3.github.io/p/%E6%B8%B8%E6%88%8F%E6%97%85%E9%80%94%E4%B8%AD%E7%9A%84%E5%AD%A4%E7%8B%AC/</guid><description>&lt;img src="https://woodman3.github.io/p/%E6%B8%B8%E6%88%8F%E6%97%85%E9%80%94%E4%B8%AD%E7%9A%84%E5%AD%A4%E7%8B%AC/20250829224857_1.jpg" alt="Featured image of post 游戏旅途中的孤独" /&gt;&lt;p&gt;前几天打完了《FAR:Lone Sails》感触颇多。我想把这些孤独感塑造的好的游戏记录一下。&lt;/p&gt;
&lt;p&gt;游戏中的孤独感是个比较稀缺的属性，但是能把这个做好的并不多，因为在游玩的时候大部分情况孤独感都会被其他情感掩盖，所以并不是人少话少就有孤独感。比如《逃生》这种恐怖游戏显然不太可能体会到什么孤独感，《LIMBO》和《星际拓荒》游玩的时候也不会有太多的孤独感，因为大脑在高速运转想着剧情和解密。而且有时候孤独感可能会变成无聊的感觉，比如我在《死亡搁浅》里的时候就会感觉有点无聊。可见孤独感的塑造是非常难得的。&lt;/p&gt;
&lt;h2 id="farlone-sails"&gt;FAR:Lone Sails
&lt;/h2&gt;&lt;p&gt;游戏流程很短，我打完只花了两个半小时。但是这两个半小时的体验其实相当不错。游戏整体除了开头的指引外几乎没有文字，因此剧情只能靠自己想。画面大部分对比度都比较低，除了女主角自己和一些关键地方会用红色标出。有点像《辛德勒的名单》里的手法，所以虽然画质不怎么样但是画面确实十分不错的。游玩的主要内容就是开车和解密，我的小车会逐渐有不少在旅途中捡来的行李，有书，有小球，电视和收音机，花盆等等，我喜欢把花盆放在车顶，让它多晒晒太阳。小车也在逐渐升级，会增加帆布，会有吸尘器，会换轮胎，越来越丰富。开车的时候拉开远景，在听着汽笛声和轮胎声的同时看着窗边的美景，别有一番滋味。&lt;/p&gt;
&lt;p&gt;游戏的末尾陪伴了我们三个小时的小船最后会再一次事故中断裂，我不得不拖着只有一半的残骸到旅途的终点。点燃最后的火焰，看天色逐渐暗下去，知道黑夜降临，火光熄灭。画面陷入一片黑暗，游戏结束，那一刻，一股孤寂的感觉就来了。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E6%B8%B8%E6%88%8F%E6%97%85%E9%80%94%E4%B8%AD%E7%9A%84%E5%AD%A4%E7%8B%AC/20250829224511_1.jpg"
width="2560"
height="1440"
srcset="https://woodman3.github.io/p/%E6%B8%B8%E6%88%8F%E6%97%85%E9%80%94%E4%B8%AD%E7%9A%84%E5%AD%A4%E7%8B%AC/20250829224511_1_hu_a0ce2853ddff70d0.jpg 480w, https://woodman3.github.io/p/%E6%B8%B8%E6%88%8F%E6%97%85%E9%80%94%E4%B8%AD%E7%9A%84%E5%AD%A4%E7%8B%AC/20250829224511_1_hu_9852128f37c0a548.jpg 1024w"
loading="lazy"
alt="最后断裂的船"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
&gt;&lt;/p&gt;
&lt;h2 id="旺达与巨像"&gt;旺达与巨像
&lt;/h2&gt;&lt;p&gt;旺达与巨像是我印象最为深刻的游戏，一个男孩为了自己的心上人独自一人骑着马踏上猎杀巨像的旅途，全程没有npc和文字指引，只有一把会发光的剑来指引方向。最后心上人复活了，男孩却也死了。唏嘘。画面也是灰蒙蒙的，好像末日将至。这个游戏在氛围感的塑造上是我玩个的所有游戏里最好的，在《大镖客》和《荒野之息》上都能找到这个游戏的影子。&lt;/p&gt;
&lt;h2 id="少女布丁旅情"&gt;少女布丁旅情
&lt;/h2&gt;&lt;p&gt;作为一款小品游戏，游戏性几乎等于没有。它和《FAR》很像，但是画面上差了不少，作为弥补，它的剧情不错，有点像《少女终末旅行》，BGM很好听，尽管旅途的路上一直是两个人在说相声，偶尔有第三个人，但是看着一望无际的原野，还是会有一中孤寂的感觉，因为世界上就只有这么几个人了，哪怕美少女贴贴也无法遮掩。&lt;/p&gt;</description></item><item><title>高维单纯形上的数值积分</title><link>https://woodman3.github.io/p/%E9%AB%98%E7%BB%B4%E5%8D%95%E7%BA%AF%E5%BD%A2%E4%B8%8A%E7%9A%84%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86/</link><pubDate>Wed, 27 Aug 2025 11:30:35 +0800</pubDate><guid>https://woodman3.github.io/p/%E9%AB%98%E7%BB%B4%E5%8D%95%E7%BA%AF%E5%BD%A2%E4%B8%8A%E7%9A%84%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86/</guid><description>&lt;img src="https://woodman3.github.io/p/%E9%AB%98%E7%BB%B4%E5%8D%95%E7%BA%AF%E5%BD%A2%E4%B8%8A%E7%9A%84%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86/641b5c955b9cd5730ae8ddddfd706225161775300.jpg" alt="Featured image of post 高维单纯形上的数值积分" /&gt;&lt;p&gt;本文是对&lt;a class="link" href="https://woodman3.github.io/p/%E6%9C%89%E9%99%90%E5%85%83%E4%B8%AD%E7%9A%84%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86/" &gt;之前写的数值积分&lt;/a&gt;的拓展。&lt;/p&gt;
&lt;h2 id="n维空间中的n维单纯形积分"&gt;N维空间中的N维单纯形积分
&lt;/h2&gt;&lt;h3 id="变换域和符号约定"&gt;变换域和符号约定
&lt;/h3&gt;&lt;p&gt;积分过程包括了三个映射$\zeta \mapsto \eta \mapsto \xi \mapsto x$,其含义如下&lt;/p&gt;
&lt;p&gt;实际积分域：&lt;strong&gt;单纯形&lt;/strong&gt;&lt;/p&gt;
$$
S=\text{conv}\{v_0,\dots,v_N\}\subset\mathbb{R}^N
$$&lt;p&gt;实际积分域内部的点用$x$表示&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;标准单纯形&lt;/strong&gt;（在 $\mathbb{R}^N$）：&lt;/p&gt;
$$
\hat S = \Big\{\, \xi=(\xi_1,\dots,\xi_N)\in\mathbb{R}^N \;\Big|\; \xi_i\ge 0,\; \sum_{i=1}^N \xi_i \le 1 \,\Big\}.
$$&lt;p&gt;&lt;strong&gt;高斯积分区域和位移放缩后的区域&lt;/strong&gt;：&lt;/p&gt;
$$
\zeta \in [-1,1]^N, \quad \eta=\frac{\zeta+1}{2}\in [0,1]^N .
$$&lt;h3 id="的映射"&gt;$\eta \to \xi$ 的映射
&lt;/h3&gt;&lt;h4 id="递归乘积公式1"&gt;递归乘积公式1
&lt;/h4&gt;$$
\begin{aligned}
\xi_1 &amp;= \eta_1, \\
\xi_2 &amp;= (1-\eta_1)\,\eta_2, \\
\xi_3 &amp;= (1-\eta_1)(1-\eta_2)\,\eta_3, \\
&amp;\;\;\vdots \\
\xi_{N} &amp;= \Big(\prod_{j=1}^{N-1}(1-\eta_j)\Big)\eta_N, \\
\xi_0 &amp;= \prod_{j=1}^N (1-\eta_j).
\end{aligned}
$$&lt;p&gt;令这个变换的雅可比式为$J^{\xi}_{\eta}$，不难发现雅可比矩阵是一个三角阵，其行列式的值为
&lt;/p&gt;
$$
|\det(J^{\xi}_{\eta})| = \prod_{k=1}^{N-1}(1-\eta_k)^{\,N-k}
$$&lt;h4 id="递归乘积公式2"&gt;递归乘积公式2
&lt;/h4&gt;$$
\begin{aligned}
\xi_1 &amp;= (1-\eta_2)\eta_1, \\
\xi_2 &amp;= (1-\eta_3)\,\eta_1\,\eta_2, \\
\xi_3 &amp;= (1-\eta_4)\,\eta_1\,\eta_2\,\eta_3, \\
&amp;\;\;\vdots \\
\xi_{N} &amp;= \prod_{j=1}^{N}\eta_j, \\
\xi_0 &amp;= (1-\eta_1).
\end{aligned}
$$&lt;p&gt;这个变换的雅可比式也是一个三角阵，但是对角线上的一排还有元素，所以不能直接去对角线上的元素相乘作为行列式的值，但是可以把最后一排加到倒数第二排，再把倒数第二排的加到倒数第三排，以此类推可以把对角线上一排的值消掉，得到行列式的值为：&lt;/p&gt;
$$
|\det(J^{\xi}_{\eta})| = \prod_{k=1}^{N}\eta_k^{\,N-k}
$$&lt;h3 id="标准单纯形到实际单纯形的映射"&gt;标准单纯形到实际单纯形的映射
&lt;/h3&gt;$$
x = v_0 + \sum_{i=1}^N \xi_i (v_i - v_0).
$$&lt;p&gt;这就可以写成矩阵形式：&lt;/p&gt;
$$
x = v_0 + A \xi,
$$&lt;p&gt;其中&lt;/p&gt;
$$
A = \big[ v_1 - v_0 \;\; v_2 - v_0 \;\; \cdots \;\; v_N - v_0 \big] \in \mathbb R^{d \times N}.
$$&lt;p&gt;这样就把单纯形 $\Delta^N$ 上的点 $\xi$ 映射到物理空间中的点 $x$ 了。&lt;/p&gt;
&lt;p&gt;于是实际单纯形内任意点写为&lt;/p&gt;
$$
x = \sum_{i=0}^N \xi_i v_i .
$$&lt;p&gt;其重心坐标为&lt;/p&gt;
$$
\xi_0 = 1 - \sum_{i=1}^N \xi_i, \qquad
\xi_i = \xi_i \quad (i=1,\dots,N).
$$&lt;h3 id="从--到--的最终映射"&gt;从 $\zeta$ 到 $x$ 的最终映射
&lt;/h3&gt;$$
x(\zeta) = \sum_{i=0}^N \xi_i(\eta(\zeta))\, v_i,
\quad \eta = \tfrac{\zeta+1}{2}.
$$&lt;h3 id="雅可比行列式"&gt;雅可比行列式
&lt;/h3&gt;&lt;p&gt;映射 $\zeta \mapsto \eta \mapsto \xi \mapsto x$ 的雅可比为&lt;/p&gt;
$$
\Big|\det\frac{\partial x}{\partial \zeta}\Big|
= |\det A|\,|\det J^{\xi}_{\eta}|\;(\tfrac{1}{2})^N ,
$$&lt;h3 id="最终积分公式"&gt;最终积分公式
&lt;/h3&gt;&lt;p&gt;对 $f\colon S\to\mathbb{R}$，&lt;/p&gt;
$$
\int_S f(x)\,dx
= \int_{[-1,1]^N} f(x(\zeta))\;
|\det A|\,|\det J^{\xi}_{\eta}|\;(\tfrac{1}{2})^N d\zeta.
$$&lt;p&gt;然后就可以在 $[-1,1]^N$ 上直接用 &lt;strong&gt;Gauss–Legendre 积分点 $(\zeta,w)$&lt;/strong&gt; 做数值积分。&lt;/p&gt;
&lt;h2 id="n维空间中的的m维单纯形积分"&gt;N维空间中的的M维单纯形积分
&lt;/h2&gt;&lt;h3 id="积分区域"&gt;积分区域
&lt;/h3&gt;&lt;p&gt;我们在 $\mathbb{R}^N$ 空间里有一个 $M$-维单纯形&lt;/p&gt;
$$
F = \mathrm{conv}\{ v_0, v_1, \dots, v_{M} \}, \quad v_i \in \mathbb{R}^N.
$$&lt;h3 id="标准--单纯形"&gt;标准 $M$-单纯形
&lt;/h3&gt;&lt;p&gt;定义参考单纯形：&lt;/p&gt;
$$
\hat F = \{\, \xi = (\xi_1,\dots,\xi_{M}) \in \mathbb{R}^{M} \mid \xi_i \ge 0,\;\; \sum_{i=1}^{M} \xi_i \le 1 \,\}.
$$&lt;p&gt;重心坐标：&lt;/p&gt;
$$
\xi_0 = 1 - \sum_{i=1}^{M} \xi_i, \quad
\xi_i = \xi_i \;\;(i=1,\dots,M).
$$&lt;p&gt;映射到实际面：&lt;/p&gt;
$$
x(\xi) = \sum_{i=0}^{M} \xi_i v_i = v_0 + \sum_{i=1}^{M} \xi_i (v_i - v_0).
$$&lt;h3 id="雅可比面元因子"&gt;雅可比（面元因子）
&lt;/h3&gt;&lt;p&gt;参数矩阵：&lt;/p&gt;
$$
B \;=\; \begin{bmatrix}
\;v_1-v_0 &amp; v_2-v_0 &amp; \cdots &amp; v_{M}-v_0\;
\end{bmatrix}
\;\in\; \mathbb R^{\,N\times M}.
$$&lt;p&gt;面元的度量因子是&lt;/p&gt;
$$
J(\xi) = \sqrt{\det(B^\top B)}.
$$&lt;p&gt;可以类比为缩放因子&lt;/p&gt;
&lt;p&gt;特别地：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在 2D（边，1D simplex），就是线段长度：$J=|v_1-v_0|$。&lt;/li&gt;
&lt;li&gt;在 3D（三角形，2D simplex），就是三角形的面积因子：$J=| (v_1-v_0) \times (v_2-v_0)|$。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;gpt告诉我这个行列式也叫Gram行列式，详细的推导就涉及微分几何的内容了，我曾在菲赫金哥尔茨的《微积分学教程（第三卷）》上看到过一个三维到二维的推导，大受震撼，感兴趣的读者可以自己去推下试试。&lt;/p&gt;
&lt;h3 id="jacobian-权重"&gt;Jacobian 权重
&lt;/h3&gt;&lt;p&gt;变换的面积因子为&lt;/p&gt;
$$
\Big\|\frac{\partial x}{\partial \zeta}\Big\|
= J \cdot \Big(\tfrac{1}{2}\Big)^{M} \cdot |\det J^{\xi}_{\eta}|,
$$&lt;p&gt;其中&lt;/p&gt;
$$
J = \sqrt{\det(B^\top B)}, \quad B = [\,v_1-v_0,\dots,v_{M}-v_0\,].
$$&lt;h3 id="最终积分公式-1"&gt;最终积分公式
&lt;/h3&gt;&lt;p&gt;对于 $f:\mathbb{R}^N\to\mathbb{R}$，&lt;/p&gt;
$$
\int_F f(x)\, dS
= \int_{[-1,1]^{M}} f(x(\zeta))\; J \;\Big(\tfrac{1}{2}\Big)^{M}\; |\det J^{\xi}_{\eta}|\; d\zeta.
$$&lt;p&gt;然后直接用张量积 Gauss–Legendre 规则在 $[-1,1]^{M}$ 上做。&lt;/p&gt;
&lt;h2 id="代码"&gt;代码
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt; 10
&lt;/span&gt;&lt;span class="lnt"&gt; 11
&lt;/span&gt;&lt;span class="lnt"&gt; 12
&lt;/span&gt;&lt;span class="lnt"&gt; 13
&lt;/span&gt;&lt;span class="lnt"&gt; 14
&lt;/span&gt;&lt;span class="lnt"&gt; 15
&lt;/span&gt;&lt;span class="lnt"&gt; 16
&lt;/span&gt;&lt;span class="lnt"&gt; 17
&lt;/span&gt;&lt;span class="lnt"&gt; 18
&lt;/span&gt;&lt;span class="lnt"&gt; 19
&lt;/span&gt;&lt;span class="lnt"&gt; 20
&lt;/span&gt;&lt;span class="lnt"&gt; 21
&lt;/span&gt;&lt;span class="lnt"&gt; 22
&lt;/span&gt;&lt;span class="lnt"&gt; 23
&lt;/span&gt;&lt;span class="lnt"&gt; 24
&lt;/span&gt;&lt;span class="lnt"&gt; 25
&lt;/span&gt;&lt;span class="lnt"&gt; 26
&lt;/span&gt;&lt;span class="lnt"&gt; 27
&lt;/span&gt;&lt;span class="lnt"&gt; 28
&lt;/span&gt;&lt;span class="lnt"&gt; 29
&lt;/span&gt;&lt;span class="lnt"&gt; 30
&lt;/span&gt;&lt;span class="lnt"&gt; 31
&lt;/span&gt;&lt;span class="lnt"&gt; 32
&lt;/span&gt;&lt;span class="lnt"&gt; 33
&lt;/span&gt;&lt;span class="lnt"&gt; 34
&lt;/span&gt;&lt;span class="lnt"&gt; 35
&lt;/span&gt;&lt;span class="lnt"&gt; 36
&lt;/span&gt;&lt;span class="lnt"&gt; 37
&lt;/span&gt;&lt;span class="lnt"&gt; 38
&lt;/span&gt;&lt;span class="lnt"&gt; 39
&lt;/span&gt;&lt;span class="lnt"&gt; 40
&lt;/span&gt;&lt;span class="lnt"&gt; 41
&lt;/span&gt;&lt;span class="lnt"&gt; 42
&lt;/span&gt;&lt;span class="lnt"&gt; 43
&lt;/span&gt;&lt;span class="lnt"&gt; 44
&lt;/span&gt;&lt;span class="lnt"&gt; 45
&lt;/span&gt;&lt;span class="lnt"&gt; 46
&lt;/span&gt;&lt;span class="lnt"&gt; 47
&lt;/span&gt;&lt;span class="lnt"&gt; 48
&lt;/span&gt;&lt;span class="lnt"&gt; 49
&lt;/span&gt;&lt;span class="lnt"&gt; 50
&lt;/span&gt;&lt;span class="lnt"&gt; 51
&lt;/span&gt;&lt;span class="lnt"&gt; 52
&lt;/span&gt;&lt;span class="lnt"&gt; 53
&lt;/span&gt;&lt;span class="lnt"&gt; 54
&lt;/span&gt;&lt;span class="lnt"&gt; 55
&lt;/span&gt;&lt;span class="lnt"&gt; 56
&lt;/span&gt;&lt;span class="lnt"&gt; 57
&lt;/span&gt;&lt;span class="lnt"&gt; 58
&lt;/span&gt;&lt;span class="lnt"&gt; 59
&lt;/span&gt;&lt;span class="lnt"&gt; 60
&lt;/span&gt;&lt;span class="lnt"&gt; 61
&lt;/span&gt;&lt;span class="lnt"&gt; 62
&lt;/span&gt;&lt;span class="lnt"&gt; 63
&lt;/span&gt;&lt;span class="lnt"&gt; 64
&lt;/span&gt;&lt;span class="lnt"&gt; 65
&lt;/span&gt;&lt;span class="lnt"&gt; 66
&lt;/span&gt;&lt;span class="lnt"&gt; 67
&lt;/span&gt;&lt;span class="lnt"&gt; 68
&lt;/span&gt;&lt;span class="lnt"&gt; 69
&lt;/span&gt;&lt;span class="lnt"&gt; 70
&lt;/span&gt;&lt;span class="lnt"&gt; 71
&lt;/span&gt;&lt;span class="lnt"&gt; 72
&lt;/span&gt;&lt;span class="lnt"&gt; 73
&lt;/span&gt;&lt;span class="lnt"&gt; 74
&lt;/span&gt;&lt;span class="lnt"&gt; 75
&lt;/span&gt;&lt;span class="lnt"&gt; 76
&lt;/span&gt;&lt;span class="lnt"&gt; 77
&lt;/span&gt;&lt;span class="lnt"&gt; 78
&lt;/span&gt;&lt;span class="lnt"&gt; 79
&lt;/span&gt;&lt;span class="lnt"&gt; 80
&lt;/span&gt;&lt;span class="lnt"&gt; 81
&lt;/span&gt;&lt;span class="lnt"&gt; 82
&lt;/span&gt;&lt;span class="lnt"&gt; 83
&lt;/span&gt;&lt;span class="lnt"&gt; 84
&lt;/span&gt;&lt;span class="lnt"&gt; 85
&lt;/span&gt;&lt;span class="lnt"&gt; 86
&lt;/span&gt;&lt;span class="lnt"&gt; 87
&lt;/span&gt;&lt;span class="lnt"&gt; 88
&lt;/span&gt;&lt;span class="lnt"&gt; 89
&lt;/span&gt;&lt;span class="lnt"&gt; 90
&lt;/span&gt;&lt;span class="lnt"&gt; 91
&lt;/span&gt;&lt;span class="lnt"&gt; 92
&lt;/span&gt;&lt;span class="lnt"&gt; 93
&lt;/span&gt;&lt;span class="lnt"&gt; 94
&lt;/span&gt;&lt;span class="lnt"&gt; 95
&lt;/span&gt;&lt;span class="lnt"&gt; 96
&lt;/span&gt;&lt;span class="lnt"&gt; 97
&lt;/span&gt;&lt;span class="lnt"&gt; 98
&lt;/span&gt;&lt;span class="lnt"&gt; 99
&lt;/span&gt;&lt;span class="lnt"&gt;100
&lt;/span&gt;&lt;span class="lnt"&gt;101
&lt;/span&gt;&lt;span class="lnt"&gt;102
&lt;/span&gt;&lt;span class="lnt"&gt;103
&lt;/span&gt;&lt;span class="lnt"&gt;104
&lt;/span&gt;&lt;span class="lnt"&gt;105
&lt;/span&gt;&lt;span class="lnt"&gt;106
&lt;/span&gt;&lt;span class="lnt"&gt;107
&lt;/span&gt;&lt;span class="lnt"&gt;108
&lt;/span&gt;&lt;span class="lnt"&gt;109
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// 递归生成 N 维笛卡尔积
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Arithmetic&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;generate_tensor_nodes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;one_d_nodes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;dim&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dim&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;push_back&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;one_d_nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;dim&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;generate_tensor_nodes&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;one_d_nodes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dim&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;/=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// 回溯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// 返回 o 阶 N 维节点
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Arithmetic&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;constexpr&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;get_gl_nodes_nd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;one_d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;{};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;generate_tensor_nodes&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;one_d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Arithmetic&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;get_simplex_nd_gl_nodes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;static&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;mapped_nodes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;MAX_GL_ORDER&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;static&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;once_flag&lt;/span&gt; &lt;span class="n"&gt;init_flag&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;call_once&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;init_flag&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;MAX_GL_ORDER&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;gl_nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_gl_nodes_nd&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;gl_nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;gl_nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;eta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;{};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;eta&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;eta&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;eta&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;eta&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="n"&gt;pow&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;]),&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;eta&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;node&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;eta&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mapped_nodes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gl_nodes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;mapped_nodes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Arithmetic&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;integrate_on_n_simplex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;simplex&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;function&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_simplex_nd_gl_nodes&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simplex&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;simplex&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simplex&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;determinant&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;/=&lt;/span&gt; &lt;span class="n"&gt;pow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Arithmetic&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;integrate_on_m_simplex_in_nd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;simplex&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;function&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_simplex_nd_gl_nodes&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simplex&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;simplex&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simplex&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="n"&gt;pow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transpose&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="n"&gt;determinant&lt;/span&gt;&lt;span class="p"&gt;()),&lt;/span&gt; &lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;/=&lt;/span&gt; &lt;span class="n"&gt;pow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>雨水落到大教堂上，滚落到小人物上——《pentiment》</title><link>https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/</link><pubDate>Mon, 21 Jul 2025 21:06:12 +0800</pubDate><guid>https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/</guid><description>&lt;img src="https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/133054821_p0.jpg" alt="Featured image of post 雨水落到大教堂上，滚落到小人物上——《pentiment》" /&gt;&lt;h2 id="引"&gt;引
&lt;/h2&gt;&lt;p&gt;最开始听说这个游戏，是第一次准备考研时想要找《极乐迪斯科》那种剧情好并且可以学英语的代餐，我原本以为我找不到了，但是我在社交平台上还真找到了（忘记是小红书还是小黑盒了）。这个游戏如果打上玩家自制的补丁的话就可以实现中英双语阅读，甚至比极乐迪斯科还要友好，因为极乐迪斯科每次切换语言都要一小段延迟，而这个没有。并且这个游戏在xpg上也有，但是因为考研的时间日益紧张，我玩了开头的五分钟就再也没玩了，当时觉得这种文艺复兴的手绘风看不惯，&lt;/p&gt;
&lt;p&gt;两年后我再次抱着学习英语的目的打开这个游戏时，是因为我的xgp订阅只剩下两周半的时间，我本想着去玩暗喻幻想，但是暗喻幻想实在是太无聊了，老套的剧情和狗屎的迷宫和简陋的战斗系统丝毫没有让人玩下去的欲望。于是乎我点开了这个游戏，不料一发不可收拾，惊讶的发现自己又找到了一个神作。&lt;/p&gt;
&lt;h2 id="悬疑"&gt;悬疑？
&lt;/h2&gt;&lt;p&gt;在游戏的开头，我们扮演这一个远道而来的画师，作为一个小资产阶级给塔兴大教堂画画来打工。不出意外的，大教堂的赞助商在来的时候遇害了，于是我为了避免自己的挚友遇害，不得不去试着找出真凶，于是一个悬疑的侦探游戏拉开了序幕&amp;hellip;吗？&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment1.png"
width="2560"
height="1440"
srcset="https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment1_hu_3c0335d236af7b2.png 480w, https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment1_hu_6329c55dd8b92e69.png 1024w"
loading="lazy"
alt="这可是碰都不能碰的话题"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
&gt;&lt;/p&gt;
&lt;p&gt;并非如此，游戏通过对话来收集线索，而收集线索需要时间。整体属于网状叙事，需要从各方调查来查清 真相。但是，游戏并没有给我充分的时间，事实上，你根本不可能在一次把所有的剧情全部集齐，起码要多几个周目才行，在我偷偷从图书馆回来的那个晚上，就在我还在回味捕捉到长老和修士搞基的乐子时，游戏告诉我：会吏官来了，我必须开始指控一个人了。&lt;/p&gt;
&lt;p&gt;指控？我如何指控？我虽然手里有一些线索，但是我并没有决定性的证据。但是我还是得硬着头皮指控了我最讨厌的长老，我以为会吏官会再给我几天时间找到真凶，但是并没有，几分钟后主教被押到广场，斩首示众。第一幕结束了。&lt;/p&gt;
&lt;p&gt;我感到有些难以置信，这时候我才意识到游戏并不是一个常规的推理悬疑游戏，因为你可能根本没找到真凶！你只是为了保护好人而把其他一些有罪的人推了出去罢了。到了第二幕，时间更加紧凑，我只能抓住一条线索，最后把那个和磨坊主偷情的女人推了出去。我感到悲伤但是又无可奈何，我悲伤因为我不确定我推出去的人是否是真凶，我无奈是因为我必须推一个出去，院长不是好人但是我知道他的确不是真凶，我因为可怜的正义感需要找到真凶，但是我却指控一个我不确定是真凶的人。何其悲哀。&lt;/p&gt;
&lt;p&gt;再第三幕的结尾，当我看到神父在大伙聚会离开的时候，我的心中对于真凶是谁，已经有了答案，但我也知道，真凶的身份已经不重要了，重要的是动机，为什么？&lt;/p&gt;
&lt;h2 id="宗教"&gt;宗教
&lt;/h2&gt;&lt;p&gt;宗教是这个游戏绕不开的话题，感谢汉化，不然如果让我硬啃这些宗教名词和地名我肯定啃不下来。游戏对于宗教的描写不至于基督教，还涉及到了原住民的原始信仰，罗马人的信仰和后来被基督教取代的历史，对于这些异教的着墨也是谜题的迷底。&lt;/p&gt;
&lt;p&gt;在讨论基督教前，我先聊聊自己在游玩前对于基督教的看法。我认为基督教还是有一些积极作用的，比如通过辩经推进了科学和哲学的进步，传播了基本的普世道德观，维护了基层的安定。但是对于基督教的消极作用，得益于娱乐作品长时间的刻板印象的宣传我对于他的消极作用还是缺乏更加现实的认识。但是在游戏中，基督教在历史中的影子被很好的还原了，值得细说。&lt;/p&gt;
&lt;p&gt;塔兴镇的建立和基督教有着密不可分的关系，传言出过两个圣人，其中一个圣人的手臂还作为圣物供奉，这让基督教徒来塔兴朝圣，间接的带动了塔兴的旅游业，也让大教堂可以富丽堂皇，并且有缮写室，使得我们的主人公可以来塔兴打工，可以说，这个虚构的传说一定程度上促进了塔兴的繁荣，使得我们可以在塔兴看到形形色色的人。&lt;/p&gt;
&lt;p&gt;但是，维护大教堂需要开支，尤其是缮写室和图书馆，这两个是开支的大头，他们促进了知识的传播和维持着文化的传承，可又不得不靠剥削这农民维持。不经如此，院长的日常饮食还很丰盛，就在开头的第一个任务就是寄宿的农家告诉我他们因为上涨的税收而欠了大教堂的钱，恳请我提前支付房租。兵器在吃饭的时候提到了他们最好的白面粉都要给大教堂。第二幕在我去院长家吃饭时也能注意到，院长吃的都是白面包，院长的房间更是豪华（讽刺的是，院长的房间有两个门，一个可以从镇上直接进去，而一扇需要从教堂绕一大段，第一扇门似乎一直都是关着的），甚至连的狗都膘肥体壮。而与此同时农夫家里的人得了病，却连面包都吃不起，哪怕是去树林拣点吃的都不被允许。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment2.png"
width="2560"
height="1440"
srcset="https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment2_hu_bcb1dc1de8ef1dc2.png 480w, https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment2_hu_90df5c9f348817a5.png 1024w"
loading="lazy"
alt="第一幕的洪水，主角可以在温暖的缮写室内继续作业，而他借宿的农民家里的人却不能"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
&gt;&lt;/p&gt;
&lt;p&gt;大教堂如此鱼肉百姓，对吗？显然不可能，游戏发生的十六世纪末期宗教改革已经拉开了序幕，主角甚至可以和路德上同一所大学，路德宗的思想也传播到了塔兴这个小镇，大教堂内部的一些人也对新思想抱有开明的态度，甚至就连大教堂的赞助人这种食利阶层都对路德的思想感兴趣，更别提广大农民了。在第二幕，院长加重税收，于是印刷商把反对苛政的《十二条款》印刷传播，不识字的木匠站起来号召人们反抗暴政。后来我才知道，游戏中提到的《十二条款》是真实存在的，德意志帝国的农民在这个时期对于暴政的反抗也是真实存在的。&lt;/p&gt;
&lt;p&gt;第二幕的主题是关于革命，我们的主角作为一个艺术家，在阶级的划分上属于中间派。这使得他可以同时接触到上层和下层的看法。主角一方面同情农民的吃不上饭的悲惨遭遇，一方面又希望保全大教堂里图书馆的书籍从而认同教堂剥削的合理性，但是我不能决定剧情的大走向，那个演讲的木匠必然被人陷害，愤怒的农名必然冲入大教堂烧毁一切，而在那之后又被雇佣兵残酷的镇压。值得讽刺的是大教堂的僧侣中就有着一个曾经是雇佣兵的人，不知道他看到雇佣兵杀害平民的时候会想什么呢？雇佣兵是外国的，对于他们来说帮助他国镇压暴乱可以说没有丝毫的心理负担，甚至还会因为维护了领主和教会的通知得到赏赐，哪怕暴乱的原因就是这些权贵的挥霍无度，何其讽刺！这么来看也许大一统的国家推翻上层的统治可能性更大。&lt;/p&gt;
&lt;p&gt;在革命之后，富丽堂皇的大教堂被烧为废墟，大部分僧侣和修士也离开了这个小镇。基督教的统治开始减弱，但是，那个曾经和长老偷情的修士居然当上了会吏长，我想不到宗教人员居然可以直接担任政府的实权人员，看来我之前低估了宗教在欧洲社会中的地位。并且在第二幕中我们可以得知，大教堂还需要替领主收税，所以当农民开始抗议教会时，公爵才会出兵镇压。于是封建地主和宗教构成了压迫着小老百姓的两座大山。不知道中国古代的宗教是否会有类似的作用。&lt;/p&gt;
&lt;h2 id="人民"&gt;人民
&lt;/h2&gt;&lt;p&gt;游戏中对于无产阶级的描绘大都是偏向正面而且善良的，尤其是在第二章被强制在农夫家里吃饭的那一段，农夫已经穷的连黑面包都吃不起了，家里的孩子和妻子都还身患疾病，即使如此，他们依旧把能拿出来的最好的东西给主角吃，哪怕主角比他们富有的多。我在他们的身上看到了一种朴实而坚韧的力量，我没想到这种力量不仅存在于中国历朝历代的无产阶级身上，也存在于西方的无产阶级上，尽管这只是游戏的描写，我也愿意相信在真实的历史中这样的人是广泛存在的。作为对比，我国现在的文娱产业的工作者却致力于描写底层的人性黑暗，不愿相信存在于人民心中的善良，把自己内心的龌龊安在无产阶级的头上，简直无耻。&lt;/p&gt;
&lt;p&gt;游戏中出现的每一个人，都有着自己的阶层的职业。人数最多的就是农民和手工业者，其次是教会的僧侣的修女。年龄分布从小孩到老人都有。我们能看到在第一幕还在牙牙学语的丫头在第二幕开始帮自己的父母干活，你问他还认不认得自己的时候她只会迷茫的摇摇头，然后在第三幕嫁人成家生娃，甚至孩子的名字都是第一幕主角的名字，连猫狗都有自己的孩子。你能看到在第二幕羞涩的石匠在第三幕成功和那个自己喜欢的外地女孩结婚生娃，你能看到主角第一幕被偷（其实是明着拿的）的帽子在第二幕被打了个补丁戴在头上，然后在第三幕又打了个补丁传给了自己的孩子。曾经有点呆傻的大个子后来成为了镇上的议员，在最后的圣诞节发表演讲。在听证时不给你好脸色的会吏官成为了路德宗的信徒还写信给第三幕的女孩来还原当时的真相。使劲变迁，城郭如故人民非。去教堂的草地上出现了靠着朝圣者营业的旅馆，烧毁的大教堂远处建起了镇议会，时代在变迁，小镇也在进步（笑）。&lt;/p&gt;
&lt;p&gt;在革命结束后，不同人对于革命的评价都不一样，有的人认为流血冲突就不该发生，他们认为死了这么多的人什么都没改变是很不划算的，哪怕镇议会成立了，他也认为“老爷们还是在压迫着我们，雇佣兵还是在压迫着我们”。但是大部分人对于革命还是保持着积极的态度，认为教会离开、磨坊主的死和镇议会的成立是个好的开始。&lt;/p&gt;
&lt;p&gt;写到这里，我开始思考游戏中的磨坊主属于什么阶层。教会不接受粮食抵税，农民需要把小麦拿去磨坊加工成面粉然后卖掉。农民告诉我如果收成好，磨坊主就会上调磨麦子的价格，但是收成差缺不会降回来。在木匠在广场发表反对压迫的演讲时，磨坊主却跳出来说这群人不过乌合之众，领主的雇佣兵可以轻易的把他们图的一干二净，看来磨坊主也是压榨着农民的一份子，甚至可以说是那个年代资产阶级的缩影。在游戏中和磨坊主对话中可以感受到磨坊主对于农民的不屑，在第二幕农民要被饿死了磨坊主甚至还邀请主角和他一起去打猎，而此时农民连进森林拣点栗子都不被允许，因为“森林是领主和教会的财产”。但是磨坊主身为剥削阶级的一员，却没有足够的武力来武装自己不被农民打死，虽然他那奢华的家中摆着一把来福枪，但是面对愤怒的人民，一把来福枪又能如何呢？当第一声枪响打死了镇中的好人乌里奇时，农民点燃了风车，磨坊主被烧死在了风车里，没有武装的资产阶级终究不过是纸老虎罢了，领主的雇佣兵可不会帮你。&lt;/p&gt;
&lt;p&gt;虽然讲了这么多磨坊主的坏话，但是磨坊主的儿子带着他的母亲出逃后在几年后又回来了，不仅再次成为了磨坊主，还成为了镇议会的一员。他与他爹的不同之处就是价格公道了，不剥削农民了，镇上的人也不会把他爹的罪过推到他身上，可能是因为他爹已经被清算的缘故。但是这样的情况又能持续几代人呢？无从得知。有时我想，如果他爹没有被清算，或者没有被那些农民亲手清算，那么他儿子的日子还会好过吗？哪怕他儿子确实是个好人？多半不可能，父债子偿嘛。&lt;/p&gt;
&lt;p&gt;成立的镇议会，原本的双修修道院只剩下女修道院，那么收税的职责交给了谁呢？毫无疑问是议会，好在议会刚刚成立，还没有腐败的现象。但是在第三幕中我们也能看得出来议会的人尽管从小镇中产生，但是还是得要对领主负责，在主角绘制壁画的时候就有不少人担心会引发领主的不满，看来担心因为自己的作品得罪上面而被砍头的现象不是老中独有的。&lt;/p&gt;
&lt;p&gt;在第三幕主角换人了，玩家感情深厚的主角在游戏的中途死了而新的主角是从没见过的人，这个剧情怎么在《33号远征队》见过呢？观察社区的评论发现没人讨厌这点，甚至不少人在发现已经死去的主角原来没死后还会非常感动，这么一看这种操作其实没什么值得诟病的地方。&lt;/p&gt;
&lt;p&gt;主角死而复生这一点其实有点扯，我想不明白为什么能靠着农民扔掉的黑麦苟活。前面才说农民被剥削的要饿死了，难道革命完之后死了太多人然后粮食反而足够了？或者苛政确实宽容了？也许都有吧。但是看到主角在门后出现的时候，确实是让人始料不及，我以为这个人真正的幕后凶手，谁能想到是一个死人呢？但是还是有一点疑惑，为什么苟活了十八年才发现了地道，而且非得等到这一天才带新主角查明真相，早干嘛去了呢？所幸游戏已经快要结束了，这点剧情上的小瑕疵也没人在意。&lt;/p&gt;
&lt;p&gt;游戏的真相还是黑了一手基督教，塔兴对于基督教的信仰原来是建立在一场误会上，甚至所有来朝圣的人都被蒙在鼓里。就好这口荒诞主义的结尾，然而我们无法得知镇上的人对于这件事情的看法了，也不知道未来的塔兴又将如何，那个失去了朝圣者的旅馆又将如何维持下去。但是这种故事在现实中无数次的上演过，不是吗？&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment3.png"
width="2560"
height="1440"
srcset="https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment3_hu_43116c8aaafa818f.png 480w, https://woodman3.github.io/p/%E9%9B%A8%E6%B0%B4%E8%90%BD%E5%88%B0%E5%A4%A7%E6%95%99%E5%A0%82%E4%B8%8A%E6%BB%9A%E8%90%BD%E5%88%B0%E5%B0%8F%E4%BA%BA%E7%89%A9%E4%B8%8Apentiment/Pentiment3_hu_e8285b06cb09aef3.png 1024w"
loading="lazy"
alt="迷宫女神手中的迷宫原来是罗马浴场的花纹，却被传成了圣母降临的神话"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
&gt;&lt;/p&gt;</description></item><item><title>Eigen中的运行时选择稀疏矩阵求解器</title><link>https://woodman3.github.io/p/eigen%E4%B8%AD%E7%9A%84%E8%BF%90%E8%A1%8C%E6%97%B6%E9%80%89%E6%8B%A9%E7%A8%80%E7%96%8F%E7%9F%A9%E9%98%B5%E6%B1%82%E8%A7%A3%E5%99%A8/</link><pubDate>Tue, 01 Jul 2025 17:36:12 +0800</pubDate><guid>https://woodman3.github.io/p/eigen%E4%B8%AD%E7%9A%84%E8%BF%90%E8%A1%8C%E6%97%B6%E9%80%89%E6%8B%A9%E7%A8%80%E7%96%8F%E7%9F%A9%E9%98%B5%E6%B1%82%E8%A7%A3%E5%99%A8/</guid><description>&lt;img src="https://woodman3.github.io/p/eigen%E4%B8%AD%E7%9A%84%E8%BF%90%E8%A1%8C%E6%97%B6%E9%80%89%E6%8B%A9%E7%A8%80%E7%96%8F%E7%9F%A9%E9%98%B5%E6%B1%82%E8%A7%A3%E5%99%A8/131114090_p0.jpg" alt="Featured image of post Eigen中的运行时选择稀疏矩阵求解器" /&gt;&lt;h2 id="起因"&gt;起因
&lt;/h2&gt;&lt;p&gt;因为eigen中的稀疏矩阵求解器使用CRTP，无法直接使用基类指针来实现运行时分发，因此使用&lt;code&gt;variant&lt;/code&gt;来实现，实现的源码如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;span class="lnt"&gt;37
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#pragma once
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;exception&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;variant&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;Eigen/Sparse&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#ifdef EIGEN_USE_MKL_ALL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;Eigen/PardisoSupport&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SparseSolverWrapper&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;public&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="n"&gt;VectorXd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;VectorXd&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="n"&gt;SparseMatrix&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="n"&gt;SolverVariant&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;variant&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#ifdef EIGEN_USE_MKL_ALL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;PardisoLLT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Upper&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;PardisoLU&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;PardisoLDLT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Upper&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SimplicialLLT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Upper&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SimplicialLDLT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Upper&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;SolverVariant&lt;/span&gt; &lt;span class="n"&gt;solver&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;compute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;VectorXd&lt;/span&gt; &lt;span class="nf"&gt;solve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;VectorXd&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="nf"&gt;success&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;init&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;private&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;SolverType&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;emplace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;solver&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;emplace&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SolverType&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;forward&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;decltype&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)...);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;span class="lnt"&gt;37
&lt;/span&gt;&lt;span class="lnt"&gt;38
&lt;/span&gt;&lt;span class="lnt"&gt;39
&lt;/span&gt;&lt;span class="lnt"&gt;40
&lt;/span&gt;&lt;span class="lnt"&gt;41
&lt;/span&gt;&lt;span class="lnt"&gt;42
&lt;/span&gt;&lt;span class="lnt"&gt;43
&lt;/span&gt;&lt;span class="lnt"&gt;44
&lt;/span&gt;&lt;span class="lnt"&gt;45
&lt;/span&gt;&lt;span class="lnt"&gt;46
&lt;/span&gt;&lt;span class="lnt"&gt;47
&lt;/span&gt;&lt;span class="lnt"&gt;48
&lt;/span&gt;&lt;span class="lnt"&gt;49
&lt;/span&gt;&lt;span class="lnt"&gt;50
&lt;/span&gt;&lt;span class="lnt"&gt;51
&lt;/span&gt;&lt;span class="lnt"&gt;52
&lt;/span&gt;&lt;span class="lnt"&gt;53
&lt;/span&gt;&lt;span class="lnt"&gt;54
&lt;/span&gt;&lt;span class="lnt"&gt;55
&lt;/span&gt;&lt;span class="lnt"&gt;56
&lt;/span&gt;&lt;span class="lnt"&gt;57
&lt;/span&gt;&lt;span class="lnt"&gt;58
&lt;/span&gt;&lt;span class="lnt"&gt;59
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;#34;sparse_solver_wrapper.h&amp;#34;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="n"&gt;VectorXd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;VectorXd&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="n"&gt;SparseMatrix&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;SparseSolverWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;compute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;visit&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="n"&gt;solver&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;SparseSolverWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;VectorXd&lt;/span&gt; &lt;span class="n"&gt;SparseSolverWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;solve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;VectorXd&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;visit&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;VectorXd&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;solve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="n"&gt;solver&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;bool&lt;/span&gt; &lt;span class="n"&gt;SparseSolverWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;visit&lt;/span&gt;&lt;span class="p"&gt;([](&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Success&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="n"&gt;solver&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;SparseSolverWrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rows&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cols&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;runtime_error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Sparse matrix is empty, cannot initialize sparse martix solver.&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#ifdef EIGEN_USE_MKL_ALL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;cout&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;Using MKL Pardiso solvers.&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;emplace&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;PardisoLDLT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Upper&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;emplace&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;PardisoLLT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Upper&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;()){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;cout&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;Using PardisoLLT solver.&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;emplace&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;PardisoLU&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;()){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;cout&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;Using PardisoLU solver.&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;emplace&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SimplicialLDLT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Upper&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;()){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;cout&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;Using Eigen SimplicialLDLT solver.&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;emplace&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SimplicialLLT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SparseMatrix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Upper&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;success&lt;/span&gt;&lt;span class="p"&gt;()){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;cout&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;Using Eigen SimplicialLLT solver.&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;runtime_error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;All solver methods failed to initialize.&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;看上去似乎没啥问题，但是如果你把以上代码用gcc编译成一个库，并启用mkl的话，在运行时就会报段错误。在gdb中，段错误的地方是&lt;code&gt;getenv.c&lt;/code&gt;，这是一个查找环境变量的函数，并且查找的环境变量名字还被去掉了头两个字母，我也不知道这两个字母是怎么没的，比如&lt;code&gt;INTEL_LIBITTNOTIFY64&lt;/code&gt;变成了&lt;code&gt;TEL_LIBITTNOTIFY64&lt;/code&gt;这种奇怪的名字。但是哪怕你手动设置了这两个环境变量，他还是会在这个地方报错。&lt;/p&gt;
&lt;p&gt;如果是用intel自家的icpx来编译的话，则会出现另一个问题，在调用&lt;code&gt;init&lt;/code&gt;后再使用&lt;code&gt;compute&lt;/code&gt;的时候，&lt;code&gt;solver&lt;/code&gt;内部的size变了，意思内存错误。&lt;/p&gt;
&lt;h2 id="解决方法"&gt;解决方法
&lt;/h2&gt;&lt;p&gt;如果连接的库使用了&lt;code&gt;EIGEN_USE_MKL_ALL&lt;/code&gt;这个宏，那么链接这个库的程序也要启用&lt;code&gt;EIGEN_USE_MKL_ALL&lt;/code&gt;这个宏，启用后就没问题了。具体大概率是头文件里的类型定义和实际编译的库里的类型不一致。&lt;/p&gt;
&lt;h2 id="其他问题"&gt;其他问题
&lt;/h2&gt;&lt;p&gt;后面我试图添加其他求解器时，发现不应该使用值传递，因为有些求解器不会复制矩阵而是保存矩阵的引用。&lt;/p&gt;
&lt;p&gt;在调用的时候我还发现，我在编译的时候加了&lt;code&gt;-march=native&lt;/code&gt;这个参数，回导致abi接口不一致，如果用了那么必须把这个参数也传给所有链接这个库的程序。&lt;/p&gt;
&lt;p&gt;后面在构建的过程中，我又发现求解器在调用pardiso求解稀疏矩阵的时候在重排序这一部分会有异常，具体表现为分解出来的L矩阵非零元非常多，几乎满了，进而导致内存占用过大。&lt;/p&gt;
&lt;p&gt;这个问题非常诡异，我以为是矩阵问题或者我写的warpper有问题。但是经过验证发现矩阵本身没有任何问题，把矩阵打印出来的可以在warpper的单测里正常求解。&lt;/p&gt;
&lt;p&gt;eigen内部对于pardiso的接口暴露的不够多，如果想要把pardiso的报错打开要么自己写个子类来改msglvl，要么去改eigen的源码。我决定还是直接去改eigen的源码实在一些，在对比最终的pardiso的调用后，我发现传入的参数一摸一样。但是求解在内部重排序的结果却不一样。&lt;/p&gt;
&lt;p&gt;我检查了ldd动态库链接路径，一致。最终发现有问题的程序还链接了gomp的实现，和iomp冲突了，可能就是这个导致了pardiso的内部数值问题。去掉gomp后就可以了。&lt;/p&gt;</description></item><item><title>《33号远征队》，法国人做的新时代jrpg</title><link>https://woodman3.github.io/p/33%E5%8F%B7%E8%BF%9C%E5%BE%81%E9%98%9F%E6%B3%95%E5%9B%BD%E4%BA%BA%E5%81%9A%E7%9A%84%E6%96%B0%E6%97%B6%E4%BB%A3jrpg/</link><pubDate>Sun, 22 Jun 2025 17:50:06 +0800</pubDate><guid>https://woodman3.github.io/p/33%E5%8F%B7%E8%BF%9C%E5%BE%81%E9%98%9F%E6%B3%95%E5%9B%BD%E4%BA%BA%E5%81%9A%E7%9A%84%E6%96%B0%E6%97%B6%E4%BB%A3jrpg/</guid><description>&lt;img src="https://woodman3.github.io/p/33%E5%8F%B7%E8%BF%9C%E5%BE%81%E9%98%9F%E6%B3%95%E5%9B%BD%E4%BA%BA%E5%81%9A%E7%9A%84%E6%96%B0%E6%97%B6%E4%BB%A3jrpg/132096500_p0.jpg" alt="Featured image of post 《33号远征队》，法国人做的新时代jrpg" /&gt;&lt;h2 id="玩前"&gt;玩前
&lt;/h2&gt;&lt;p&gt;每年的新品节和发布会都会有几部jrpg，但是法国人做的写实系画风jrpg听上去确实有点意思。而且从预告上来说ui有p系列的味道，剧情上也有异度之刃3的味道，从那时起，我就记下了这个游戏。&lt;/p&gt;
&lt;p&gt;游戏首发xgp，权衡之下我决定去充了个xgp会员，虚幻5引擎对于我的3060m来说，还是有些难顶。他和同样是虚幻5引擎的黑神话一样，在玩了一段时间后就会变卡，怀疑是垃圾回收没有做好。游玩的帧数体感上全程在30帧左右，偶尔调到15帧，这在战斗的qte判定的时候非常要命。我在玩的时候不止一次想：要不先换台好点的电脑再回来继续玩吧。于是我在618期间一直再看电脑配件而没在么玩，但是没等到自己想要的价格，所以618结束了我也没把电脑配上。但是我还是把顶着低帧率打通了，不得不感慨自己的适应能力。&lt;/p&gt;
&lt;h2 id="gameplay"&gt;gameplay
&lt;/h2&gt;&lt;p&gt;这游戏的战斗系统挺有意思，总共5个角色都有自己的特色系统和技能树，尤其是学妹的姿态切换不仅数值都和隔壁杀戮尖塔的观者一样，连强度也一样。让人不由得会心一笑。在回合制的同时还有这非常多的qte和弹反系统。三种弹反模式，后期小怪各种假动作和快慢刀，而且判定时间还短，虽然有意思，但是后期一个弹反断了就导致灭队的事情确实会人血压升高。得亏这游戏可以通过音乐的节奏来弹反，一定程度上降低了难度。但是初见杀还是非常难受（尤其是原色球童这个精英怪必须靠弹反来过，简直逆天）。游戏的战斗系统和战斗界面的ui非常像p5，甚至还有射击这一攻击模式，飞行怪得用射击来打非常讨厌。游戏前期还有通过射击来击破弱点造成大量伤害的设计，但是后期几乎就没有了。&lt;/p&gt;
&lt;p&gt;在怪物设计上，大部分小怪都要一个原色版本作为精英怪，这个原色版本有时候会在攻击模组和机制上有些调整，在第二章的末尾还会出一个污染的版本，除此之外没有别的换皮了，这种换皮还好，哪怕你知道他是换皮也无所谓了。而且怪物的种类也确实多。有些boss只能在支线遇到，这些boss在剧情还有着相当重要的作用。如果走主线的时候没打那会丢失不少信息和体验（当然某个18连斩的究极快慢刀boss那错过了就错了吧，这东西看着就不像人打的）。&lt;/p&gt;
&lt;p&gt;战斗上的符文设计挺不错的，但是符文在可以无限叠加，导致了在多周目下数值会爆炸，策划显然意识到了这一点，他们选择了一个非常逆天的方式来掩盖自己数值设计能力的不足——锁死你的伤害上限。坦白来说这种设计我几乎没怎么遇到过（只在碧蓝幻想里见过）。但是你不得不承认这种方式确实有效果，在第三章也是游戏快要结束的时候解锁了伤害上限。然后我见到了原来学妹的伤害居然如此离谱。boss连演出都没完就被我随便杀了。&lt;/p&gt;
&lt;p&gt;综合来说，游戏的战斗系统设计还是不错的，有深度，有交互，也有着叠数字的乐趣，比大部分jrpg都强。&lt;/p&gt;
&lt;p&gt;在等级设计上，能看到不少魂系游戏的影子，比如升级时的加点和洗点，武器会通过五维中的某两个来提高属性。比如血瓶和道具都像魂系里的血瓶一样可以通过休息回复。我觉得道具像血瓶一样的设计非常棒，他成功杜绝了玩家舍不得用道具的情况。如果他可以把道具的升级道具别藏在地图里或者需要通过跳跳乐才能取得就更好了。&lt;/p&gt;
&lt;p&gt;说起跑酷，我不明白为什么一个jrpg要有跳跳乐，简直神经病。尤其是某些符文你就是得需要通过跳跳乐来取得，得亏我没有什么全收集癖好并且他的跳跳乐仅存在于某些符文和道具上，主线的路上没有，不然这东西高低得把人逼疯。&lt;/p&gt;
&lt;p&gt;这游戏的地图上设计属于一本道模式，不会像魂系游戏那样给你整个捷径（但是我记得前面的地图有时候还是会有一些捷径设计，不多）。虽说是一本道，但是游戏还是有不少岔路的和环状结构的，同时因为没有地图而且地图设计上缺乏标志性的记忆物，而且jrpg的舔图模式和魂系游戏完全不同，导致很容易打完一场战斗后不知道路怎么走了。这点不太好。&lt;/p&gt;
&lt;p&gt;游戏的场景做的十分壮丽，也许是虚幻5的功劳，但是各种不重样的绝景确实让人感慨法国人搞艺术确实有一手。在华丽的光影特效和建模下，游戏的过程cg表现的相当不错。也许是因为看惯了二次元或者是cg中音乐差了点味道，我有点带入不进去。&lt;/p&gt;
&lt;p&gt;游戏也融合了魂的篝火设计，甚至连传火祭祀场的设计也搬过来了。说实话我并不反感，但是我不理解为什么营地必须在全局地图里才能用，这使得推图的过程中想要升级武器的话就会多花几步，制作者意识到了这个问题却把在篝火处回到营地的功能放到了游戏的中后场，难以理解。&lt;/p&gt;
&lt;h2 id="剧情"&gt;剧情
&lt;/h2&gt;&lt;p&gt;游戏的剧情有着不少的争议，有一个群友就告诉我，这游戏的剧情在打完司灯后就开始粪了。于是我在游玩的时候一直报着这游戏的剧情会怎么烂掉好奇心去推图。但是在打完那个boss后，不得不说确实是一个相当大的转折，但是说不上变糟糕。&lt;/p&gt;
&lt;p&gt;游戏的开局和会话非常简洁，在开头的半个小时就进入了游戏的主线远征，而且几乎没有口述世界观的情况，这也是我喜欢的，因为我认为好的叙事就应该剔除多余的东西，就像现代小说一样。然而简洁干练的叙事非常考验编剧的底蕴，（在这里点名批评绯红结系，一个能讲好的故事被编排的狗屁不通）并且容易被认为是谜语人。遗憾的是，33编剧的能力虽然算不上差，但是确实难以驾驭这种叙事方式。&lt;/p&gt;
&lt;p&gt;在游戏的剧情前期，还是非常王道的jrpg设计：踏上旅程，找齐队友，认识伙伴并探索世界。但是游戏整体的基调还是非常悲凉的，世界里的人在一定的岁数后就会死去，一代又一代的人们前仆后继的去挑战并为后人铺路，开局新手村一起上岸的队友们几乎死没了，这些都在强调这游戏整体压抑的基调，这一点上和异度之刃3非常像，我喜欢异度之刃3，自然也喜欢33。&lt;/p&gt;
&lt;p&gt;说时候前期的剧情还是有些无聊的，就是把队友找齐，但是并没有揭露世界观。虽然几个cg也确实暗示了后面会有大活发生。在进入中期，也就是第一章的末尾，男主壮烈牺牲了。对于男主牺牲并且更换主角这一点确实有不少争议，但是我是欣赏这种行为的，这么多年来jrpg在剧情上在结构上几乎没有什么大刀阔斧的革新，我很惊讶一个法国公司居然敢直接写死已经陪伴了玩家十个多小时的角色，（要知道异度之刃和p系列一般会写死的角色都不会能玩太久，因为投入的资源会浪费）而且还是主角，无论如何，这种勇气还是值得鼓励的。让一个在之前从来没出现过的角色来顶替死去的男主，继承他的资源和羁绊，不得不说确实是一个争议十分大的选择。我在此不想讨论男主是否该死，也不想讨论两个男主哪个的角色魅力更足，是否有牛头人情节等问题。因为我觉得这种讨论一般辨不出啥结果，剧情这种东西越辩越经不起推敲，不如好好沉浸进氛围里。&lt;/p&gt;
&lt;p&gt;男主的死亡虽然冲击力十足，但是还是在jrpg的范围内，按照传统jrpg的套路，剧情上应该开始逐渐揭露世界观，发现新的敌人，并开始反转了。但是编剧还在剧情上藏，诚然这确实为后面的反转做了铺垫，但是也让不少人诟病这是谜语人，我个人其实不喜欢谜语人这个形容词，但是不得不承认前文提到的简洁的叙事法则在此时暴露出了他的缺陷，就是这个剧情确实不太好懂，以至于在第三章的开头才通过回忆的方式，揭露最后的真相，从而把一切的来龙去脉讲明白。&lt;/p&gt;
&lt;p&gt;我虽然被提前剧透了男主会死亡，但是在游玩第二章的时候还是会猜想：也许男主后面会复活呢？也许杀死男主的就是未来的男主呢？幸好游戏并没有做这种循规蹈矩的剧情，男主确实是死了，死透了，没有一丝丝复活的可能。也正是因为男主的死亡，点名了游戏的题——远征。&lt;/p&gt;
&lt;p&gt;但是伴随着远征这个“题”，剧情上另一个让人诟病的一点也来了。从远征而开始的故事，在故事中一直渲染的远征的壮烈，无论前面远征队的遗言与尸体还是角色自己的父母故事，都在围绕远征这一个宏大而悲壮的主题。在第二章的结尾，33号远征队终于把他们的旗帜插在了历石之巅，然后太阳破晓，镜头拉远，在一开始就接近团灭的远征队终于完成了这么多年的远征，在一任又一任的前仆后继下达成了目标。如果故事就在此结束，那么这就是一个标准的王道故事，甚至可以说是写的非常出彩的、非常符合老中人传统价值观的王道故事。但是编剧不止于此，在远征队回家的路上，队员们看着彼此，既欢喜又迷茫——结束了吗？真的成功了吗？我们可以就这么回家了吗？是啊，学妹的谜题还么解开，计策人到底是谁还无人知晓，似乎还有不少问题没有答案，虽然情绪上我们似乎确实得到了满足，但是真的就这么结束了吗？&lt;/p&gt;
&lt;p&gt;并没有，于是第三章开始了，所有的谜题在此被揭开，世界其实是一幅画，这幅画之所以存在是因为一个家庭的悲剧（尽管这个悲剧的具体来龙去脉并没有讲）。于是原本宏大的远征的一切不过是因为上位维度的一件家庭悲剧。格局被缩小了，虽然他在逻辑上讲得通，但是大部分人还是不愿意买账。在故事的结尾，有两个选择，一个是选择毁了这幅画，也毁灭了这个世界，远征彻底失败，但是现实中的家庭就可以走出悲剧，重新面向未来。另一个选择是继续维持这幅画，远征得到成功，这个世界的几乎所有人都得到了happyend，但是现实中的妹妹永远被困在了画中，哥哥永远不得解脱，现实中的家庭依旧支离破碎，悲剧依旧在延续。&lt;/p&gt;
&lt;p&gt;这个游戏并没有好的结局，两个结局其实都是坏结局。也许是这个原因，剧情带了一些虚无主义的色彩，在我看来游戏剧情里有些虚无主义无可厚非，但是不少人讨厌这点。在传统王道爽文大行其道的今天，能看到这种剧情确实是一个惊喜。也许有的人认为现实世界已经足够糟糕了，在虚拟世界还给自己找不痛快是自讨无趣，但是也有人就是喜欢这种悲剧式的故事，比如我。&lt;/p&gt;</description></item><item><title>买cd，以及一些音乐的回忆</title><link>https://woodman3.github.io/p/%E4%B9%B0cd%E4%BB%A5%E5%8F%8A%E4%B8%80%E4%BA%9B%E9%9F%B3%E4%B9%90%E7%9A%84%E5%9B%9E%E5%BF%86/</link><pubDate>Sun, 08 Jun 2025 22:36:19 +0800</pubDate><guid>https://woodman3.github.io/p/%E4%B9%B0cd%E4%BB%A5%E5%8F%8A%E4%B8%80%E4%BA%9B%E9%9F%B3%E4%B9%90%E7%9A%84%E5%9B%9E%E5%BF%86/</guid><description>&lt;img src="https://woodman3.github.io/p/%E4%B9%B0cd%E4%BB%A5%E5%8F%8A%E4%B8%80%E4%BA%9B%E9%9F%B3%E4%B9%90%E7%9A%84%E5%9B%9E%E5%BF%86/131079127_p0.jpg" alt="Featured image of post 买cd，以及一些音乐的回忆" /&gt;&lt;h2 id="磁带收音机"&gt;磁带、收音机
&lt;/h2&gt;&lt;p&gt;我有记忆以来最早接触的储存音乐的介质应该是磁带。因为小学的外研社英语课本会附带一张磁带。&lt;/p&gt;
&lt;p&gt;于是每天在去学校前的早上，我妈会把磁带放到收音机，在短暂的读带声音后，收集机会慢吞吞的播放“unit 1&amp;hellip; ”，我妈认为这种潜移默化的听英语能提高我的英语成绩，奈何哪怕我在早上听了几千次“unit 1”，我的英语成绩还是不怎么样。磁带用起来很麻烦，如果想跳到特定的章节，要么用收音机上的倒带键，要么自己把磁带拿出来手动拧。至于拧多少才能到自己想要的章节，这得凭感觉，从某种意义上，我从小学开始就开始学习pid调节了。我家里并没有除了英语课文之外的其他磁带。有时候磁带会搅在一起，非常麻烦，就好像涂改带一样，一旦某一处开始搅在一起，后面的全部都会缠上，如果在解开磁带的过程把磁带上的铁粉刮到了，这个磁带就废了。&lt;/p&gt;
&lt;p&gt;家中的收音机看着也有了些年头，用着几块3号电池来供电。除了播放磁带之外，他还能播放cd。我妈偶尔还会用它来听新闻，收音机的上面有一个温度计一样的白色条带，一个红色的竖线指示着频道，通过两个旋钮来调节频道，一个转的快一个转的慢，调节频道的过程比磁带好一些，因为调节的过程有实时反馈。收音机还有一根可以收缩的金属天线，但根据记忆里的经验，这天线无论是否竖起来，指向哪儿，对收到广播的质量似乎都没收影响。收音机里叽里呱啦的说着粤语，很惭愧我作为一个广东人在听粤语这件事上还不如身为湖南人的妈妈。&lt;/p&gt;
&lt;p&gt;第一次搬家的时候，这个收音机被带到了新家继续履行这早上播放英语课文的职责。但是第二次搬家就没那么幸运了，这个收音机和那些英语磁带是送人了还是直接丢了，我就无从得知了。&lt;/p&gt;
&lt;h2 id="cddvd"&gt;CD、DVD
&lt;/h2&gt;&lt;p&gt;在我大概四年级或是三年级的时候，英语课本不再发磁带了，取之而代的是一张磁盘。我那时候不知道如何播放这个东西。英语老师向我演示了一下：把磁带放进电脑的光驱里，然后进入我的电脑，点开那个光驱图案，就会弹出一个窗口，在里面可以播放英语课文。当然也可以直接丢到收音机里面，甚至可以用快进键到下一个章节，非常方便。&lt;/p&gt;
&lt;p&gt;除了英语课文的cd外，还有信息课的教学cd，打开会有一个酷炫的flash窗口。现在回想起来信息课还有教flash动画的制作，而现在flash估摸已经再也见不到了。&lt;/p&gt;
&lt;p&gt;在以前去看电影的时候，电影院里面就有卖电影dvd和蓝光。在第一次搬家后，家里也有了电视和dvd播放器，但是dvd播放器不支持蓝光，dvd的价格比蓝光便宜不少，大概五六十一部，而蓝光就要贵不少了，一两百左右。家里以前买了不少dvd，哈利波特系列的几乎全都买了。但是大部分dvd都只看了一次就再也没看了，几十张dvd就这样放在了抽屉里，在第二次搬家的时候，这些dvd全部都送了人，至于送给了谁，我也不知道了。当然，dvd播放器和电视自然也没有了。&lt;/p&gt;
&lt;p&gt;家旁边有一家书店，书店的一楼就是卖cd和dvd的，但是几年后一楼就倒闭了，那应该是我最早接触到线下的实体卖碟的店，也是至今为止唯一一次。那家书店在几年后也倒闭了。我爹买了一些cd，但是买的是啥我都忘了，毕竟听的很少，而那时的我也不太喜欢听我爹听的歌。&lt;/p&gt;
&lt;h2 id="mp3"&gt;MP3
&lt;/h2&gt;&lt;p&gt;我的第一台mp3是2013年买的，那时的我大概还在上小学。我自己在苹果的官网上买了一台ipod shuffle，人名币三百八，包邮。选择在官网买是因为那时在官网买可以用激光写点东西，那时候的我刚刚接触编程，觉得“hello world“这个短语很有意思，于是在ipod上铭刻了”hello $(NAME)“。为什么选择iphone是因为那时候我刚刚看完《乔布斯传》，对于这台对于苹果公司如此重要的mp3非常感兴趣。&lt;/p&gt;
&lt;p&gt;买来的ipod用起来最麻烦的就是导歌。你需要用iTunes，那时的我一定想不到现在的iTunes界面和十几年前我用ipod导歌时候的界面差不多。使用iTunes只能把整个资料库同步上去，你想自己手动加歌？嘻嘻不行。那时候苹果的那种喜欢教用户做事的恶臭气息就已经溢出来了，十几年后还是没怎么改。虽然iTunes购买单曲的功能在国区用不了，但是我可以自己下歌导入iTunes。那时国内的音乐软件下歌还是朴素的mp3格式，没有现在防贼一样的加密格式。有时候用flac格式，但是itunes不支导入itunes，到现在还不支持。&lt;/p&gt;
&lt;p&gt;ipod没有歌单功能，每次切个自己想听的歌要么用顺序播放的模式切个半天，要么用随机播放的模式赌一把。虽然操作起来非常繁琐，但是我听的歌也不多（ipod也放不了多少歌）。这个ipod一直陪伴我到了高中。我在回老家或者写作业的时候就喜欢听ipod的歌。有一次过年回老家，在高速路上堵了20多个小时，靠着听歌硬撑了过来。也是这个ipod陪伴我度过了初中时无数个写作业的日夜。ipod有个语音提示歌名的功能，坦白来说这个功能在遇到一些中英文混杂的歌名时就没那么好用了，但对于这种迷你mp3来说还是有点用的。这个mp3的播放器是我见过所有播放器最小的，他甚至还没有现在某些手机的摄像头大。&lt;/p&gt;
&lt;p&gt;买ipod送了一个苹果的有线耳机。我戴过一段时间后非常讨厌苹果的耳机。我觉得苹果的所有入耳式耳机都是垃圾，戴起来非常不舒服，宣传的舒服都是放屁，这种连个套都没没有的塞子有舒适性就是放屁。我后面又换了个七十多的耳机，还试过把棉套换过，但是长时间佩戴的体验都不太好。戴久了耳朵里就会有积水。我上高中后给自己换了个头戴式耳机，换耳机是因为以前的塞子不仅戴着难受，而且因为是有线的，经常在写代码的时候被线绊到。新买的耳机是AKG的，但是戴起来也说不上多舒适，因为是压耳式的，这次购买耳机的经验告诉了我以后买耳机一定要先去线下试一下，而且如果戴着不舒服一定要果断退款，不能将就。但是我还是我戴了两年，期间为了好看还贴了fgo里黑贞和白贞的贴纸。&lt;/p&gt;
&lt;p&gt;听的歌越来越多，对于音质的需求也开始鬼鬼作祟。在高中同桌的介绍下，我买了新的mp3，山灵m0，也算是弥补了我以前想买ipod nano而没能买的遗憾。新的mp3只比老的大一圈左右。这个mp3陪伴我度过的整个高中生活，在晚自习偷偷戴头戴式耳机听音乐是鼓噪的高中生活为数不多的乐趣。我同桌一般喜欢把耳机线藏在袖口里，然后用另一只手撑着头听音乐。我试过几次，感觉体验不太好。虽然说学校是禁止戴耳机上晚自习的（什么傻逼规定），但是任何不执行的规定都与摆设无异。我就这么光明正大的直接把头戴式耳机戴上，老师问起我我就说班里晚自习太吵了。在高三之前我还会收敛一些，确认班主任不在办公室了才戴起耳机，高三后我就无所谓了，有一次班主任严厉的批评我这种行为，说如果谁可以考班级第一谁就可以在自习课上听歌，然后我就考了班级第一，但是老师还是不让我这么干，唉。&lt;/p&gt;
&lt;p&gt;新的mp3导歌十分方便，直接把歌放到sd卡里的文件夹就行。续航上也足够五天的晚自习，实在不够还有充电宝续命，甚至可以偷偷放到讲台下的插座充电。于是我每周回家都会看看下点新歌放mp3里，或者给mp3换个壁纸。有时候甚至在课间直接用学校的电脑操作，相当刺激。&lt;/p&gt;
&lt;h2 id="手机和电脑"&gt;手机和电脑
&lt;/h2&gt;&lt;p&gt;用电脑听歌从很早以前就开始了。早到我忘记了具体的年月。一开始用qq音乐，为了听某些歌我还冲了绿钻。后来不知道是什么时候，网易云音乐火了起来，准确来说，是网易云音乐的评论功能火了起来。那个时候丧文化大行其道，评论区里的老哥老姐一个个都挺有意思。有时候网易云会推一些只有几十个评论的歌给我。会有一种发现了宝藏的惊喜感。但是网易云音乐没有周杰伦的歌，这点很坏。&lt;/p&gt;
&lt;p&gt;一开始时，我也不知道该听啥歌，只知道周杰伦很火就一直听他的歌。切换到网易云后日推给我拓展了不少视野，我逐渐开始喜欢听电音和欧美的流行乐，尤为喜欢在写作业的时候边写边听。fatrat、alanwalker这些音乐人制作人在那时相当火爆（前者知道的可能少一些），Ed sheeran，OneRepublic。Chainsmoker也是顶流的歌手，路边的小店都在放他们的歌。&lt;/p&gt;
&lt;p&gt;但是时间久了这类节奏感比较强的音乐开始不适合在写作业的时候听，恰好我也开始上起了b站，于是日语流行和动漫配乐也加入了我喜爱的行列。开始听起了egoist，amier，米津玄师等。几年过去了，egoist毕业了，剩下两个的作品也开始乏味和公式化，没啥意思。&lt;/p&gt;
&lt;p&gt;但是音乐还是会在我写作业的时候对我的思路产生一定的干扰，于是我开始尝试着去听纯音乐和古典，那些烂大街的如雅尼、okawari这种就不说了网易云总是会给我推一些非常小众的纯音乐或者配乐，大部分名字都叫不出，最后都烂在了网易云的收藏夹里。&lt;/p&gt;
&lt;p&gt;在听的歌越来越多时，网易云这个音乐软件也越来越臃肿。官方开始注意到评论区非常受欢迎，先是吧一些热门的评论用在地铁上的广告上，后来开始在音乐软件里搞社区，甚至开始在里头卖货。不仅如此，会员下载的歌曲也变成了私有格式，需要自己找工具转为flac。而且某些专辑甚至要额外付费，比如《天气之子》的ost，周杰伦的歌依旧没有。总的来说，这个软件越做越烂。&lt;/p&gt;
&lt;p&gt;虽然网易云做的一坨屎，但是qq也好不到哪儿去，我无差别的厌恶着腾讯的所有产品，忽然，我发现apple music 在安卓手机上也可以使用，每个月的会员费甚至还便宜一些（网易12元，am只要10元）。而且am的ui设计非常干净。在高三寒假期间，因为长期在家学习的需要，也因为疫情延长了寒假，我决定彻底倒向am。&lt;/p&gt;
&lt;p&gt;也就是在接触am开始，我才开始试着整张专辑的听。在此之前我一般只把热门的歌曲组成歌单，几乎不系统性的去听一整张专辑，am的资料库的设计让我会先去听专辑。同时，am对于听古典的人来说非常友好，起码他不会像网易云一样把巴赫的古典乐放在孕妇养胎曲里面。am对于歌手也有专门的编辑精选和必听，电台和推荐都不错。但是也不是没有缺陷，比如国区的曲库贫乏，jpop里头罗马音和英语混用导致找不到歌，没有歌词翻译，在pc端的体验一坨狗屎，以前只能在itunes上听，现在有了am专用客户端好了一些，但是网络上还是有问题。&lt;/p&gt;
&lt;p&gt;但是总的来说，am的体验确实在比烂大赛上脱颖而出，更何况大学生使用am还要学生特惠，我也一直用am直到了今天。 随着am使用的时间越来越长，我也开始察觉到am里一些奇特的事，有时候am会把一些歌提前放出来，比如塞壬音乐给高考生做的高考结束曲会先于其他流媒体几小时放出来，原因可能事塞壬那边的失误。有时候am会把你资料库的歌一声不响的下架，这点我实在无法忍受，网易云那边下架了还会有歌灰色的歌名，你可以去其他用户的云台听，但是am下架是没有任何征兆的，你甚至不知道他下架了。在这之前我曾经把万青的二专加入了资料库，但是有一天他莫名其妙的没有了，直到今天都没有重新上，令人疑惑。&lt;/p&gt;
&lt;h2 id="直到今天"&gt;直到今天
&lt;/h2&gt;&lt;p&gt;前段时间，我在网上预订了mujica的专辑，这应该是我的第一张专辑，到货后，我发现自己家里并没有cd机，买了个飞傲的m13后，我又开始想着买其他专辑或自己刻碟了。
有一些歌是不会上架音乐软件的，比如一些翻唱，或者爱好者自己制作的同人音乐，这些歌也许有一天就消失了，所以把他们整理起来保存到本地是个好主意。如果刻录成光盘的话，也能带给我一种虚无缥缈的拥有感。我喜欢这种感觉，哪怕虚无飘渺。&lt;/p&gt;
&lt;p&gt;cd的音质好吗？不见得，44.1kHz/16bit的格式已经定死了，网上的无损资源理论上是可以超越cd的，只不过无良流媒体可能会给你压缩或者搞假无损。cd的保存年限更长吗？也不见得，数据保存的最好方法是多存几份，而不是想法设法的在介质上下功夫。cd更方便吗？那更是扯蛋，用过的都知道不太可能。&lt;/p&gt;
&lt;p&gt;唱片市场的衰弱并非没有理由。电子书会取代纸质书，流媒体会取代光盘，数字版会取代卡带。虽然说世界范围内cd的销售额在减少，但是令人惊奇的是中国的唱片市场却在增长，在美国黑胶甚至迎来了第二春。同时，数字专辑的日子也不好过，它在短暂的迎来一个高峰后又回去了，这可能和流媒体的兴起有不小的关系。&lt;/p&gt;
&lt;p&gt;我还是想买cd，我害怕，人们似乎习惯了数字媒介，但是似乎从来没意识数字媒介在使用上的便利也伴随着失去他的便利。如果没有有意识的去做备份，那么流媒体的运营商只要下架了歌，你再想听就得花老大的劲去找资源，更何况在私有格式盛行的当下，你哪怕做好了备份也不一定能听。莫名其妙被下架的歌和视频在互联网上早就已经不是什么新鲜事。&lt;/p&gt;
&lt;p&gt;比起下架更糟糕的情况是音乐本身还在，但是已经被修改了。音乐上发生这种事可能比较少，但是b站上的视频换源那可就一抓一大把。游戏上也会更新版本让你无法体会到原版的游戏，比如魂类游戏会在版本升级的时候更改武器的数值甚至boss的难度，还有已经在天国的寂静岭 p.t。&lt;/p&gt;
&lt;p&gt;数字媒介的稳定看似牢不可破，嗯，看上去。在亚马逊关闭国服kindle商店的时候我也是这么想的。我曾经在上面买了不少正版电纸书，国服商店关闭后，用户只能手动把自己买的书下载下来，在有限的时间内，以后想下也下不了了。&lt;/p&gt;
&lt;p&gt;流媒体是伴随着互联网出现的，他出现的时间可能不到20年，我们却把他的存在当作理所当然，好像永远不会倒下。但是万物都有沉寂的一天，天涯论坛会关闭，3ds的网上商店会关闭，亚马逊的国区也会关闭。也许我们在他们关闭之前可以把一切都下载回本地，但是那些与之相伴的回忆却会永远的消失，也许这就是我想买cd和卡带的原因吧，让回忆依附在实体媒介上，仅此而已。&lt;/p&gt;
&lt;h2 id="附录"&gt;附录
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a class="link" href="https://finance.sina.com.cn/wm/2024-06-11/doc-inaykuxr1929576.shtml" target="_blank" rel="noopener"
&gt;中国唱片市场（2024）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://gloriousnoise.com/2025/data-2024-total-music-sales-and-streams" target="_blank" rel="noopener"
&gt;美国唱片和数字专辑市场&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>龙格库塔法的稳定性分析</title><link>https://woodman3.github.io/p/%E9%BE%99%E6%A0%BC%E5%BA%93%E5%A1%94%E6%B3%95%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%88%86%E6%9E%90/</link><pubDate>Tue, 03 Jun 2025 15:48:33 +0800</pubDate><guid>https://woodman3.github.io/p/%E9%BE%99%E6%A0%BC%E5%BA%93%E5%A1%94%E6%B3%95%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%88%86%E6%9E%90/</guid><description>&lt;img src="https://woodman3.github.io/p/%E9%BE%99%E6%A0%BC%E5%BA%93%E5%A1%94%E6%B3%95%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%88%86%E6%9E%90/9db1a0eeea60e9f7d3c1e234a5d61b0f1741301.jpg" alt="Featured image of post 龙格库塔法的稳定性分析" /&gt;&lt;h2 id="单步法的稳定性"&gt;单步法的稳定性
&lt;/h2&gt;&lt;h3 id="基本概念"&gt;基本概念
&lt;/h3&gt;&lt;p&gt;考虑一阶常微分方程的初值问题：&lt;/p&gt;
$$\frac{dy}{dt} = f(t, y), \quad y(t_0) = y_0$$&lt;p&gt;对于线性测试方程：&lt;/p&gt;
$$\frac{dy}{dt} = \lambda y, \quad y(0) = 1$$&lt;p&gt;其精确解为 $y(t) = e^{\lambda t}$。&lt;/p&gt;
&lt;h3 id="绝对稳定性"&gt;绝对稳定性
&lt;/h3&gt;&lt;p&gt;设数值解为 $y_n \approx y(t_n)$，则单步法可以写成：&lt;/p&gt;
$$y_{n+1} = R(h\lambda) y_n$$&lt;p&gt;其中 $R(h\lambda)$ 称为&lt;strong&gt;增长因子&lt;/strong&gt;或&lt;strong&gt;放大因子&lt;/strong&gt;，$h$ 是步长。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;定义&lt;/strong&gt;：如果 $|R(h\lambda)| \leq 1$，则称该方法在 $h\lambda$ 处是绝对稳定的。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;稳定域&lt;/strong&gt;：使得 $|R(h\lambda)| \leq 1$ 的复平面上的区域 $S = \{z \in \mathbb{C} : |R(z)| \leq 1\}$。&lt;/p&gt;
&lt;h3 id="常见方法的增长因子"&gt;常见方法的增长因子
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;显式欧拉法&lt;/strong&gt;：$R(z) = 1 + z$&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;隐式欧拉法&lt;/strong&gt;：$R(z) = \frac{1}{1-z}$&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;梯形法&lt;/strong&gt;：$R(z) = \frac{1+z/2}{1-z/2}$&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="四阶龙格库塔法和增长因子"&gt;四阶龙格库塔法和增长因子
&lt;/h2&gt;&lt;h3 id="经典四阶龙格库塔法"&gt;经典四阶龙格库塔法
&lt;/h3&gt;&lt;p&gt;经典的四阶龙格库塔法（RK4）为：&lt;/p&gt;
$$\begin{align}
k_1 &amp;= hf(t_n, y_n) \\
k_2 &amp;= hf(t_n + h/2, y_n + k_1/2) \\
k_3 &amp;= hf(t_n + h/2, y_n + k_2/2) \\
k_4 &amp;= hf(t_n + h, y_n + k_3) \\
y_{n+1} &amp;= y_n + \frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)
\end{align}$$&lt;h3 id="rk4的增长因子"&gt;RK4的增长因子
&lt;/h3&gt;&lt;p&gt;对于测试方程 $y' = \lambda y$，RK4的增长因子为：&lt;/p&gt;
$$R(z) = 1 + z + \frac{z^2}{2} + \frac{z^3}{6} + \frac{z^4}{24}$$&lt;p&gt;其中 $z = h\lambda$。&lt;/p&gt;
&lt;h3 id="稳定域分析"&gt;稳定域分析
&lt;/h3&gt;&lt;p&gt;RK4的稳定域由不等式 $|R(z)| \leq 1$ 确定。通过数值计算可以得到：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;plt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 网格设置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;linspace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;800&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;linspace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;800&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;meshgrid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;Y&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# RK4 稳定性函数&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;R&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Z&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Z&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Z&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Z&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 稳定区域：|R(z)| &amp;lt; 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contourf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;levels&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contour&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;levels&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;black&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;RK4 Stability Region&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;Re(z)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;Im(z)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gca&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_aspect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;equal&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;grid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E9%BE%99%E6%A0%BC%E5%BA%93%E5%A1%94%E6%B3%95%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%88%86%E6%9E%90/output_7_0.png"
width="435"
height="454"
srcset="https://woodman3.github.io/p/%E9%BE%99%E6%A0%BC%E5%BA%93%E5%A1%94%E6%B3%95%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%88%86%E6%9E%90/output_7_0_hu_bd5160b18a1aedaf.png 480w, https://woodman3.github.io/p/%E9%BE%99%E6%A0%BC%E5%BA%93%E5%A1%94%E6%B3%95%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%88%86%E6%9E%90/output_7_0_hu_5ab71112484cd781.png 1024w"
loading="lazy"
alt="png"
class="gallery-image"
data-flex-grow="95"
data-flex-basis="229px"
&gt;&lt;/p&gt;
&lt;p&gt;边界值大概为2.78左右。&lt;/p&gt;
&lt;h2 id="在有限元中的应用"&gt;在有限元中的应用
&lt;/h2&gt;&lt;h3 id="时间离散化"&gt;时间离散化
&lt;/h3&gt;&lt;p&gt;在有限元方法中求解抛物型偏微分方程时，空间离散化后得到常微分方程组：&lt;/p&gt;
$$\frac{d\mathbf{u}}{dt} = \mathbf{A}\mathbf{u} + \mathbf{f}(t)$$&lt;p&gt;其中 $\mathbf{A}$ 是刚度矩阵，通常具有负的特征值。&lt;/p&gt;
&lt;h3 id="稳定性要求"&gt;稳定性要求
&lt;/h3&gt;&lt;p&gt;设 $\mathbf{A}$ 的特征值为 $\lambda_i$，则稳定性要求：&lt;/p&gt;
$$h \max_i |\lambda_i| \leq \text{稳定域边界}$$&lt;p&gt;对于RK4，这意味着：&lt;/p&gt;
$$h \leq \frac{2.78}{|\lambda_{\max}|}$$&lt;p&gt;当矩阵 $\mathbf{A}$ 具有很大的负特征值时（刚性问题），RK4需要非常小的时间步长才能保持稳定，这会导致计算效率低下。&lt;/p&gt;
&lt;h2 id="参考文献"&gt;参考文献
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;以下文件由chatgpt给出，我并不保证文献的有效&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;Hairer, E., Nørsett, S. P., &amp;amp; Wanner, G. (1993). &lt;em&gt;Solving Ordinary Differential Equations I: Nonstiff Problems&lt;/em&gt;. Springer.&lt;/li&gt;
&lt;li&gt;Butcher, J. C. (2016). &lt;em&gt;Numerical Methods for Ordinary Differential Equations&lt;/em&gt;. Wiley.&lt;/li&gt;
&lt;li&gt;Hughes, T. J. R. (2000). &lt;em&gt;The Finite Element Method: Linear Static and Dynamic Finite Element Analysis&lt;/em&gt;. Dover Publications.&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>家常菜的记忆</title><link>https://woodman3.github.io/p/%E5%AE%B6%E5%B8%B8%E8%8F%9C%E7%9A%84%E8%AE%B0%E5%BF%86/</link><pubDate>Mon, 28 Apr 2025 15:18:06 +0800</pubDate><guid>https://woodman3.github.io/p/%E5%AE%B6%E5%B8%B8%E8%8F%9C%E7%9A%84%E8%AE%B0%E5%BF%86/</guid><description>&lt;img src="https://woodman3.github.io/p/%E5%AE%B6%E5%B8%B8%E8%8F%9C%E7%9A%84%E8%AE%B0%E5%BF%86/11de52fc2746322ab51d0f2c01a787841741301.jpg" alt="Featured image of post 家常菜的记忆" /&gt;&lt;p&gt;家中喜欢做鱼，原因是我爹听说吃鱼能让孩子变聪明，一直喜欢日本货的老爹天天念叨日本人这么聪明就是因为日本人喜欢吃鱼。因此我小时候经常吃鱼，我也喜欢吃鱼。老爹做鱼对鱼是否新鲜特别看重，一般他回去菜市场看看，如果有新鲜的，就会买几条回来料理。鱼身上除了鱼肉外，鱼肚、鱼肝和鱼蛋都是我喜欢吃的，所以老爹会特别嘱咐杀鱼的人别把这些内脏丢了。也许是从小吃鱼的原因，或者是我吃的都是海鱼而没吃过河鱼，所以我一直不明白鱼腥味为何物。&lt;/p&gt;
&lt;p&gt;家里常做的一道鱼是“大眼鸡”，这种鱼是海鱼，皮红，眼睛大，肉质比较紧实。一般先把油加热，然后把整条鱼放入锅里，然后加点水把锅盖盖上。一会后揭开锅盖然后加上些葱花就可以出锅了。这鱼做好后刺虽然硬但是少，肉紧所以好夹起来。一层红皮该在鱼肉上，可以很轻松的揭开。鱼汤咸度恰好，特别适合拌饭吃。鱼眼像果冻一样，我每次吃这鱼都喜欢把两个鱼眼睛夹走，我爹说吃啥补啥，但是我吃了这么多鱼眼睛却还把眼睛糟蹋成了今天这个样子，惭愧。&lt;/p&gt;
&lt;p&gt;另一道常做的鱼是“黄花鱼”，做法和大眼鸡类似，这鱼的肉质软糯，有时候夹不起来，我爹就会取笑我筷子使得不好。这道鱼的鱼腹相当肥美，我喜欢连带着鳔一起吃。&lt;/p&gt;
&lt;p&gt;除了这两外，有时候还会做马鲛鱼，我爹一般把他叫“马糕鱼”，这种鱼一般不会整条做，而是切成一段一段的下锅炒，因为腹部没有刺，所以我特别喜欢吃鱼肚。鱼肚软嫩可口，肥而不腻。除此之外，因为切成了一段一段，刺也很容易吐出来。有时候还会有鱼蛋，这个可比鱼肚还稀有。虽说其他的鱼也有鱼蛋，但是这鱼的鱼蛋量大，吃起来爽。&lt;/p&gt;
&lt;p&gt;鲳鱼也是常吃的，鲳鱼又分金鲳、黑鲳、银鲳。但是我吃的时候总是分不清，因为分不明白这些鱼叫啥，我爸也会因此取笑我。这鱼做的就更加简单了，加点油直接丢锅里蒸就是，二十分钟后出锅加点葱花酱油就好了。吃前要用筷子插一下来判断熟了没有。因为做法太过简单，我妈特别喜欢做，有时候甚至我妈想出去打牌，就吩咐我自己做这道鱼来吃。&lt;/p&gt;
&lt;p&gt;当然还有其他鱼，但是我不记得名字了。所幸我还记得形状和味道。除了鱼之外，家常菜都比较清淡。就肉类而言，我爹不太喜欢猪肉，认为猪肉脏。所以猪肉一般和其他蔬菜一起炒或者用来煲汤之外，很少作为单独的一道菜，但是也不是没有例外，小时候会买些粉肠和猪肝，和菠菜煮熟和捞出来吃。我妈喜欢做猪肉丸子，把猪肉做成丸子后裹上一层糯米蒸会后就好了，还有就是梅菜肉饼，所以我小时候也会帮忙去剁肉馅。&lt;/p&gt;
&lt;p&gt;家里最常吃的就是鸡了，广东最出名的白切鸡就不多谈了。有时候鸡还会切块一起和胡萝卜一起焖煮。我喜欢这道菜，因为我听说吃胡萝卜可以补充维生素a，而维生素a对眼睛好。鸡肉切好后也可以直接下火锅，加了药材的清汤火锅再下完鸡后会好喝不少。鸡夹起后凉会蘸酱油吃，清淡而好吃。&lt;/p&gt;
&lt;p&gt;除此之外，鸡会用来煲汤，买来的乌鸡加些药材，放炖盅里要炖很长一段时间。炖鸡汤时还要讲究放盐的时间，虽然我一直不明白为啥放盐的时间还有讲究。我妈总是让我在一个固定的时间提醒她去放盐，或者关火，有时候她去打牌了，放盐和关火就由我来港干。我妈说这件事的时候总是要再三交代，好像这个鸡汤是天下头等大事，哪怕这个鸡汤最后大部分都是我喝的。因为炖的时间长，哪怕是我妈下班回家后就开始煲汤，等到能喝上的时候，也是晚上九十点了。我为此讨厌喝鸡汤，倒不是因为鸡汤不好喝，而是因为我喝到的时候已经很晚了，鸡汤还是好喝的。我高中的时候，开始怀疑这个鸡汤除了让我长瞟之外没啥其他特殊营养。为此多次告诉我妈没必要浪费钱去煲这个鸡汤，无果。有时候鸡汤喝不完，就会留给第二天下面吃，我一直觉得鸡汤面没啥味道，而且大早上的吃不了多少东西，一直不喜欢吃这面。&lt;/p&gt;
&lt;p&gt;烧鹅也是一道印象深刻的菜。但是这显然不是家里可以做的。烧鹅需要到专门的店里买，一般来说，如果爹妈懒得做菜，就会买半边烧鹅来吃。烧鹅蘸上酸梅酱特别下饭，脆皮下藏着一层肥美的脂肪。以前不知道这东西就是自己胖成球的罪魁祸首，只知道特别好吃。烧鹅买来应该直接吃完，一旦留到下一餐的话再加热，皮下的油流走了，就没那么香了。但是半边烧鹅终究还是太多了，如果我一个人吃的话显然吃不完，但是如果是一家人的话那也不会只吃烧鹅，肯定还有别的，所以烧鹅总是吃不完。而且老爹一直不信任外面做的菜，哪怕是经常吃的烧鹅，所以吃的没那么多。&lt;/p&gt;
&lt;p&gt;家中做牛肉的方法比较单调，除了下火锅之外，就是切成薄片后配上生姜直接炒。炒出来的牛肉都是黑色的，一层粉一样的东西。但是吃起来还是不错的，在嘴里特别有嚼劲。有一段时间单位发了不少冻牛排，我就自己来做牛排吃，平底锅放点油之后煎熟便是。回想到这我发现自己在糊弄肚子方面的天赋似乎从小就有了。&lt;/p&gt;
&lt;p&gt;各类海鲜也总是会出现在家中的餐桌上，花螺、花甲、海虾、鱿鱼。如果我爹去菜市场时看到新鲜的就会买些回来，这些做起来都简单，煮下蘸酱油就可以吃了。鱿鱼有时候会加上番茄酱炒来吃。有时候老爹还会把虾皮和鸡蛋拌一起做鸡蛋羹，老爹认为虾皮可以补钙，多吃钙就可以长高，现在来看自己的身高感觉吃了似乎也没啥太多用。螃蟹出现的少，一般只有节假日吃些好的才会出现。&lt;/p&gt;
&lt;p&gt;但是大餐也不是每天都有的，有时候爹妈都有自己的事，那我就得自己做点东西糊口了，除了前面提到的煎牛排外，我曾经买了一箱乌冬面，如果爹妈不在就拆一包乌冬面丢锅里煮开，捞出来拌上送的xo酱应付了事，我爹妈总是说这么吃没营养，但是这样确实方便。有时候再自己做些午餐肉、豆豉鱼罐头或者炒两个蛋，倒也不错。&lt;/p&gt;
&lt;p&gt;我爹在蛋炒饭上也是一把好手。蛋炒饭除了蛋外，一般还可能会加牛肉、菜叶、剥好的虾、花甲之类。做出来的豪华蛋炒饭相当好吃，我一个人可以吃完一大盘。但是蛋炒饭备菜还是太过麻烦，所以做得少。这类备菜麻烦的菜还有一道就是酿豆腐，需要把剁好的肉馅、剥好的虾塞进豆腐里，这样做出来的酿豆腐鲜香可口，非常好吃。&lt;/p&gt;
&lt;p&gt;除了鱼肉之外，家中的蔬菜一般都是青菜、白菜、葫芦瓜，萝卜，豆角，番茄，茄子。青菜的菜苔非常干脆可口，配合点酱油就可以了。白菜加点猪肉煮煮就行，葫芦瓜和萝卜一般会切片后和猪肉一起炒。豆角会切成很细的小段，像臊子一样和猪肉碎一起炒，然后一起拌饭。番茄都是配鸡蛋。茄子有时是用煮的，有时是用炒的。&lt;/p&gt;
&lt;p&gt;我初中毕业后搬了家，老爹失业了。高二的时候搬了第二次家，老爹也会了老家，新的地方有三家人要公用一个厨房，做起菜来非常麻烦，而且我一般在学校食堂吃饭，在家吃饭也少了。&lt;/p&gt;
&lt;p&gt;大学时，我在河北上学，虽然学校所处的地方时沿海城市，但是吃的海鲜和鱼都很少。而且饭菜也和广东菜相差甚远。我大三时在校外租房子过暑假时（学校的宿舍没有空调，住不下去）试着自己做了些菜，在父母的指导下，多少也能把记忆中的味道还原个七八分出来。后来和舍友交流厨艺才发现，原来自己从小到大吃的居然都是如此清淡。&lt;/p&gt;
&lt;p&gt;直到今天我工作了，到了合肥。合肥的名菜臭鳜鱼并不合我口味，我还是更喜欢海鱼。宿舍里没有厨房，做不了饭。有一次我妈来合肥看我，给我买了一个电饭煲，下班回家后也能用电饭煲做些菜来，想不到小小的电饭煲也能做出这么多东西。但是我妈也是顺路来看我，几天后我妈就回去了，但是我到现在还在试着用电饭煲在周末煲点汤、煮面或者做些蒸菜。我还买了个蒸汽炸锅，做些烤肉，蛋挞挺不错的。&lt;/p&gt;
&lt;p&gt;我从合肥回一趟家需要做高铁到深圳，然后转到老家的城市，在下火车站后还要打私家车。这一趟下来最少也要花十个小时，所以我一般也只在过年才回一趟家。&lt;/p&gt;
&lt;p&gt;五一了，想念家里的菜了。&lt;/p&gt;</description></item><item><title>有限元中的微积分</title><link>https://woodman3.github.io/p/%E6%9C%89%E9%99%90%E5%85%83%E4%B8%AD%E7%9A%84%E5%BE%AE%E7%A7%AF%E5%88%86/</link><pubDate>Wed, 16 Apr 2025 16:56:01 +0800</pubDate><guid>https://woodman3.github.io/p/%E6%9C%89%E9%99%90%E5%85%83%E4%B8%AD%E7%9A%84%E5%BE%AE%E7%A7%AF%E5%88%86/</guid><description>&lt;img src="https://woodman3.github.io/p/%E6%9C%89%E9%99%90%E5%85%83%E4%B8%AD%E7%9A%84%E5%BE%AE%E7%A7%AF%E5%88%86/110985955_p0.png" alt="Featured image of post 有限元中的微积分" /&gt;&lt;p&gt;这个公式被gpt称作Dirichlet积分公式,但是我用搜索引擎搜不到这个公式的具体名字,那么我也就这么叫他好了，gpt总不会骗我吧(&lt;/p&gt;
&lt;h2 id="dirichlet积分公式"&gt;Dirichlet积分公式
&lt;/h2&gt;&lt;p&gt;计算积分：
&lt;/p&gt;
$$
I = \int_T L_1^a L_2^b L_3^c L_4^d \, dL_1dL_2dL_3,
$$&lt;p&gt;
其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;$T$ 是三维标准四面体；&lt;/li&gt;
&lt;li&gt;$L_1, L_2, L_3, L_4$ 是体积坐标（$L_1 + L_2 + L_3 + L_4 = 1$）；&lt;/li&gt;
&lt;li&gt;$a, b, c, d$ 是非负整数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在体积坐标下，积分区域为：
&lt;/p&gt;
$$
L_1 \in [0,1], \quad L_2 \in [0,1-L_1], \quad L_3 \in [0,1-L_1-L_2].
$$&lt;p&gt;
因此积分变为：
&lt;/p&gt;
$$
I = \int_0^1 \int_0^{1-L_1} \int_0^{1-L_1-L_2} L_1^a L_2^b L_3^c (1-L_1-L_2-L_3)^d \, dL_3 \, dL_2 \, dL_1.
$$&lt;p&gt;&lt;strong&gt;对 $L_3$ 积分&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设 $u = \frac{L_3}{1-L_1-L_2}$，则 $L_3 = u(1-L_1-L_2)$，$dL_3 = (1-L_1-L_2)du$：
&lt;/p&gt;
$$
\int_0^{1-L_1-L_2} L_3^c (1-L_1-L_2-L_3)^d \, dL_3 = (1-L_1-L_2)^{c+d+1} \int_0^1 u^c (1-u)^d \, du.
$$&lt;p&gt;
利用 &lt;strong&gt;Beta 函数&lt;/strong&gt;：
&lt;/p&gt;
$$
\int_0^1 u^c (1-u)^d \, du = B(c+1, d+1) = \frac{c! \, d!}{(c+d+1)!}.
$$&lt;p&gt;&lt;strong&gt;对 $L_2$ 积分&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;将剩余部分写为：
&lt;/p&gt;
$$
I = \frac{c! \, d!}{(c+d+1)!} \int_0^1 \int_0^{1-L_1} L_1^a L_2^b (1-L_1-L_2)^{c+d+1} \, dL_2 \, dL_1.
$$&lt;p&gt;
再次变量替换 $v = \frac{L_2}{1-L_1}$，类似可得：
&lt;/p&gt;
$$
\int_0^{1-L_1} L_2^b (1-L_1-L_2)^{c+d+1} \, dL_2 = (1-L_1)^{b+c+d+2} \frac{b! \, (c+d+1)!}{(b+c+d+2)!}.
$$&lt;p&gt;&lt;strong&gt;对 $L_1$ 积分&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;最终积分简化为：
&lt;/p&gt;
$$
I = \frac{c! \, d!}{(c+d+1)!} \frac{b! \, (c+d+1)!}{(b+c+d+2)!} \int_0^1 L_1^a (1-L_1)^{b+c+d+2} \, dL_1.
$$&lt;p&gt;
利用 Beta 函数：
&lt;/p&gt;
$$
\int_0^1 L_1^a (1-L_1)^{b+c+d+2} \, dL_1 = \frac{a! \, (b+c+d+2)!}{(a+b+c+d+3)!}.
$$&lt;p&gt;将所有部分组合：
&lt;/p&gt;
$$
I = \frac{c! \, d!}{(c+d+1)!} \cdot \frac{b! \, (c+d+1)!}{(b+c+d+2)!} \cdot \frac{a! \, (b+c+d+2)!}{(a+b+c+d+3)!}.
$$&lt;p&gt;
约简后得到 &lt;strong&gt;Dirichlet 积分公式&lt;/strong&gt;：
&lt;/p&gt;
$$
I = \frac{a! \, b! \, c! \, d!}{(a+b+c+d+3)!}.
$$&lt;p&gt;推广到其他维度&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;二维三角形&lt;/strong&gt;：分母为 $(a+b+c+2)!$，分子为$a! \, b! \, c!$。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;$n$ 维单纯形&lt;/strong&gt;：分母为 $(\sum a_i + n)!$，分子类似&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="从笛卡尔坐标到体积坐标的变换"&gt;从笛卡尔坐标到体积坐标的变换
&lt;/h2&gt;&lt;p&gt;四面体上的拉格朗日基函数变换到体积坐标下会带来不少便利.举个例子,我们需要计算以下积分&lt;/p&gt;
$$
\tag{1}
I = \int \phi_i \ \phi_j dV
$$&lt;p&gt;我们可以把任意构建任意四面体到标准四面体的变换,于是变换后的积分变成了&lt;/p&gt;
$$
I = 6V \int_T N_i \ N_j \ dV_L
$$&lt;p&gt;其中$N_i$为形函数,至于为什么&amp;hellip;说实话我也写不出一个严谨的证明.而雅可比矩阵行列式的值恰好等于这个四面体的体积乘6,这也十分直观,因为标准四面体的体积就是$1/6$&lt;/p&gt;
&lt;p&gt;当然有时候也不会那么自然,比如你需要计算对基函数求梯度的积分,比如这样:&lt;/p&gt;
$$
\tag{2}
I = \int \nabla \phi_i \cdot \nabla \phi_j dV
$$&lt;p&gt;需要注意,这里的求梯度运算是在笛卡尔坐标系下对$xyz$求梯度的,当变换到标准四面体下时,显然不可能再对原本的坐标系下求梯度,对于体积坐标求梯度才是我们想要的,于是有了&lt;/p&gt;
$$
\nabla \phi_i = J^{-1} \nabla N_i
$$&lt;p&gt;原积分变为&lt;/p&gt;
$$
I = |det J| \int_T \nabla N_i^T J^{-T} J^{-1} \nabla N_j \ dV_L
$$&lt;p&gt;再来考虑另一种情况:我们需要在四面体上的某一面上进行面积分,形式如下:&lt;/p&gt;
$$
\tag{3}
I = \int_S \phi_i \ \phi_j dS
$$&lt;p&gt;如果基函数取值为1的点不再我们要积分的三角形内,那么显然基函数在这个三角形上的取值全为0.因为基函数在三角形的三个顶点上的取值都为0,而三角形的其他区域上的点可以表示为顶点坐标的线性组合.所以我们只需要关注在这个三角形上有取值为1的点的基函数即可.&lt;/p&gt;
&lt;p&gt;当我们把这些基函数变换到标准三角形上时,基函数也变为了三角形的形函数.至于为什么变换成立,其严谨的证明过程我也写不出来&amp;hellip;尽管这个变换非常符合直觉.除此之外,我们还需要注意:当我们把三维的三角形变换到二维的三角形上时,变换矩阵并不是一个方阵,这意味着我们不能直接求解其行列式.回忆一下微积分方面的知识,我们可以计算缩放因子.因为标准三角形的面积为$1/2$,所以缩放因子恰为$2A$,这是显然的.所以原式变为&lt;/p&gt;
$$
I = 2A\int_{S_L} N_i \ N_j dS_L
$$&lt;h2 id="实例二阶基"&gt;实例:二阶基
&lt;/h2&gt;&lt;p&gt;一阶线性基的情况过于简单,在此不表&lt;/p&gt;
&lt;p&gt;我们的三维二阶基函数如下所示&lt;/p&gt;
$$
\phi = a_0 + a_1x + a_2y+a_3z+a_4x^2+a_5xy+a_6xz+a_7y^2+a_8yz+a_9z^2
$$&lt;p&gt;其顶点和中点的形函数如下
&lt;/p&gt;
$$
N_i = L_i(2L_i-1)
$$$$
N_{ij}=4L_iL_j
$$&lt;p&gt;我们去求解方程(1),其结果表示为矩阵在如下所示&lt;/p&gt;
$$
M = \frac{6 \cdot \text{volume}}{2520}
\begin{bmatrix}
6 &amp; 1 &amp; 1 &amp; 1 &amp; -4 &amp; -4 &amp; -4 &amp; -6 &amp; -6 &amp; -6 \\
1 &amp; 6 &amp; 1 &amp; 1 &amp; -4 &amp; -6 &amp; -6 &amp; -4 &amp; -4 &amp; -6 \\
1 &amp; 1 &amp; 6 &amp; 1 &amp; -6 &amp; -4 &amp; -6 &amp; -4 &amp; -6 &amp; -4 \\
1 &amp; 1 &amp; 1 &amp; 6 &amp; -6 &amp; -6 &amp; -4 &amp; -6 &amp; -4 &amp; -4 \\
-4 &amp; -4 &amp; -6 &amp; -6 &amp; 32 &amp; 16 &amp; 16 &amp; 16 &amp; 16 &amp; 8 \\
-4 &amp; -6 &amp; -4 &amp; -6 &amp; 16 &amp; 32 &amp; 16 &amp; 16 &amp; 8 &amp; 16 \\
-4 &amp; -6 &amp; -6 &amp; -4 &amp; 16 &amp; 16 &amp; 32 &amp; 8 &amp; 16 &amp; 16 \\
-6 &amp; -4 &amp; -4 &amp; -6 &amp; 16 &amp; 16 &amp; 8 &amp; 32 &amp; 16 &amp; 16 \\
-6 &amp; -4 &amp; -6 &amp; -4 &amp; 16 &amp; 8 &amp; 16 &amp; 16 &amp; 32 &amp; 16 \\
-6 &amp; -6 &amp; -4 &amp; -4 &amp; 8 &amp; 16 &amp; 16 &amp; 16 &amp; 16 &amp; 32 \\
\end{bmatrix}
$$&lt;p&gt;方程(3)的结果如下所示(忽略了零元)&lt;/p&gt;
$$
K = \frac{2 \cdot \text{area}}{360}
\begin{bmatrix}
6 &amp; -1 &amp; -1 &amp; 0 &amp; 0 &amp; -4 \\
-1 &amp; 6 &amp; -1 &amp; 0 &amp; -4 &amp; 0 \\
-1 &amp; -1 &amp; 6 &amp; -4 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; -4 &amp; 32 &amp; 16 &amp; 16 \\
0 &amp; -4 &amp; 0 &amp; 16 &amp; 32 &amp; 16 \\
-4 &amp; 0 &amp; 0 &amp; 16 &amp; 16 &amp; 32 \\
\end{bmatrix}
$$&lt;p&gt;部分计算代码如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt; 10
&lt;/span&gt;&lt;span class="lnt"&gt; 11
&lt;/span&gt;&lt;span class="lnt"&gt; 12
&lt;/span&gt;&lt;span class="lnt"&gt; 13
&lt;/span&gt;&lt;span class="lnt"&gt; 14
&lt;/span&gt;&lt;span class="lnt"&gt; 15
&lt;/span&gt;&lt;span class="lnt"&gt; 16
&lt;/span&gt;&lt;span class="lnt"&gt; 17
&lt;/span&gt;&lt;span class="lnt"&gt; 18
&lt;/span&gt;&lt;span class="lnt"&gt; 19
&lt;/span&gt;&lt;span class="lnt"&gt; 20
&lt;/span&gt;&lt;span class="lnt"&gt; 21
&lt;/span&gt;&lt;span class="lnt"&gt; 22
&lt;/span&gt;&lt;span class="lnt"&gt; 23
&lt;/span&gt;&lt;span class="lnt"&gt; 24
&lt;/span&gt;&lt;span class="lnt"&gt; 25
&lt;/span&gt;&lt;span class="lnt"&gt; 26
&lt;/span&gt;&lt;span class="lnt"&gt; 27
&lt;/span&gt;&lt;span class="lnt"&gt; 28
&lt;/span&gt;&lt;span class="lnt"&gt; 29
&lt;/span&gt;&lt;span class="lnt"&gt; 30
&lt;/span&gt;&lt;span class="lnt"&gt; 31
&lt;/span&gt;&lt;span class="lnt"&gt; 32
&lt;/span&gt;&lt;span class="lnt"&gt; 33
&lt;/span&gt;&lt;span class="lnt"&gt; 34
&lt;/span&gt;&lt;span class="lnt"&gt; 35
&lt;/span&gt;&lt;span class="lnt"&gt; 36
&lt;/span&gt;&lt;span class="lnt"&gt; 37
&lt;/span&gt;&lt;span class="lnt"&gt; 38
&lt;/span&gt;&lt;span class="lnt"&gt; 39
&lt;/span&gt;&lt;span class="lnt"&gt; 40
&lt;/span&gt;&lt;span class="lnt"&gt; 41
&lt;/span&gt;&lt;span class="lnt"&gt; 42
&lt;/span&gt;&lt;span class="lnt"&gt; 43
&lt;/span&gt;&lt;span class="lnt"&gt; 44
&lt;/span&gt;&lt;span class="lnt"&gt; 45
&lt;/span&gt;&lt;span class="lnt"&gt; 46
&lt;/span&gt;&lt;span class="lnt"&gt; 47
&lt;/span&gt;&lt;span class="lnt"&gt; 48
&lt;/span&gt;&lt;span class="lnt"&gt; 49
&lt;/span&gt;&lt;span class="lnt"&gt; 50
&lt;/span&gt;&lt;span class="lnt"&gt; 51
&lt;/span&gt;&lt;span class="lnt"&gt; 52
&lt;/span&gt;&lt;span class="lnt"&gt; 53
&lt;/span&gt;&lt;span class="lnt"&gt; 54
&lt;/span&gt;&lt;span class="lnt"&gt; 55
&lt;/span&gt;&lt;span class="lnt"&gt; 56
&lt;/span&gt;&lt;span class="lnt"&gt; 57
&lt;/span&gt;&lt;span class="lnt"&gt; 58
&lt;/span&gt;&lt;span class="lnt"&gt; 59
&lt;/span&gt;&lt;span class="lnt"&gt; 60
&lt;/span&gt;&lt;span class="lnt"&gt; 61
&lt;/span&gt;&lt;span class="lnt"&gt; 62
&lt;/span&gt;&lt;span class="lnt"&gt; 63
&lt;/span&gt;&lt;span class="lnt"&gt; 64
&lt;/span&gt;&lt;span class="lnt"&gt; 65
&lt;/span&gt;&lt;span class="lnt"&gt; 66
&lt;/span&gt;&lt;span class="lnt"&gt; 67
&lt;/span&gt;&lt;span class="lnt"&gt; 68
&lt;/span&gt;&lt;span class="lnt"&gt; 69
&lt;/span&gt;&lt;span class="lnt"&gt; 70
&lt;/span&gt;&lt;span class="lnt"&gt; 71
&lt;/span&gt;&lt;span class="lnt"&gt; 72
&lt;/span&gt;&lt;span class="lnt"&gt; 73
&lt;/span&gt;&lt;span class="lnt"&gt; 74
&lt;/span&gt;&lt;span class="lnt"&gt; 75
&lt;/span&gt;&lt;span class="lnt"&gt; 76
&lt;/span&gt;&lt;span class="lnt"&gt; 77
&lt;/span&gt;&lt;span class="lnt"&gt; 78
&lt;/span&gt;&lt;span class="lnt"&gt; 79
&lt;/span&gt;&lt;span class="lnt"&gt; 80
&lt;/span&gt;&lt;span class="lnt"&gt; 81
&lt;/span&gt;&lt;span class="lnt"&gt; 82
&lt;/span&gt;&lt;span class="lnt"&gt; 83
&lt;/span&gt;&lt;span class="lnt"&gt; 84
&lt;/span&gt;&lt;span class="lnt"&gt; 85
&lt;/span&gt;&lt;span class="lnt"&gt; 86
&lt;/span&gt;&lt;span class="lnt"&gt; 87
&lt;/span&gt;&lt;span class="lnt"&gt; 88
&lt;/span&gt;&lt;span class="lnt"&gt; 89
&lt;/span&gt;&lt;span class="lnt"&gt; 90
&lt;/span&gt;&lt;span class="lnt"&gt; 91
&lt;/span&gt;&lt;span class="lnt"&gt; 92
&lt;/span&gt;&lt;span class="lnt"&gt; 93
&lt;/span&gt;&lt;span class="lnt"&gt; 94
&lt;/span&gt;&lt;span class="lnt"&gt; 95
&lt;/span&gt;&lt;span class="lnt"&gt; 96
&lt;/span&gt;&lt;span class="lnt"&gt; 97
&lt;/span&gt;&lt;span class="lnt"&gt; 98
&lt;/span&gt;&lt;span class="lnt"&gt; 99
&lt;/span&gt;&lt;span class="lnt"&gt;100
&lt;/span&gt;&lt;span class="lnt"&gt;101
&lt;/span&gt;&lt;span class="lnt"&gt;102
&lt;/span&gt;&lt;span class="lnt"&gt;103
&lt;/span&gt;&lt;span class="lnt"&gt;104
&lt;/span&gt;&lt;span class="lnt"&gt;105
&lt;/span&gt;&lt;span class="lnt"&gt;106
&lt;/span&gt;&lt;span class="lnt"&gt;107
&lt;/span&gt;&lt;span class="lnt"&gt;108
&lt;/span&gt;&lt;span class="lnt"&gt;109
&lt;/span&gt;&lt;span class="lnt"&gt;110
&lt;/span&gt;&lt;span class="lnt"&gt;111
&lt;/span&gt;&lt;span class="lnt"&gt;112
&lt;/span&gt;&lt;span class="lnt"&gt;113
&lt;/span&gt;&lt;span class="lnt"&gt;114
&lt;/span&gt;&lt;span class="lnt"&gt;115
&lt;/span&gt;&lt;span class="lnt"&gt;116
&lt;/span&gt;&lt;span class="lnt"&gt;117
&lt;/span&gt;&lt;span class="lnt"&gt;118
&lt;/span&gt;&lt;span class="lnt"&gt;119
&lt;/span&gt;&lt;span class="lnt"&gt;120
&lt;/span&gt;&lt;span class="lnt"&gt;121
&lt;/span&gt;&lt;span class="lnt"&gt;122
&lt;/span&gt;&lt;span class="lnt"&gt;123
&lt;/span&gt;&lt;span class="lnt"&gt;124
&lt;/span&gt;&lt;span class="lnt"&gt;125
&lt;/span&gt;&lt;span class="lnt"&gt;126
&lt;/span&gt;&lt;span class="lnt"&gt;127
&lt;/span&gt;&lt;span class="lnt"&gt;128
&lt;/span&gt;&lt;span class="lnt"&gt;129
&lt;/span&gt;&lt;span class="lnt"&gt;130
&lt;/span&gt;&lt;span class="lnt"&gt;131
&lt;/span&gt;&lt;span class="lnt"&gt;132
&lt;/span&gt;&lt;span class="lnt"&gt;133
&lt;/span&gt;&lt;span class="lnt"&gt;134
&lt;/span&gt;&lt;span class="lnt"&gt;135
&lt;/span&gt;&lt;span class="lnt"&gt;136
&lt;/span&gt;&lt;span class="lnt"&gt;137
&lt;/span&gt;&lt;span class="lnt"&gt;138
&lt;/span&gt;&lt;span class="lnt"&gt;139
&lt;/span&gt;&lt;span class="lnt"&gt;140
&lt;/span&gt;&lt;span class="lnt"&gt;141
&lt;/span&gt;&lt;span class="lnt"&gt;142
&lt;/span&gt;&lt;span class="lnt"&gt;143
&lt;/span&gt;&lt;span class="lnt"&gt;144
&lt;/span&gt;&lt;span class="lnt"&gt;145
&lt;/span&gt;&lt;span class="lnt"&gt;146
&lt;/span&gt;&lt;span class="lnt"&gt;147
&lt;/span&gt;&lt;span class="lnt"&gt;148
&lt;/span&gt;&lt;span class="lnt"&gt;149
&lt;/span&gt;&lt;span class="lnt"&gt;150
&lt;/span&gt;&lt;span class="lnt"&gt;151
&lt;/span&gt;&lt;span class="lnt"&gt;152
&lt;/span&gt;&lt;span class="lnt"&gt;153
&lt;/span&gt;&lt;span class="lnt"&gt;154
&lt;/span&gt;&lt;span class="lnt"&gt;155
&lt;/span&gt;&lt;span class="lnt"&gt;156
&lt;/span&gt;&lt;span class="lnt"&gt;157
&lt;/span&gt;&lt;span class="lnt"&gt;158
&lt;/span&gt;&lt;span class="lnt"&gt;159
&lt;/span&gt;&lt;span class="lnt"&gt;160
&lt;/span&gt;&lt;span class="lnt"&gt;161
&lt;/span&gt;&lt;span class="lnt"&gt;162
&lt;/span&gt;&lt;span class="lnt"&gt;163
&lt;/span&gt;&lt;span class="lnt"&gt;164
&lt;/span&gt;&lt;span class="lnt"&gt;165
&lt;/span&gt;&lt;span class="lnt"&gt;166
&lt;/span&gt;&lt;span class="lnt"&gt;167
&lt;/span&gt;&lt;span class="lnt"&gt;168
&lt;/span&gt;&lt;span class="lnt"&gt;169
&lt;/span&gt;&lt;span class="lnt"&gt;170
&lt;/span&gt;&lt;span class="lnt"&gt;171
&lt;/span&gt;&lt;span class="lnt"&gt;172
&lt;/span&gt;&lt;span class="lnt"&gt;173
&lt;/span&gt;&lt;span class="lnt"&gt;174
&lt;/span&gt;&lt;span class="lnt"&gt;175
&lt;/span&gt;&lt;span class="lnt"&gt;176
&lt;/span&gt;&lt;span class="lnt"&gt;177
&lt;/span&gt;&lt;span class="lnt"&gt;178
&lt;/span&gt;&lt;span class="lnt"&gt;179
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Tetra10&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="n"&gt;TetraBase&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;public&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;basis&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Tetra10&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;TetraBase&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;topRows&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;vertices_h&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c1"&gt;// return 1 x y z x^2 xy xz y^2 yz z^2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;vertices_h&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;basis&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices_h&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transpose&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="n"&gt;inverse&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;Tetra10&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;compute_element_mass_matrix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Tetra10&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;integrate_on_tetra&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;basis&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;basis&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;phi_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;phi_j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;phi_i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;phi_j&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;M&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rho&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;capacity&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;compute_stiffness_matrix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Tetra10&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;K_e&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;K_e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setZero&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;integrate_on_tetra&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;basis&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;basis&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;dx_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;dy_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;dz_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;dx_j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;dy_j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;dz_j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dx_i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;dx_j&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;dy_i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;dy_j&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;dz_i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;dz_j&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nf"&gt;kappa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;K_e&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;K_e&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;test_mass_matrix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;tetra&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;compute_element_mass_matrix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tetra&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;/=&lt;/span&gt; &lt;span class="n"&gt;tetra&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;volume&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;mat&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mat&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mat&lt;/span&gt; &lt;span class="o"&gt;*=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;2520.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="mf"&gt;1e-20&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;cout&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;mass matrix test failed!&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;cout&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="s"&gt;&amp;#34; &amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;mat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;test_stiffness_matrix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;tetra&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Eigen&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;compute_stiffness_matrix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tetra&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;cout&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;test_robin_boundary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Tetra10&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;Triangle6&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;MatrixXd&lt;/span&gt; &lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;VectorXd&lt;/span&gt; &lt;span class="n"&gt;F&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;threshold&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;1e-10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;k_e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;integrate_on_triangle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;basis&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;basis&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;phi_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;phi_j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_j&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;phi_i&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;phi_j&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k_e&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;threshold&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;k_e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;coeffRef&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;k_e&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;f_e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;integrate_on_triangle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;basis&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;phi_i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b_i&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;phi_i&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f_e&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;threshold&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;f_e&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;F&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;coeffRef&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;f_e&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;K&lt;/span&gt; &lt;span class="o"&gt;/=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;area&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;F&lt;/span&gt; &lt;span class="o"&gt;/=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;area&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;cout&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;K&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;cout&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;F&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rho&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;capacity&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;kappa&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;q_args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Q_Exp_Args&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Matrix&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;topRows&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;nextRow&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// 从第5行开始填充
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// 注意：初始化了前4行，应遍历到3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nextRow&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Tetra10&lt;/span&gt; &lt;span class="n"&gt;tetra&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;MatrixXd&lt;/span&gt; &lt;span class="n"&gt;tri_vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;tri_vertices&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;cout&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;tri_vertices&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Triangle6&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tri_vertices&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;test_load_vector&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tetra&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;test_robin_boundary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tetra&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>有限元中的数值积分</title><link>https://woodman3.github.io/p/%E6%9C%89%E9%99%90%E5%85%83%E4%B8%AD%E7%9A%84%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86/</link><pubDate>Tue, 18 Mar 2025 16:48:15 +0800</pubDate><guid>https://woodman3.github.io/p/%E6%9C%89%E9%99%90%E5%85%83%E4%B8%AD%E7%9A%84%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86/</guid><description>&lt;img src="https://woodman3.github.io/p/%E6%9C%89%E9%99%90%E5%85%83%E4%B8%AD%E7%9A%84%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86/GkIr6doaAAMJNYZ.jpg" alt="Featured image of post 有限元中的数值积分" /&gt;&lt;p&gt;我使用的数值积分方法是高斯勒让德积分，后面全文的所有内容都是基于这种积分方法的。这种积分如何计算在此就略过不表了。&lt;/p&gt;
&lt;h2 id="一些映射"&gt;一些映射
&lt;/h2&gt;&lt;h3 id="从标准三角形到上的映射"&gt;从标准三角形到$[-1,1]^2$上的映射
&lt;/h3&gt;&lt;h4 id="方法-1"&gt;方法 1
&lt;/h4&gt;&lt;p&gt;从基函数部分开始，对于一个标准三角形表面，我们定义 $f(\xi_1, \xi_2)$，并希望计算其在三角形上的数值积分 $I$：
&lt;/p&gt;
$$
I = \int_{\mathbb K_{i,k}} f (\mathbf x) \mathrm d \mathbf x
= \int_0^1 \mathrm d \xi_1 \int_0^{1-\xi_1} f(\xi_1, \xi_2) \mathrm d \xi_2,
$$&lt;p&gt;
现在我们需要使用求积公式来计算该积分：
&lt;/p&gt;
$$
I = \sum_{m=1}^{N} c_m f(\xi_{1,m}, \xi_{2,m}),
$$&lt;p&gt;
其中，$c_m$ 是与特定点 $(\xi_{1,m}, \xi_{2,m})$ 相关的权重，$N$ 代表所需精度对应的关键点的数量。&lt;/p&gt;
&lt;p&gt;该积分 $I$ 可以通过变量替换变换为单位方形区域 $\{(\eta_1, \eta_2) \ | \ 0 \leq \eta_1,\ \eta_2 \leq 1\}$ 上的积分：
&lt;/p&gt;
$$
\xi_1 = \eta_1, \quad \xi_2 = (1-\eta_1)\eta_2.
$$&lt;p&gt;此时，雅可比行列式的行列式和微元面积为：
&lt;/p&gt;
$$
\frac{\partial (\xi_1, \xi_2)}{\partial (\eta_1, \eta_2)} = \frac{\partial \xi_1}{\partial \eta_1} \frac{\partial \xi_2}{\partial \eta_2} - \frac{\partial \xi_1}{\partial \eta_2}\frac{\partial \xi_2}{\partial \eta_1} = 1 - \eta_1,
$$&lt;p&gt;
以及
&lt;/p&gt;
$$
\mathrm d \xi_1 \mathrm d \xi_2 = \frac{\partial (\xi_1, \xi_2)}{\partial (\eta_1, \eta_2)} \mathrm d \eta_1 d \eta_2 = (1 - \eta_1) \mathrm d \eta_1 \mathrm d \eta_2.
$$&lt;p&gt;因此，可以得到：
&lt;/p&gt;
$$
\int_0^{1}\int_0^{1-\xi_1} f(\xi_1, \xi_2) \mathrm d \xi_2 \mathrm d \xi_1 = \int_0^1 \int_0^1 f(\eta_1, (1-\eta_1)\eta_2) (1 - \eta_1) \mathrm d \eta_1 \mathrm d \eta_2.
$$&lt;p&gt;进一步通过变量替换转换到标准单位正方形 $\{(\zeta_1, \zeta_2) \ | \ -1 \leq \zeta_1, \zeta_2 \leq 1\}$ 上：
&lt;/p&gt;
$$
\eta_1 = (1 + \zeta_1) /2, \quad \eta_2 = (1 + \zeta_2) / 2,
$$&lt;p&gt;
于是，雅可比行列式和微元面积变为：
&lt;/p&gt;
$$
\frac{\partial (\eta_1, \eta_2)}{\partial (\zeta_1, \zeta_2)} = (1/2)(1/2) - (0)(0)= 1/4,
$$&lt;p&gt;
以及
&lt;/p&gt;
$$
\mathrm d \eta_1 \mathrm d \eta_2 = \frac{1}{4}\mathrm d \zeta_1 \mathrm d \zeta_2.
$$&lt;p&gt;最终得到：
&lt;/p&gt;
$$
\begin{align*}
I &amp; = \int_0^{1}\int_0^{1-\xi_1} f(\xi_1, \xi_2) \mathrm d \xi_2 \mathrm d \xi_1 = \int_0^1 \int_0^1 f(\eta_1, (1-\eta_1)\eta_2) (1-\eta_1) \mathrm d \eta_1 \mathrm d \eta_2, \\
&amp; = \int_{-1}^1\int_{-1}^1 f\left(\frac{1 + \zeta_1}{2}, \frac{(1-\zeta_1)(1+\zeta_2)}{4}\right)\left(\frac{1 - \zeta_1}{8}\right) \mathrm d \zeta_1 \mathrm d \zeta_2.
\end{align*}
$$&lt;p&gt;最终，积分计算可以表示为：
&lt;/p&gt;
$$
I = \sum_{i=1}^{\alpha}\sum_{j=1}^{\beta} W_{1,i} W_{2,j} f\left(\frac{1+\zeta_{1,i}}{2}, \frac{(1-\zeta_{1,i})(1+\zeta_{2,j})}{4}\right)\left(\frac{1-\zeta_{1,j}}{8}\right) ,
$$&lt;p&gt;
其中，$\zeta_{1,i}$ 和 $\zeta_{2,j}$ 分别为 $\zeta_1$ 和 $\zeta_2$ 方向上的高斯积分点，$W_{1,i}$ 和 $W_{2,j}$ 是对应的权重。&lt;/p&gt;
&lt;p&gt;积分公式可以进一步重写为：
&lt;/p&gt;
$$
I = \sum_{m=1}^{N= (\alpha)\times (\beta)}c_m f(\xi_{1,m},\xi_{2,m}),
$$&lt;p&gt;
其中，
&lt;/p&gt;
$$
c_m = W_{1,i} W_{2,j} \left(\frac{1-\zeta_{1,j}}{8}\right), \quad \xi_{1,m}=\frac{1+\zeta_{1,i}}{2}, \quad \xi_{2,m} = \frac{(1-\zeta_{1,i})(1+\zeta_{2,j})}{4}.
$$&lt;h4 id="方法-2"&gt;方法 2
&lt;/h4&gt;&lt;p&gt;通过变量替换：
&lt;/p&gt;
$$
\xi_1 = \eta_1 \eta_2, \quad \xi_2 = (1-\eta_1)\eta_2,
$$&lt;p&gt;
将积分转换为单位正方形上：
&lt;/p&gt;
$$
\int_0^{1}\int_0^{1-\xi_1} f(\xi_1, \xi_2) \mathrm d \xi_2 \mathrm d \xi_1 = \int_0^1 \int_0^1 f(\eta_1 \eta_2, (1-\eta_1)\eta_2) \eta_2 \mathrm d \eta_1 \mathrm d \eta_2.
$$&lt;p&gt;进一步转换到标准正方形：
&lt;/p&gt;
$$
\eta_1 = (1 + \zeta_1) /2, \quad \eta_2 = (1 + \zeta_2) / 2,
$$&lt;p&gt;
最终积分计算可以表示为：
&lt;/p&gt;
$$
I = \sum_{i=1}^{m}\sum_{j=1}^{n} W_{1,i} W_{2,j} f\left(\frac{(1+\zeta_{1,i})(1+\zeta_{2,j})}{4}, \frac{(1-\zeta_{1,i})(1+\zeta_{2,j})}{4}\right)\left(\frac{1+\zeta_{2,j}}{8}\right).
$$&lt;p&gt;最终，积分公式可以重写为：
&lt;/p&gt;
$$
I = \sum_{k=1}^{N=m\times n}c_k f(\xi_{1,k},\xi_{2,k}),
$$&lt;p&gt;
其中：
&lt;/p&gt;
$$
c_k = W_{1,i} W_{1,j} \left(\frac{1+\zeta_{2,j}}{8}\right), \quad \xi_{1,k}=\frac{(1+\zeta_{1,i})(1+\zeta_{2,j})}{4},\ \xi_{2,k} = \frac{(1-\zeta_{1,i})(1+\zeta_{2,j})}{4}.
$$&lt;h3 id="从标准四面体到上的映射"&gt;从标准四面体到$[-1,1]^3$上的映射
&lt;/h3&gt;&lt;h4 id="方法-1-1"&gt;方法 1
&lt;/h4&gt;&lt;p&gt;从基函数部分开始，我们有 $f(\xi_1, \xi_2, \xi_3)$，目标是计算其在标准四面体上的数值积分 $I$：
&lt;/p&gt;
$$
I = \int_{\mathbb K_{i,k}} f (\mathbf x) \mathrm d \mathbf x
= \int_0^1 \mathrm d \xi_2 \int_0^{1-\xi_2} d \xi_1\int_0^{1 - \xi_1 - \xi_2} f(\xi_1, \xi_2, \xi_3) \mathrm d \xi_3。
$$&lt;p&gt;然后，我们希望使用求积公式求出该积分的值：
&lt;/p&gt;
$$
I = \sum_{m=1}^N c_m f(\xi_{1,m}, \xi_{2,m}, \xi_{3,m}),
$$&lt;p&gt;
其中，$c_m$ 是与采样点 $(\xi_{1,m}, \xi_{2,m}, \xi_{3,m})$ 相关联的权重，$N$ 是与所需精度相关的关键点的数量。&lt;/p&gt;
&lt;p&gt;积分 $I$ 可以通过变量替换转换为单位立方体上的积分：$\{(\eta_1, \eta_2, \eta_3) \ | \ 0 \leq \eta_1, \eta_2, \eta_3 \leq 1\}$，变量替换如下：
&lt;/p&gt;
$$
\xi_1 = \eta_1, \quad \xi_2 = \eta_2 (1 - \eta_1), \quad \xi_3 = \eta_3 (1 - \eta_1) (1 - \eta_2)。
$$&lt;p&gt;雅可比行列式的行列式以及微分面积为：
&lt;/p&gt;
$$
\frac{\partial (\xi_1, \xi_2, \xi_3)}{\partial (\eta_1, \eta_2, \eta_3)} =
\begin{bmatrix}
\frac{\partial \xi_1}{\partial \eta_1} &amp; \frac{\partial \xi_1}{\partial \eta_2} &amp; \frac{\partial \xi_1}{\partial \eta_3} \\
\frac{\partial \xi_2}{\partial \eta_1} &amp; \frac{\partial \xi_2}{\partial \eta_2} &amp; \frac{\partial \xi_2}{\partial \eta_3} \\
\frac{\partial \xi_3}{\partial \eta_1} &amp; \frac{\partial \xi_3}{\partial \eta_2} &amp; \frac{\partial \xi_3}{\partial \eta_3}
\end{bmatrix} = (1 - \eta_1)^2 (1 - \eta_2)，
$$&lt;p&gt;
以及
&lt;/p&gt;
$$
\mathrm d \xi_1 \, \mathrm d \xi_2 \, \mathrm d \xi_3 = (1 - \eta_1)^2 (1 - \eta_2) \, \mathrm d \eta_1 \, \mathrm d \eta_2 \, \mathrm d \eta_3。
$$&lt;p&gt;因此，我们可以将积分 $I$ 变换为：
&lt;/p&gt;
$$
I = \int_0^1 \int_0^1 \int_0^1 f \Big( \eta_1, \eta_2 (1 - \eta_1), \eta_3 (1- \eta_1) (1 - \eta_2) \Big) ( 1 - \eta_1)^2 ( 1 - \eta_2) \, \mathrm d \eta_3 \, \mathrm d \eta_2 \, \mathrm d \eta_1。
$$&lt;p&gt;进一步地，积分 $I$ 可以转换为标准立方体 $\{(\zeta_1, \zeta_2, \zeta_3) \ | \ -1 \leq \zeta_1, \zeta_2, \zeta_3 \leq 1 \}$ 上的积分，变量替换如下：
&lt;/p&gt;
$$
\eta_1 = \frac{1 + \zeta_1}{2}, \quad \eta_2 = \frac{1 + \zeta_2}{2}, \quad \eta_3 = \frac{1 + \zeta_3}{2}。
$$&lt;p&gt;雅可比行列式的行列式及微分面积为：
&lt;/p&gt;
$$
\frac{\partial (\eta_1, \eta_2, \eta_3)}{\partial (\zeta_1, \zeta_2, \zeta_3)} = \frac{1}{8}，
$$&lt;p&gt;
&lt;/p&gt;
$$
\mathrm d \eta_1 \, \mathrm d \eta_2 \, \mathrm d \eta_3 = \frac{1}{8} \, \mathrm d \zeta_1 \, \mathrm d \zeta_2 \, \mathrm d \zeta_3。
$$&lt;p&gt;最终积分表达式为：
&lt;/p&gt;
$$
I = \int_{-1}^1 \int_{-1}^1 \int_{-1}^1 f\left(\frac{(1 + \zeta_1)}{2}, \frac{(1 + \zeta_2)(1 - \zeta_1)}{4}, \frac{(1+\zeta_3)(1-\zeta_1)(1-\zeta_2)}{8}\right) \frac{(1 - \zeta_1)^2(1 - \zeta_2)}{64} \, \mathrm d \zeta_1 \, \mathrm d \zeta_2 \, \mathrm d \zeta_3。
$$&lt;p&gt;高效的求积系数可以从文献中获取，以满足所需精度。&lt;/p&gt;
&lt;p&gt;最终积分可表示为：
&lt;/p&gt;
$$
I = \sum_{i=1}^\alpha \sum_{j=1}^\beta \sum_{k=1}^\gamma W_{1,i} W_{2,j} W_{3,k} \frac{(1 - \zeta_{1,i})^2 (1 - \zeta_{2,j})}{64} f \left(\frac{(1 + \zeta_{1,i})}{2}, \frac{(1 + \zeta_{2,j})(1 - \zeta_{1,i})}{4}, \frac{(1 + \zeta_{3,k})(1-\zeta_{1,i})(1-\zeta_{2,j})}{8}\right)。
$$&lt;p&gt;其中，
&lt;/p&gt;
$$
c_m = W_{1,i} W_{2,j} W_{3,k} \frac{(1 - \zeta_{1,i})^2 (1 - \zeta_{2,j})}{64}，
$$&lt;p&gt;
&lt;/p&gt;
$$
\xi_{1,m} = \frac{(1 + \zeta_{1,i})}{2}，
$$&lt;p&gt;
&lt;/p&gt;
$$
\xi_{2,m} = \frac{(1 + \zeta_{2,j})(1 - \zeta_{1,i})}{4}，
$$&lt;p&gt;
&lt;/p&gt;
$$
\xi_{3,m} = \frac{(1 + \zeta_{3,k})(1-\zeta_{1,i})(1-\zeta_{2,j})}{8}，
$$&lt;p&gt;
其中，$\zeta_{1,i}, \zeta_{2,j}, \zeta_{3,k}$ 是采样点，$W_{1,i}, W_{2,j}, W_{3,k}$ 是对应的高斯-勒让德求积权重系数，分别对应于阶数 $\alpha$、$\beta$ 和 $\gamma$。&lt;/p&gt;
&lt;h4 id="方法-2-1"&gt;方法 2
&lt;/h4&gt;&lt;p&gt;积分 $I$ 可通过变量替换转换为单位立方体 $\{(\eta_1, \eta_2, \eta_3) \ | \ 0 \leq \eta_1, \eta_2, \eta_3 \leq 1\}$ 上的积分：&lt;/p&gt;
$$
\xi_1 = \eta_1 \eta_2 \eta_3, \quad \xi_2 = \eta_1 \eta_2 (1 - \eta_3), \quad \xi_3 = \eta_1 (1 - \eta_2)
$$&lt;p&gt;接下来，雅可比行列式的行列式及微分体积为：
&lt;/p&gt;
$$
\frac{\partial (\xi_1, \xi_2, \xi_3)}{\partial (\eta_1, \eta_2, \eta_3)} =
\begin{bmatrix}
\frac{\partial \xi_1}{\partial \eta_1} &amp; \frac{\partial \xi_1}{\partial \eta_2} &amp; \frac{\partial \xi_1}{\partial \eta_3} \\
\frac{\partial \xi_2}{\partial \eta_1} &amp; \frac{\partial \xi_2}{\partial \eta_2} &amp; \frac{\partial \xi_2}{\partial \eta_3} \\
\frac{\partial \xi_3}{\partial \eta_1} &amp; \frac{\partial \xi_3}{\partial \eta_2} &amp; \frac{\partial \xi_3}{\partial \eta_3}
\end{bmatrix} = -\eta_1^2 \eta_2
$$&lt;p&gt;
&lt;/p&gt;
$$
\mathrm d \xi_1 \, \mathrm d \xi_2 \, \mathrm d \xi_3 = \left| \frac{\partial (\xi_1, \xi_2, \xi_3)}{\partial (\eta_1, \eta_2, \eta_3)} \right| \, \mathrm d \eta_1 \, \mathrm d \eta_2 \, \mathrm d \eta_3 = \eta_1^2 \eta_2 \, \mathrm d \eta_1 \, \mathrm d \eta_2 \, \mathrm d \eta_3.
$$&lt;p&gt;于是积分 $I$ 变为：
&lt;/p&gt;
$$
I = \int_0^1 \int_0^1 \int_0^1 f(\eta_1 \eta_2 \eta_3, \eta_1 \eta_2 (1 - \eta_3), \eta_1 (1 - \eta_2)) \times \eta_1^2 \eta_2 \, \mathrm d \eta_3 \, \mathrm d \eta_2 \, \mathrm d \eta_1.
$$&lt;p&gt;进一步地，积分 $I$ 可通过变量替换转换为标准 2-立方体区域 $\{(\zeta_1, \zeta_2, \zeta_3) \ | \ -1 \leq \zeta_1, \zeta_2, \zeta_3 \leq 1 \}$ 上的积分：
&lt;/p&gt;
$$
\eta_1 = \frac{1 + \zeta_1}{2}, \quad \eta_2 = \frac{1 + \zeta_2}{2}, \quad \eta_3 = \frac{1 + \zeta_3}{2}
$$&lt;p&gt;此时，雅可比行列式的行列式及微分体积为：
&lt;/p&gt;
$$
\frac{\partial (\eta_1, \eta_2, \eta_3)}{\partial (\zeta_1, \zeta_2, \zeta_3)} = \frac{1}{8}, \quad \mathrm d \eta_1 \, \mathrm d \eta_2 \, \mathrm d \eta_3 = \frac{1}{8} \, \mathrm d \zeta_1 \, \mathrm d \zeta_2 \, \mathrm d \zeta_3.
$$&lt;p&gt;最终，积分变为：
&lt;/p&gt;
$$
I = \int_{-1}^1 \int_{-1}^1 \int_{-1}^1 f\left(\frac{(1 + \zeta_1)(1 + \zeta_2)(1 + \zeta_3)}{8}, \frac{(1 + \zeta_1)(1 + \zeta_2)(1 - \zeta_3)}{8}, \frac{(1+\zeta_1)(1-\zeta_2)}{4}\right) \times \frac{(1 + \zeta_1)^2(1 + \zeta_2)}{64} \, \mathrm d \zeta_1 \, \mathrm d \zeta_2 \, \mathrm d \zeta_3.
$$&lt;p&gt;最终，积分可表示为：
&lt;/p&gt;
$$
I = \sum_{i=1}^{\alpha} \sum_{j=1}^{\beta} \sum_{k=1}^{\gamma} \frac{(1 + \zeta_{1,i})^2 (1 + \zeta_{2,j})}{64} W_i W_j W_k f\left(\frac{(1 + \zeta_{1,i})(1 + \zeta_{2,j})(1 + \zeta_{3,k})}{8}, \frac{(1 + \zeta_{1,i})(1 + \zeta_{2,j})(1 - \zeta_{3,k})}{8}, \frac{(1+\zeta_{1,i})(1-\zeta_{2,j})}{4}\right)
$$&lt;p&gt;
&lt;/p&gt;
$$
= \sum_{m=1}^{N=(\alpha)\times(\beta)\times(\gamma)} c_m f(\xi_{1,m}, \xi_{2,m}, \xi_{3,m})
$$&lt;p&gt;
其中，
&lt;/p&gt;
$$
c_m = \frac{(1 + \zeta_{1,i})^2 (1 + \zeta_{2,j})}{64} \times W_i W_j W_k
$$&lt;p&gt;
&lt;/p&gt;
$$
\xi_{1,m} = \frac{(1 + \zeta_{1,i})(1 + \zeta_{2,j})(1 + \zeta_{3,k})}{8}, \quad
\xi_{2,m} = \frac{(1 + \zeta_{1,i})(1 + \zeta_{2,j})(1 - \zeta_{3,k})}{8}, \quad
\xi_{3,m} = \frac{(1+\zeta_{1,i})(1-\zeta_{2,j})}{4}
$$&lt;p&gt;
其中，$\zeta_{1,i}, \zeta_{2,j}, \zeta_{3,k}$ 是采样点，$W_i, W_j, W_k$ 是高斯-勒让德求积的相应权重系数，分别对应于阶数 $\alpha, \beta, \gamma$。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;任意三角形和四面体如何映射到标准的三角形和四面体上这一部分，就暂且不表了&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="三维空间中三角形到标准三角形上的映射"&gt;三维空间中三角形到标准三角形上的映射
&lt;/h3&gt;&lt;p&gt;设三角形由三个顶点 $\mathbf{p}_1, \mathbf{p}_2, \mathbf{p}_3$ 定义，并使用重心坐标 $(\lambda_1, \lambda_2, \lambda_3)$ 进行参数化，使得：
&lt;/p&gt;
$$
\mathbf{p} = \lambda_1 \mathbf{p}_1 + \lambda_2 \mathbf{p}_2 + \lambda_3 \mathbf{p}_3, \quad \text{其中} \quad \lambda_1 + \lambda_2 + \lambda_3 = 1.
$$&lt;p&gt;
标准三角形一般定义在二维平面上，例如单位三角形：
&lt;/p&gt;
$$
T_{\text{ref}} = \{ (u,v) \mid 0 \leq u \leq 1, 0 \leq v \leq 1-u \}.
$$&lt;p&gt;
从 $(u,v)$ 变换到三维空间中的三角形，映射函数可以写成：
&lt;/p&gt;
$$
\mathbf{p}(u, v) = \mathbf{p}_1 + u (\mathbf{p}_2 - \mathbf{p}_1) + v (\mathbf{p}_3 - \mathbf{p}_1).
$$&lt;p&gt;定义映射 $\mathbf{p}(u, v)$ 的偏导数：
&lt;/p&gt;
$$
J = \begin{bmatrix}
\frac{\partial \mathbf{p}}{\partial u} &amp; \frac{\partial \mathbf{p}}{\partial v}
\end{bmatrix}
= \begin{bmatrix}
\mathbf{p}_2 - \mathbf{p}_1 &amp; \mathbf{p}_3 - \mathbf{p}_1
\end{bmatrix}.
$$&lt;p&gt;
这里 $\mathbf{p}_i$ 是三维向量，所以 $J$ 是一个 $3 \times 2$ 的矩阵。&lt;/p&gt;
&lt;p&gt;由于 $J$ 不是方阵，我们计算它的 &lt;strong&gt;面积缩放因子&lt;/strong&gt;，即&lt;strong&gt;行列式的范数&lt;/strong&gt;：
&lt;/p&gt;
$$
| \det(J^T J) |^{1/2}.
$$&lt;p&gt;
其中：
&lt;/p&gt;
$$
J^T J = \begin{bmatrix}
(\mathbf{p}_2 - \mathbf{p}_1) \cdot (\mathbf{p}_2 - \mathbf{p}_1) &amp; (\mathbf{p}_2 - \mathbf{p}_1) \cdot (\mathbf{p}_3 - \mathbf{p}_1) \\
(\mathbf{p}_3 - \mathbf{p}_1) \cdot (\mathbf{p}_2 - \mathbf{p}_1) &amp; (\mathbf{p}_3 - \mathbf{p}_1) \cdot (\mathbf{p}_3 - \mathbf{p}_1)
\end{bmatrix}.
$$&lt;p&gt;
其行列式为：
&lt;/p&gt;
$$
\det(J^T J) = (\mathbf{p}_2 - \mathbf{p}_1) \cdot (\mathbf{p}_2 - \mathbf{p}_1) (\mathbf{p}_3 - \mathbf{p}_1) \cdot (\mathbf{p}_3 - \mathbf{p}_1) - ((\mathbf{p}_2 - \mathbf{p}_1) \cdot (\mathbf{p}_3 - \mathbf{p}_1))^2.
$$&lt;p&gt;
这实际上是三角形两个边向量构成的&lt;strong&gt;行列式的平方&lt;/strong&gt;，其平方根给出了映射的面积缩放因子：
&lt;/p&gt;
$$
\text{Jacobian determinant} = \sqrt{\det(J^T J)} = \| (\mathbf{p}_2 - \mathbf{p}_1) \times (\mathbf{p}_3 - \mathbf{p}_1) \|.
$$&lt;p&gt;
其中 $\times$ 表示向量叉积，$\|\cdot\|$ 是范数（即向量长度）。&lt;/p&gt;
&lt;h2 id="代数精度的细节"&gt;代数精度的细节
&lt;/h2&gt;&lt;p&gt;从三角形变换到方形或四面体变换到正方体的时候，可能会增加原方程的最高次幂数，因此代数精度不能直接沿用原方程的最高次幂数。&lt;/p&gt;
&lt;h2 id="基函数与形函数"&gt;基函数与形函数
&lt;/h2&gt;&lt;p&gt;如果我们在一个单元中定义了一次线性基函数，这个单元在积分过程中被映射到标准三角形或四面体的同时，我们的基函数也被变换成了这个单元的形状函数，这意味不少计算上的简便。
至于如何证明这个变换成立，就交由读者了。&lt;/p&gt;
&lt;p&gt;当然，如果积分函数的内部有梯度算子，还需要乘上变换的雅可比矩阵的逆。如果是三维的三角形变换为二维的标准三角形的情况下，则需要乘上雅可比矩阵的伪逆矩阵。&lt;/p&gt;
&lt;h2 id="代码"&gt;代码
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt; 10
&lt;/span&gt;&lt;span class="lnt"&gt; 11
&lt;/span&gt;&lt;span class="lnt"&gt; 12
&lt;/span&gt;&lt;span class="lnt"&gt; 13
&lt;/span&gt;&lt;span class="lnt"&gt; 14
&lt;/span&gt;&lt;span class="lnt"&gt; 15
&lt;/span&gt;&lt;span class="lnt"&gt; 16
&lt;/span&gt;&lt;span class="lnt"&gt; 17
&lt;/span&gt;&lt;span class="lnt"&gt; 18
&lt;/span&gt;&lt;span class="lnt"&gt; 19
&lt;/span&gt;&lt;span class="lnt"&gt; 20
&lt;/span&gt;&lt;span class="lnt"&gt; 21
&lt;/span&gt;&lt;span class="lnt"&gt; 22
&lt;/span&gt;&lt;span class="lnt"&gt; 23
&lt;/span&gt;&lt;span class="lnt"&gt; 24
&lt;/span&gt;&lt;span class="lnt"&gt; 25
&lt;/span&gt;&lt;span class="lnt"&gt; 26
&lt;/span&gt;&lt;span class="lnt"&gt; 27
&lt;/span&gt;&lt;span class="lnt"&gt; 28
&lt;/span&gt;&lt;span class="lnt"&gt; 29
&lt;/span&gt;&lt;span class="lnt"&gt; 30
&lt;/span&gt;&lt;span class="lnt"&gt; 31
&lt;/span&gt;&lt;span class="lnt"&gt; 32
&lt;/span&gt;&lt;span class="lnt"&gt; 33
&lt;/span&gt;&lt;span class="lnt"&gt; 34
&lt;/span&gt;&lt;span class="lnt"&gt; 35
&lt;/span&gt;&lt;span class="lnt"&gt; 36
&lt;/span&gt;&lt;span class="lnt"&gt; 37
&lt;/span&gt;&lt;span class="lnt"&gt; 38
&lt;/span&gt;&lt;span class="lnt"&gt; 39
&lt;/span&gt;&lt;span class="lnt"&gt; 40
&lt;/span&gt;&lt;span class="lnt"&gt; 41
&lt;/span&gt;&lt;span class="lnt"&gt; 42
&lt;/span&gt;&lt;span class="lnt"&gt; 43
&lt;/span&gt;&lt;span class="lnt"&gt; 44
&lt;/span&gt;&lt;span class="lnt"&gt; 45
&lt;/span&gt;&lt;span class="lnt"&gt; 46
&lt;/span&gt;&lt;span class="lnt"&gt; 47
&lt;/span&gt;&lt;span class="lnt"&gt; 48
&lt;/span&gt;&lt;span class="lnt"&gt; 49
&lt;/span&gt;&lt;span class="lnt"&gt; 50
&lt;/span&gt;&lt;span class="lnt"&gt; 51
&lt;/span&gt;&lt;span class="lnt"&gt; 52
&lt;/span&gt;&lt;span class="lnt"&gt; 53
&lt;/span&gt;&lt;span class="lnt"&gt; 54
&lt;/span&gt;&lt;span class="lnt"&gt; 55
&lt;/span&gt;&lt;span class="lnt"&gt; 56
&lt;/span&gt;&lt;span class="lnt"&gt; 57
&lt;/span&gt;&lt;span class="lnt"&gt; 58
&lt;/span&gt;&lt;span class="lnt"&gt; 59
&lt;/span&gt;&lt;span class="lnt"&gt; 60
&lt;/span&gt;&lt;span class="lnt"&gt; 61
&lt;/span&gt;&lt;span class="lnt"&gt; 62
&lt;/span&gt;&lt;span class="lnt"&gt; 63
&lt;/span&gt;&lt;span class="lnt"&gt; 64
&lt;/span&gt;&lt;span class="lnt"&gt; 65
&lt;/span&gt;&lt;span class="lnt"&gt; 66
&lt;/span&gt;&lt;span class="lnt"&gt; 67
&lt;/span&gt;&lt;span class="lnt"&gt; 68
&lt;/span&gt;&lt;span class="lnt"&gt; 69
&lt;/span&gt;&lt;span class="lnt"&gt; 70
&lt;/span&gt;&lt;span class="lnt"&gt; 71
&lt;/span&gt;&lt;span class="lnt"&gt; 72
&lt;/span&gt;&lt;span class="lnt"&gt; 73
&lt;/span&gt;&lt;span class="lnt"&gt; 74
&lt;/span&gt;&lt;span class="lnt"&gt; 75
&lt;/span&gt;&lt;span class="lnt"&gt; 76
&lt;/span&gt;&lt;span class="lnt"&gt; 77
&lt;/span&gt;&lt;span class="lnt"&gt; 78
&lt;/span&gt;&lt;span class="lnt"&gt; 79
&lt;/span&gt;&lt;span class="lnt"&gt; 80
&lt;/span&gt;&lt;span class="lnt"&gt; 81
&lt;/span&gt;&lt;span class="lnt"&gt; 82
&lt;/span&gt;&lt;span class="lnt"&gt; 83
&lt;/span&gt;&lt;span class="lnt"&gt; 84
&lt;/span&gt;&lt;span class="lnt"&gt; 85
&lt;/span&gt;&lt;span class="lnt"&gt; 86
&lt;/span&gt;&lt;span class="lnt"&gt; 87
&lt;/span&gt;&lt;span class="lnt"&gt; 88
&lt;/span&gt;&lt;span class="lnt"&gt; 89
&lt;/span&gt;&lt;span class="lnt"&gt; 90
&lt;/span&gt;&lt;span class="lnt"&gt; 91
&lt;/span&gt;&lt;span class="lnt"&gt; 92
&lt;/span&gt;&lt;span class="lnt"&gt; 93
&lt;/span&gt;&lt;span class="lnt"&gt; 94
&lt;/span&gt;&lt;span class="lnt"&gt; 95
&lt;/span&gt;&lt;span class="lnt"&gt; 96
&lt;/span&gt;&lt;span class="lnt"&gt; 97
&lt;/span&gt;&lt;span class="lnt"&gt; 98
&lt;/span&gt;&lt;span class="lnt"&gt; 99
&lt;/span&gt;&lt;span class="lnt"&gt;100
&lt;/span&gt;&lt;span class="lnt"&gt;101
&lt;/span&gt;&lt;span class="lnt"&gt;102
&lt;/span&gt;&lt;span class="lnt"&gt;103
&lt;/span&gt;&lt;span class="lnt"&gt;104
&lt;/span&gt;&lt;span class="lnt"&gt;105
&lt;/span&gt;&lt;span class="lnt"&gt;106
&lt;/span&gt;&lt;span class="lnt"&gt;107
&lt;/span&gt;&lt;span class="lnt"&gt;108
&lt;/span&gt;&lt;span class="lnt"&gt;109
&lt;/span&gt;&lt;span class="lnt"&gt;110
&lt;/span&gt;&lt;span class="lnt"&gt;111
&lt;/span&gt;&lt;span class="lnt"&gt;112
&lt;/span&gt;&lt;span class="lnt"&gt;113
&lt;/span&gt;&lt;span class="lnt"&gt;114
&lt;/span&gt;&lt;span class="lnt"&gt;115
&lt;/span&gt;&lt;span class="lnt"&gt;116
&lt;/span&gt;&lt;span class="lnt"&gt;117
&lt;/span&gt;&lt;span class="lnt"&gt;118
&lt;/span&gt;&lt;span class="lnt"&gt;119
&lt;/span&gt;&lt;span class="lnt"&gt;120
&lt;/span&gt;&lt;span class="lnt"&gt;121
&lt;/span&gt;&lt;span class="lnt"&gt;122
&lt;/span&gt;&lt;span class="lnt"&gt;123
&lt;/span&gt;&lt;span class="lnt"&gt;124
&lt;/span&gt;&lt;span class="lnt"&gt;125
&lt;/span&gt;&lt;span class="lnt"&gt;126
&lt;/span&gt;&lt;span class="lnt"&gt;127
&lt;/span&gt;&lt;span class="lnt"&gt;128
&lt;/span&gt;&lt;span class="lnt"&gt;129
&lt;/span&gt;&lt;span class="lnt"&gt;130
&lt;/span&gt;&lt;span class="lnt"&gt;131
&lt;/span&gt;&lt;span class="lnt"&gt;132
&lt;/span&gt;&lt;span class="lnt"&gt;133
&lt;/span&gt;&lt;span class="lnt"&gt;134
&lt;/span&gt;&lt;span class="lnt"&gt;135
&lt;/span&gt;&lt;span class="lnt"&gt;136
&lt;/span&gt;&lt;span class="lnt"&gt;137
&lt;/span&gt;&lt;span class="lnt"&gt;138
&lt;/span&gt;&lt;span class="lnt"&gt;139
&lt;/span&gt;&lt;span class="lnt"&gt;140
&lt;/span&gt;&lt;span class="lnt"&gt;141
&lt;/span&gt;&lt;span class="lnt"&gt;142
&lt;/span&gt;&lt;span class="lnt"&gt;143
&lt;/span&gt;&lt;span class="lnt"&gt;144
&lt;/span&gt;&lt;span class="lnt"&gt;145
&lt;/span&gt;&lt;span class="lnt"&gt;146
&lt;/span&gt;&lt;span class="lnt"&gt;147
&lt;/span&gt;&lt;span class="lnt"&gt;148
&lt;/span&gt;&lt;span class="lnt"&gt;149
&lt;/span&gt;&lt;span class="lnt"&gt;150
&lt;/span&gt;&lt;span class="lnt"&gt;151
&lt;/span&gt;&lt;span class="lnt"&gt;152
&lt;/span&gt;&lt;span class="lnt"&gt;153
&lt;/span&gt;&lt;span class="lnt"&gt;154
&lt;/span&gt;&lt;span class="lnt"&gt;155
&lt;/span&gt;&lt;span class="lnt"&gt;156
&lt;/span&gt;&lt;span class="lnt"&gt;157
&lt;/span&gt;&lt;span class="lnt"&gt;158
&lt;/span&gt;&lt;span class="lnt"&gt;159
&lt;/span&gt;&lt;span class="lnt"&gt;160
&lt;/span&gt;&lt;span class="lnt"&gt;161
&lt;/span&gt;&lt;span class="lnt"&gt;162
&lt;/span&gt;&lt;span class="lnt"&gt;163
&lt;/span&gt;&lt;span class="lnt"&gt;164
&lt;/span&gt;&lt;span class="lnt"&gt;165
&lt;/span&gt;&lt;span class="lnt"&gt;166
&lt;/span&gt;&lt;span class="lnt"&gt;167
&lt;/span&gt;&lt;span class="lnt"&gt;168
&lt;/span&gt;&lt;span class="lnt"&gt;169
&lt;/span&gt;&lt;span class="lnt"&gt;170
&lt;/span&gt;&lt;span class="lnt"&gt;171
&lt;/span&gt;&lt;span class="lnt"&gt;172
&lt;/span&gt;&lt;span class="lnt"&gt;173
&lt;/span&gt;&lt;span class="lnt"&gt;174
&lt;/span&gt;&lt;span class="lnt"&gt;175
&lt;/span&gt;&lt;span class="lnt"&gt;176
&lt;/span&gt;&lt;span class="lnt"&gt;177
&lt;/span&gt;&lt;span class="lnt"&gt;178
&lt;/span&gt;&lt;span class="lnt"&gt;179
&lt;/span&gt;&lt;span class="lnt"&gt;180
&lt;/span&gt;&lt;span class="lnt"&gt;181
&lt;/span&gt;&lt;span class="lnt"&gt;182
&lt;/span&gt;&lt;span class="lnt"&gt;183
&lt;/span&gt;&lt;span class="lnt"&gt;184
&lt;/span&gt;&lt;span class="lnt"&gt;185
&lt;/span&gt;&lt;span class="lnt"&gt;186
&lt;/span&gt;&lt;span class="lnt"&gt;187
&lt;/span&gt;&lt;span class="lnt"&gt;188
&lt;/span&gt;&lt;span class="lnt"&gt;189
&lt;/span&gt;&lt;span class="lnt"&gt;190
&lt;/span&gt;&lt;span class="lnt"&gt;191
&lt;/span&gt;&lt;span class="lnt"&gt;192
&lt;/span&gt;&lt;span class="lnt"&gt;193
&lt;/span&gt;&lt;span class="lnt"&gt;194
&lt;/span&gt;&lt;span class="lnt"&gt;195
&lt;/span&gt;&lt;span class="lnt"&gt;196
&lt;/span&gt;&lt;span class="lnt"&gt;197
&lt;/span&gt;&lt;span class="lnt"&gt;198
&lt;/span&gt;&lt;span class="lnt"&gt;199
&lt;/span&gt;&lt;span class="lnt"&gt;200
&lt;/span&gt;&lt;span class="lnt"&gt;201
&lt;/span&gt;&lt;span class="lnt"&gt;202
&lt;/span&gt;&lt;span class="lnt"&gt;203
&lt;/span&gt;&lt;span class="lnt"&gt;204
&lt;/span&gt;&lt;span class="lnt"&gt;205
&lt;/span&gt;&lt;span class="lnt"&gt;206
&lt;/span&gt;&lt;span class="lnt"&gt;207
&lt;/span&gt;&lt;span class="lnt"&gt;208
&lt;/span&gt;&lt;span class="lnt"&gt;209
&lt;/span&gt;&lt;span class="lnt"&gt;210
&lt;/span&gt;&lt;span class="lnt"&gt;211
&lt;/span&gt;&lt;span class="lnt"&gt;212
&lt;/span&gt;&lt;span class="lnt"&gt;213
&lt;/span&gt;&lt;span class="lnt"&gt;214
&lt;/span&gt;&lt;span class="lnt"&gt;215
&lt;/span&gt;&lt;span class="lnt"&gt;216
&lt;/span&gt;&lt;span class="lnt"&gt;217
&lt;/span&gt;&lt;span class="lnt"&gt;218
&lt;/span&gt;&lt;span class="lnt"&gt;219
&lt;/span&gt;&lt;span class="lnt"&gt;220
&lt;/span&gt;&lt;span class="lnt"&gt;221
&lt;/span&gt;&lt;span class="lnt"&gt;222
&lt;/span&gt;&lt;span class="lnt"&gt;223
&lt;/span&gt;&lt;span class="lnt"&gt;224
&lt;/span&gt;&lt;span class="lnt"&gt;225
&lt;/span&gt;&lt;span class="lnt"&gt;226
&lt;/span&gt;&lt;span class="lnt"&gt;227
&lt;/span&gt;&lt;span class="lnt"&gt;228
&lt;/span&gt;&lt;span class="lnt"&gt;229
&lt;/span&gt;&lt;span class="lnt"&gt;230
&lt;/span&gt;&lt;span class="lnt"&gt;231
&lt;/span&gt;&lt;span class="lnt"&gt;232
&lt;/span&gt;&lt;span class="lnt"&gt;233
&lt;/span&gt;&lt;span class="lnt"&gt;234
&lt;/span&gt;&lt;span class="lnt"&gt;235
&lt;/span&gt;&lt;span class="lnt"&gt;236
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// 定义节点和权重的结构体
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Arithmetic&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="nc"&gt;gl_node&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// 获取 n 阶高斯-勒让德节点和权重
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Arithmetic&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;get_gl_node&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;vector&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;switch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;2.0&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.5773502691896257&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.5773502691896257&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.7745966692414834&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.5555555555555556&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.8888888888888888&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.7745966692414834&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.5555555555555556&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.8611363115940526&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.3478548451374538&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.3399810435848563&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.6521451548625461&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.3399810435848563&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.6521451548625461&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.8611363115940526&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.3478548451374538&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.9061798459386640&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.2369268850561891&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.5384693101056831&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.4786286704993665&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.5688888888888889&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.5384693101056831&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.4786286704993665&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.9061798459386640&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.2369268850561891&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.9324695142031521&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.1713244923791704&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.6612093864662645&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.3607615730481386&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.2386191860831969&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.4679139345726910&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.2386191860831969&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.4679139345726910&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.6612093864662645&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.3607615730481386&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.9324695142031521&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="k"&gt;static_cast&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.1713244923791704&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;default&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;invalid_argument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Unsupported order of Gauss-Legendre quadrature.&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c1"&gt;// 可以根据需要添加更多的节点和权重
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Function3d&lt;/span&gt; &lt;span class="n"&gt;Func&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integrate_on_triangle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Triangle&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Func&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node_u&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node_v&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Function3d&lt;/span&gt; &lt;span class="n"&gt;Func&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integrate_on_tetra&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Tetra&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;Func&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;det_J&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="nl"&gt;node_x&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="nl"&gt;node_y&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="nl"&gt;node_z&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Function3d&lt;/span&gt; &lt;span class="n"&gt;Func&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integrate_on_triangle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Triangle&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Func&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node_u&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node_v&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;//基函数定义在在标准三角形上
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Function3d&lt;/span&gt; &lt;span class="n"&gt;Func1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;Function2d&lt;/span&gt; &lt;span class="n"&gt;Func2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integrate_on_triangle_by_base&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Triangle&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Func1&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Func2&lt;/span&gt; &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node_u&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nl"&gt;node_v&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_v&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;tri&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;//基函数定义在标准四面体上
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Function3d&lt;/span&gt; &lt;span class="n"&gt;Func1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;Function3d&lt;/span&gt; &lt;span class="n"&gt;Func2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;intergate_on_tetra_by_base&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;Tetra&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Func1&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Func2&lt;/span&gt; &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;det_J&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_gl_node&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="nl"&gt;node_x&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="nl"&gt;node_y&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="k"&gt;auto&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="nl"&gt;node_z&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;nodes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mapped_x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;mapped_y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;mapped_z&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;jacobian&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;z&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mapped_z&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;J&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;z&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mapped_x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;mapped_y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;mapped_z&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;integral&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;node_x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;node_z&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;jacobian&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;det_J&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;integral&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>聊聊一月霸权番母鸡卡</title><link>https://woodman3.github.io/p/%E8%81%8A%E8%81%8A%E4%B8%80%E6%9C%88%E9%9C%B8%E6%9D%83%E7%95%AA%E6%AF%8D%E9%B8%A1%E5%8D%A1/</link><pubDate>Sun, 02 Feb 2025 22:39:54 +0800</pubDate><guid>https://woodman3.github.io/p/%E8%81%8A%E8%81%8A%E4%B8%80%E6%9C%88%E9%9C%B8%E6%9D%83%E7%95%AA%E6%AF%8D%E9%B8%A1%E5%8D%A1/</guid><description>&lt;img src="https://woodman3.github.io/p/%E8%81%8A%E8%81%8A%E4%B8%80%E6%9C%88%E9%9C%B8%E6%9D%83%E7%95%AA%E6%AF%8D%E9%B8%A1%E5%8D%A1/misumi.jpg" alt="Featured image of post 聊聊一月霸权番母鸡卡" /&gt;&lt;p&gt;mujica已经播出了五集了，我想写下自己对于这部番的一些看法。&lt;/p&gt;
&lt;h2 id="场外"&gt;场外
&lt;/h2&gt;&lt;p&gt;在播出前，wsd提前三集点映让大伙怨声载道。恨不得拔了wsd的祖坟。&lt;/p&gt;
&lt;p&gt;在第五集播出后，贴吧上一片哀嚎，认为这部番已经烂了。诚然我并不这么认为。对于一部只播出了一半的番而言，如此快的下定论还为时尚早。况且在我看来，mujica前五集的表现并不差。mujica现在确实有不少地方没讲清楚，比如祥子为什么要重组乐队？还用着如此中二的世界观。&lt;/p&gt;
&lt;h2 id="人物塑造和剧情"&gt;人物塑造和剧情
&lt;/h2&gt;&lt;h3 id="祥子"&gt;祥子
&lt;/h3&gt;&lt;p&gt;对于人物上，争议最大的就是祥子。你不得不承认，至少祥子在这五集中塑造的形象和在mygo中的形象不太一致，在mygo中，我们看到的是一个蛮力拆散乐队的大小姐，面对素世的请求摆着一张臭脸骂回去，转身又找了两个儿时伙伴组了新乐队。在mygo播出的时候，大祥老师的风评并不算好，攻击点主要集中在她对于soyo的态度上，这期间对于saki经历了什么，议论纷纷，期间双子说和怀孕说都出来了。直到最后一集，大伙看到saki在当客服小姐打工，回家看到落魄的老爹的时候，真相大白，第一部也戛然而止。&lt;/p&gt;
&lt;p&gt;在等待mujica播出的这一年间，大祥老师的打工梗图层出不穷，现实主义的色彩也让大祥老师的形象从薄情冷淡到客服小祥，从这一方面来说，saki的风评可以是好转了许多。而在mujica第一集播出时，看到saki哭着回家的那一段，我对于saki也是充满了同情的。&lt;/p&gt;
&lt;p&gt;但是随之而来的，是saki在之后的乐队中压力最关心自己的睦，间接导致了睦的精神分裂。这一举动虽然在情理之内，但是也揭示saki性格上的弱点——攻击自己最亲密的人，无论是睦还是soyo，但是当压力到喵梦这种与她关系一般的，反而就争不过，俗称窝里横。&lt;/p&gt;
&lt;p&gt;在第四集，saki看到睦不会因为精神分裂不会弹吉他后，并没有镇住喵梦，然后乐队解散。在这一集中saki外强中干的形象进一步加深。第五集，saki在打了一个月的工后，被接回了爷爷家继续当大小姐。身份的转变让这一年间所有大祥老师打工讨钱的梗图变成了个笑话。大祥老师的人设也从苦逼打工人摇身一变成为了臭脸大小姐，人设崩塌之声不绝如缕。&lt;/p&gt;
&lt;p&gt;所以，大祥的人设真的崩了吗？在我看来也没有，她的性格的缺陷在mygo描写比重不多，而性格的优点却在这一年间各种段子的传播过程中被无限的放大。mujica播出后，祥子的缺陷不但被彻底的暴露了出来，还增加了不少，而对应的，祥子的优点却几乎毫无描写。大伙以为祥子对soyo下跪摆臭脸是现实压力大，谁知道大祥老师就是这个臭脾气。&lt;/p&gt;
&lt;p&gt;最后，我喜欢祥子吗？我不得不说我确实喜欢这个角色，在我看来祥子塑造到这个境界已经塑造的差不多了。一个缺陷大于优点的正面大小姐形象可以说是非常难得，说是正面，邦邦这个企划也无法搞出什么反派形象。对于祥子后续应该如何成长、如何洗白，我倒是并不在意，我这人心理扭曲，比起角色一点点成长更喜欢看角色一步步堕落。&lt;/p&gt;
&lt;h3 id="睦"&gt;睦
&lt;/h3&gt;&lt;p&gt;无论是在mygo中还是在mujica中，睦这个角色似乎永远笼罩着一层悲剧色彩。在黑刀之夜为拆团出力，被soyo利用却面对soyo的下跪毫无作为，送soyo黄瓜却被拒绝。睦好像一直被两个人夹在中间，却因为自己的性格一直无能为力，无论是对于自己还是对于他人。而在场外，睦的每一句话也被苛责。&lt;/p&gt;
&lt;p&gt;在mujica中，睦的不善言辞导致的悲剧色彩被进一步放大。第一集被大喵摘下面具。在访谈中不慎说出心声，压力过大导致的大脑断线被以为是表演，在路线之争中被夹在中间，神人家庭更不用说。这一切在第三集中到达了顶点——睦人格分裂了。&lt;/p&gt;
&lt;p&gt;对于人格分裂这一点，大部分人似乎不愿意接受自己喜欢的角色遭到如此待遇，更加糟糕的是，第二人格不会弹吉他，这直接导致了乐队的解散。&lt;/p&gt;
&lt;p&gt;而在乐队四个人得知睦精神分裂后，没有一个人去联系医生，这一点饱受批判逻辑不合理。在我看来无伤大雅，睦如果被治好了我后面看什么？再说了，睦怎样才算治好？第二人格没了然后换第一人格上来继续受苦吗？&lt;/p&gt;
&lt;p&gt;对于睦的后续如何，无人能下个定论。但既然邦邦要包饺子，那么睦后续大概也会克服自己的性格问题，变得开朗起来吧。&lt;/p&gt;
&lt;h3 id="喵梦"&gt;喵梦
&lt;/h3&gt;&lt;p&gt;坦白而言，对于这个角色我实在喜欢不起来。在mygo中，她被戏称为灯的代餐。描写实在说不上多。唯一令人疑惑的点就是一个刚刚开始练习架子鼓的人为什么能打的来bpm这么高的曲子。&lt;/p&gt;
&lt;p&gt;在第一集中，喵梦摘下了大家的面具，直接打乱了祥子的计划。而祥子没有任何反制措施显得祥子管理能力不足。尽管在剧内对祥子造成了很大的困扰，但是对于剧外的我们无疑加快了剧情的节奏。&lt;/p&gt;
&lt;p&gt;对于喵梦的缺点是很明显的，自私，只想着拿mujica作为自己进步的跳板。对于她的优点嘛&amp;hellip;努力这个特质在神仙打架的邦邦世界观中显得实在微不足道。在乎观众的感受但是在表现上却是不断的压力睦去表演。可以说喵梦就是mujica解散的第一责任人。&lt;/p&gt;
&lt;p&gt;这个角色最大的问题在于，她与其他所有的角色都没有什么情感关系，想不出后面对于个人的饺子该如何包。个人的私心是希望喵梦也被拷打一顿。&lt;/p&gt;
&lt;h3 id="海玲"&gt;海玲
&lt;/h3&gt;&lt;p&gt;海玲的形象呢，“雇佣兵”三个字就足以概括。海玲这个角色的定位有点像mygo里的猫猫。一个偏向意识流的角色。但是我们可以在海玲对睦的态度中看到她对于队友的关心，但遗憾的是这微不足道的关心并没有改变故事的走向。从海玲反对祥子对于喵梦的批评中也可以看出这一点。隐藏的一点点自恋属性也有些可爱。&lt;/p&gt;
&lt;p&gt;但是遗憾的是，关于海玲的背景和剧情可以说是完全没有。角色的形象虽然通过寥寥几笔生动的勾勒了出来，但是在神人乱舞的mujica中还是显得比喵梦还要单薄。值得注意的是，海玲和初华是mujica和mygo十个人中唯二没有描写过家人的角色，我只能祈祷编剧在藏些什么，比起编剧整烂活，你不能没活啊。&lt;/p&gt;
&lt;h3 id="初华"&gt;初华
&lt;/h3&gt;&lt;p&gt;初华这人吧，谜团重重。在mygo时期，此人就拿大祥的几条短信当精神支柱持续一年，观察力能看出灯要跌倒并随后鼓舞灯，能认出c团的人却和立希毫无接触。围绕着这个女人的谜团在mygo时期就已经非常多了，但是唯一可以确定的是，此人可能是十个人里最重的女人。&lt;/p&gt;
&lt;p&gt;在等待的这一年中，声优在访谈里也反复暗示初华的重量级，放出的预告里也有重量级台词，在地铁的广告里也有着初华狰狞的面孔。emmmm，非常有意思。于是乎，围绕着这女人的争议从第一集就开始了，比如疑似作画失误的地方被认为是诡叙，一切都是初华德视角。&lt;/p&gt;
&lt;p&gt;但是她在这五集中做了些什么呢？她在祥子示意不要摘面具时却依旧摘了面具，发现了睦被压力却没有安慰，在路线之争中帮倒忙，在睦独揽大权时却坐在了睦的一边。你很难分辨出她是串子还是真的蠢。鉴于其在前一季中表现出来的行动力和情商，前者的可能性更大些，但是在第五集播出后，似乎又是后者的可能性大一些。&lt;/p&gt;
&lt;p&gt;初华是一个乐队的主唱，但是对于她的没写却显著的少，她的童年时和祥子的时间只有第一季中不到五分钟的描写，却完全没有要点。她的家庭和来东京的这一年发生了什么也完全没有提。她的谜团太多，她的形象却太薄。社区中关于她的讨论都是集中在诡叙和sumimi解散上，对于她人物本身的讨论还没有喵梦多。&lt;/p&gt;
&lt;p&gt;我很担心初华的塑造，不仅仅是目前来看初华作为一个主唱的塑造严重不足，更多的是我害怕初华被塑造成一个单箭头舔狗，太俗套了。虽然我不想让一个人物影响整部番的评分，但是如果初华真的就是如此单薄的形象的话，那这部番在我心中的评分也很难高。&lt;/p&gt;
&lt;h2 id="我自己的假药"&gt;我自己的假药
&lt;/h2&gt;&lt;p&gt;也许初华是丰川集团下的慈善孤儿院长大的。所以初华在幼年时接触到了祥子。只有祥子作为唯一朋友和亲人的初华怀揣着想和祥子在一起的梦想一个人来到了东京出道。在mujica的解散后初华开始发力重新拉回成员，并将mujica作为一个普通的少女乐队重头开始。但是随着乐队的发展，初华发现自己在祥子心中的地位依旧只是普通朋友，于是初华把自己对于祥子的埋怨写入了歌词，不曾想却一曲爆红。于是初华越是在演出中控诉自己的祥子无法得到的爱，乐队就发展的越好，而祥子只是很高兴初华表现得很好却未曾察觉歌词所指向的女人正是自己。在最后一场巡演结束后，初华终于因为自己过于用力的演出而失声，而乐队的成员开心的准备着庆功宴。明白自己再也无法歌唱的初华在预订庆功宴的下雨天回到了ring，面对着问自己为什么湿透了的祥子，初华宣布退出自己一手重建的mujica&amp;hellip;&lt;/p&gt;
&lt;h2 id="最后"&gt;最后
&lt;/h2&gt;&lt;p&gt;mujica这部番在现在的讨论可以说是乌烟瘴气了，不少人直接给这部番判了死刑，各路厨子疯狂互车，各路舅舅在放出或真或假的剧透，staff的切割和声优的沉默震耳欲聋。大量假药破产，人心惶惶。&lt;/p&gt;
&lt;p&gt;但那有如何呢？我现在就好像坐在一个不知道什么时候会沉的船上，海上狂风怒号，船上四处漏水，有概率能平稳上岸，更大的可能是葬身鱼腹。但那有如何呢？与飓风共舞的过程才是我所追求的东西啊。mujica可以烂，但是不能没活。今朝有酒今朝醉吧。&lt;/p&gt;
&lt;p&gt;我真的挺喜欢结尾的ed《Georgette Me, Georgette You》。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id="214分界线"&gt;2/14分界线
&lt;/h1&gt;&lt;p&gt;昨天看完了第七集，现在我在工位上实在没心情工作，想写点啥。&lt;/p&gt;
&lt;p&gt;说实话，对于第六集的评价，我还是挺不错的。剧情发展也算是符合预期。唯二的意外就是素世的行动力有些太高了，而且初华完全没有出场。&lt;/p&gt;
&lt;p&gt;第六集播出后就是wsd开始炒作第七集。准确来说wsd从播出前就开始炒第七集了，因为第七集是祥子的生日。wsd卡点隔了一年播出mujica,大概也是这个理由。&lt;/p&gt;
&lt;p&gt;那么第七集写的如何呢？大伙对于第七集的评价大部分是烂完了。瓶子直接发动态开喷，第七集的评论区已经全是骂声，b站评分开始猛跌。&lt;/p&gt;
&lt;p&gt;我对于第七集的前半部分评价，其实还是挺乐呵的，从素世的锁喉环节到祥子的程门立雪，观感都还不错。但是到了live环节，灯开始唱ccc的新曲时，一切就开始不对了。原因很简单：这歌唱的实在是不好听。我能从逻辑上理解这么做的用意——毕竟这确实是彩排。但是这么做实在是有弄巧成绌之嫌。mygo第十集的时候也是第一次，第十集不符合逻辑但是谁在乎呢？所以第十集成神回了。结果隔了一年，编剧在这个时候把本来没啥必要的逻辑又捡回来了，这带来的后果是灾难性的——本来应该是情绪爆发的情节整崩了。或者更遭——整乐了，得益于过去一年的烤羊，大伙快被气笑了。&lt;/p&gt;
&lt;p&gt;糟糕的live不仅没能调动观众的情绪，反而把观众把所有的缺点全部放大。爱音工具人吗？mygo时期爱音两次跑路，两次又去拉人的时候观众没觉得爱音工具人反而把爱希和爱素的cp炒上了天。睦的人格分裂突然吗？也许吧，但是我在mo8关于人格分裂这件事上已经吃过一次大的了，所以这部分我感觉还好，至少没告诉你睦真的有一个妹妹。大祥的转变太刻意了？确实，但是大祥已经作为陀螺被编剧抽了六集了，再不变那更完蛋。立希为啥要道歉？因为从立希的视角看来就是自己把祥子骂走的，自己也是ccc解散的原因之一。&lt;/p&gt;
&lt;p&gt;以及最糟糕的一点：观众对于ccc这个团其实没啥感情，如果mujica在去年一月开播的话也许对于ccc还有些许记忆。但是一年过去了，先不说ccc之间的羁绊和故事在mujica中完全没有体现，就是在mygo中，ccc也没多少戏份啊。去年mygo第十集是观众一集一集看着过来的，情绪上对于mygo的羁绊心里是明白的。但是ccc的羁绊观众完全不知道，剧里的人和解了观众那看的是一脸问号。而且这番不是mujica吗？去年观众知道mygo肯定包饺子那都有心里准备。今年观众知道mujica要包饺子但是你把ccc给整活了那mujica别说包饺子了，连创建的必要性都要被质疑。而且当动漫播到live的时候，官方告诉你ccc会参加之后的live。知道的明白这是给ccc送终，不知道的还以为ccc要被叫魂喊回来了呢。&lt;/p&gt;
&lt;p&gt;现在看来，也许观众想看的，是mygo和mujica之间就ccc彻底分别，各自走向自己的团。但是wsd想的，就是三个团像连体婴儿一样，不能彻底切割，而是继续纠缠不清，这样他们就可以继续卖cp卖live。这也许解释了剧情这么编的原因。&lt;/p&gt;
&lt;p&gt;说实话，这集除了live外，其他似乎也没啥太大的问题。那么问题出在哪儿呢？对我而言，场外一直在宣传后面会有狠活，但是第七集的表现证明了这帮人水平就在这儿了，写不了什么东西了。而我对于他们的期望又太高，造了太多的假药，最后假药导致了自己像个小丑，导致了滑坡。&lt;/p&gt;
&lt;p&gt;社区里的人太多为爱音感到不平了，爱音被封了圣，退队爱音二创不断地出现。爱音为mygo付出了这么多却被塑造成了一个负责搞笑吃瘪的角色。我在这一点上同情爱音，但另一方面来说，爱音两次被灯拉了回来，她作为灯的朋友同时又是祥子的同学，希望自己的好友可以与过去和解这个动机，在逻辑上也确实说的通。在过去的一年中，爱素和爱希的二创多了，以至于mygo里立希和素世在最后三集对爱音的态度被有意无意的淡化甚至被曲解成情趣，mujica第一集素世和爱音一起去看live还炒了一波cp，但是第六集编剧没有直接写明素世是否有会爱音消息开始让一切发酵，这最终直接导致了第七集的崩盘。观众们的期待最终滑向了一个极端。&lt;/p&gt;
&lt;p&gt;伴随着角色节奏的，还有就是所谓的剧透。坦白而言，聊天消息传来的双子剧透实在太过炸裂，烂到我都无法接受。但是因为编剧的不做人，这份剧透居然有那么些可信度，于是这份荒诞的剧透进一步拉高了观众的血压并且恶化了社区环境。&lt;/p&gt;
&lt;h2 id="继续假药"&gt;继续假药
&lt;/h2&gt;&lt;p&gt;我知道这些东西几乎不可能被出现在正剧里，也知道这不过是一种入脑的表现。但是我还是想写，我去年在追mygo的时候其实也想过一些后续的剧情发展，但是我现在已经完全不记得了，我想至少把我期待的剧情记录下来，聊以自慰。
这是我自己编的几个假药，内鬼假药是在第七集之前编的，复仇假药是在第七集播出后第二天在公司谁午觉的时候编的。&lt;/p&gt;
&lt;h3 id="内鬼向"&gt;内鬼向
&lt;/h3&gt;&lt;p&gt;丰川集团下在小岛上有着他们作为慈善机构资助的孤儿院，来培养一些人替丰川集团干一些累活或者脏活。而初华就是孤儿院中的一个孩子。在小时候初华就被灌输为丰川集团服务的思想。后来初华在一个偶然的机会遇到了祥子，内心里把祥子人做自己的亲人。后来初华长大后，依靠着对于想和祥子在一起的愿望，一直都在努力着。在一年前，丰川老爷不想自己的家产被外人继承，于是想要给女婿一个考验，这个考验该如何坐就交给孤儿院的人来作为他们的任务。但是并没有说祥子与他的关系，对于孤儿院的人来说这只是一个上级对于他们的考验。初华想出了诈骗这个主意：如果祥子他爸上当了，说明他确实没资格作为丰川家的人，而诈骗过来的钱还给丰川，没有任何损失。这个计谋被初华交给了孤儿院的其他人来实行，初华作为幕后的推手故意没拿一分钱。所以在诈骗团体被抓拿的时候初华没有受到连累。作为奖励，老爷资助了初华去东京上学和出道成为偶像。同时老爷也勒令——初华不得与祥子联系。&lt;/p&gt;
&lt;p&gt;一年后，mujica开始筹办。老爷不希望自己唯一的继承人去搞乐队，于是拆散乐队的任务被交给了初华，初华表示抗拒，于是老爷告诉初华，你一年前诈骗的人就是祥子的父亲，你也不想被祥子讨厌吧？这是为了祥子好，事成之后，你就可以成为丰川家族的影子，辅佐祥子在丰川中的地位，真正的成为祥子的家人。&lt;/p&gt;
&lt;p&gt;于是初华妥协了，在祥子邀请她的时候，就开始筹划着乐队的解散。她告诉祥子要背负他人人生的话那么乐队的赔款也该由她来出，借此架空了祥子对于乐队成员的控制权，为喵梦后面摘面具而不用负责任埋伏笔。暗中诱导喵梦急功近利，最终导致了摘面具。第一次去睦家中时悄悄去睦的房间收集情报，使得镜头里没有初华这个人。在发现了睦的家庭并不好之后刻意不去关注睦的状况诱导了睦的崩溃。在最后的live上再一次左手倒右手，丰川赞助的乐队赔款给丰川建造的会馆，整体的实际损失其实不大。&lt;/p&gt;
&lt;p&gt;mujica解散了，祥子也离她而去，意识到了不对的初华也开始暗中调查起了祥子的境况，明白了祥子在一年中的打工之苦和mujica对于祥子的意义不仅仅是玩乐如此简单后，这一事实击碎了初华。没有脸面面对祥子和睦的初华开始暗中为自己的行为赎罪，她联系老爷让老爷把祥子接回家中，再次前往睦的家中想要为睦联系医生但是遭到了睦母亲的拒绝，去见睦又被赶了出来。调查了睦的背景后又扮成记者采访素世诱导她去查看睦的情况。重新收集一年前的诈骗的前因后果试图让祥爹振作。并且试着重新组建mujica。&lt;/p&gt;
&lt;p&gt;mujica重组后的老爷再次向祥子和初华施压，于是初华在祥子和老爷面前自爆了，坦白了一切的真相。得知了一切真相而再次崩溃的祥子在雨天逃出了丰川家，初华追了上去，面对着朝自己扔泥巴的祥子，初华告诉了要么回家族，过上再也与乐队无缘的生活，要么彻底与丰川集团切割，与没有了丰川赞助甚至被针对的乐队机组走下去。祥子问初华怎么选，初华告诉祥子自己在自爆的时候就已经被丰川切割了。于是祥子跟着初华回到了乐队。mujica沦为地下乐队，一切从零开始。&lt;/p&gt;
&lt;h3 id="复仇向"&gt;复仇向
&lt;/h3&gt;&lt;p&gt;初华是在岛上的孤儿院长大（沟槽的我为啥这么喜欢写孤儿），岛上人烟稀少以至于连孤儿院都没多少孩子。于是幼年的初华没有亲人和朋友，一次在岛上偶然瞎逛让初华认识到了祥子，祥子便成为了初华唯一的亲人和朋友。怀着想和祥子在一起的想法，初华一个人来到了东京上高中，在网上看到了祥子成立ccc后，初华也决定朝艺人的方向努力，于是成功参加海选出道。在一年后祥子向她发来组乐队的邀请时，初华没多想就答应了。但是mujica的解散让这一切最终都化为了泡影。&lt;/p&gt;
&lt;p&gt;一个月以来祥子的不联系让初华倍感自责，但是她很快就得到了另一个让她震惊的消息：ccc重组了，照片中的祥子洋溢着幸福的笑容。感到难以置信的初华悄悄问了爱音发生什么，得到了“大家都和解了“的回复。于是初华也得知了祥子的家庭困难的情况，但是这让初华认为祥子当初找自己组mujica纯粹就是利用自己的名声和脸，以为在祥子从来没有把她当作亲人甚至朋友看待。&lt;/p&gt;
&lt;p&gt;而在另一边，喵梦厌倦了作为综艺演员的工作，她找上了睦的母亲想要获取更多资源，结果不仅没得到资源，还了解到睦的双重人格并不是演的，而睦母对于自己女儿的态度让喵梦震惊。在四处碰壁后，初华找上了喵梦，问她是否愿意重组mujica，喵梦怀着对睦的愧疚同意了这一请求。但是当喵梦问初华什么邀请祥子时，初华却告诉她：“乐队不需要键盘手”，于是，喵梦也了解到了祥子组建mujica的原因，也明白了自己误解了祥子，组乐队并不是大小姐的过家家。&lt;/p&gt;
&lt;p&gt;在mujica逐渐组建的过程中，丰川老爷也不满祥子还在便宜学校上学，于是告诉祥子要求她在下学期去国外读书。祥子告诉老爷自己在这边还要朋友不想出国，但是老爷告诉祥子是她指示喵梦加快乐队的节奏导致mujica解散，还告诉她祥子的朋友只是一场泡影。气不过的祥子却看到了mujica再次组建的消息，复活的mujica只有三个人，但是依旧收到了极大的关注。画面上的初华在愤怒的控诉着祥子的背叛，但是台下的观众认为这是舞台剧的世界观。&lt;/p&gt;
&lt;p&gt;随后，喵梦找到了祥子，对她表示自己歉意，并希望祥子可以回到mujica来，因为初华在高负荷的live已经快要坏了，喵梦认为只有祥子才能拯救初华。”当时你不是说要对我们的人生负责吗？初华她信了“。于是祥子在live开始的前半个小时来到了会场，而对此初华并不知情。在看到祥子和睦的回归后，初华只是沉默地背起了吉他，然后继续走向舞台。&lt;/p&gt;
&lt;p&gt;在舞台上，初华愤怒的指责祥子，喵梦帮祥子挡枪。于是舞台剧的部分变成了吵架现场。但是意识到事情不对的海玲在中途用音乐打断把舞台剧强行拉回了音乐部分。整体最终还是磕磕绊绊的结束了。初华本以为自己成功搞炸了mujica，但是mujica的舞台剧部分却被观众解读为逼真的演技而大获成功。&lt;/p&gt;
&lt;p&gt;祥子明白了初华失控的严重，但是初华已经不愿再搭理祥子，与此同时，祥子也因违抗丰川老爷的安排而再次被迫离开。祥子下定了要背负其他人人生的决心，再喵梦的怂恿下站在了初华家的门口。但是初华除了在舞台剧上外，再也没有对祥子说过一句话。&lt;/p&gt;
&lt;p&gt;时间转眼过了半年，虽然没有了丰川家的赞助，但是祥父站了出来来处理乐队的商务事物。初华越了解事情的全貌，越是发现每个人都有自己的苦衷，而只有自己是个傻了吧唧的痴情却没得到任何回报的人。于是初华最终在自我毁灭的道路上越走越远，乐队里的其他人都想拉住她，但是初华却只是沉默。初华每次在舞台剧中撕心裂肺的咆哮，最终都被观众解读为演戏。初华开始变成了全队里唯一的人偶，她在舞台上展示着真实的自己却被认为是在演戏，在台下的冷漠也被认为粉丝认为符合人设，队友想要拉她却被心之壁防住。初华的状态越来越差，嗓子开始出毛病以至于需要药物才能掩盖，但是乐队的人气却因为初华疯狂的演出一次比一次高。&lt;/p&gt;
&lt;p&gt;在全国巡演结束后，祥子想在对内召开一个庆功宴，但是初华并没有去。初华在ring的门口偶遇了爱音，问爱音看到自己的队友重演ccc团为什么无动于衷。爱音表示自己信任自己的队友，而自己的队友也信任着她。初华久久不语，而爱音被随后赶来的素世拉去演出。不久后下起了大雨，初华留在原地望着没有星星的夜空，不知道自己是否还能继续相信着祥子。&lt;/p&gt;
&lt;p&gt;另一边，祥子等不到初华一直着急，在社交媒体后看到爱音拉着初华的合照后急忙赶往ring找初华。初华在看到mygo的演出结束后，借了爱音的吉他上台临时加了一场solo表演。初华唱出了自己一年前为祥子偷偷谱写的情歌，此时初华的终于不堪重负，越到后面声音越小。solo结束后，已经几乎发不出声音，随后祥子赶到，最后把初华带回了初华家中。在初华家的门口，祥子发现自己的手机可以直接打开初华家的门锁，进入初华家后，被初华家的杂乱不堪所震惊，决定留在初华家照顾初华，初华没有答应，但是也没有拒绝。&lt;/p&gt;
&lt;p&gt;第二天乐队的其他成员也赶来看望初华，而初华告诉大家，自己已经唱不了歌了，可以把自己踢了，遭到了大家的一致反对。几天后mujica和sumimi暂停活动，祥子确实履行了自己背负他人人生的诺言，开始和初华同居来照顾初华。&lt;/p&gt;
&lt;p&gt;半年后，乐队决定转变方向到器乐摇滚上，祥子练起了小号，睦开始用螺丝刀弹电吉他，其他成员也开始尝试不同的乐器，乐队转向的决定终于让初华重新开始信任自己的队友。在mujica的复出演唱会上，再也没有主唱的声音，取之而代的是后摇的旋律。&lt;/p&gt;
&lt;h2 id="为何喜欢"&gt;为何喜欢
&lt;/h2&gt;&lt;p&gt;自己为什么会这么喜欢mygo呢？因为我喜欢看一群神经病少女一起撕逼扯头发，从这一点上我也许确实喜欢小时代。mygo与小时代不同的一点就是小时代推动剧情的方式是和混乱的男女关系，mygo里混乱的是女女关系，9个人各有各的心眼，关系混沌复杂，群像塑造的也不错。类似的作品要么只有两个女主（如石蒜，水魔），关系网太小。要么关系不够混乱、箭头太明显（如少女歌剧），或者剧情更偏“王道”，没有那种细腻而别扭（如gbc）。而mygo在结尾的时候，裂缝和遗憾依然存在，也许就是这种遗憾和缝隙感让我喜欢mygo，而类似的作品又没有第二个了。&lt;/p&gt;
&lt;p&gt;除开mygo本身的故事对我胃口之外，还有一点就是二创的丰富。回味mygo在开播前，是由一些mygo的小剧场和个人的翻唱的。其中素世的《剪切线》和爱素的膝枕小剧场在mygo没播出一集都会有新的体验。而且mygo剧内反复的回旋镖和镜头语言上的细节，都有不小的讨论空间。贴吧在欢快愉悦的解析这这些细节，造假药。那段日子p站上mygo的小黄文量大管饱，质量细腻。甚至还有《鼓手余名十日谈》这种非常优良的二创作品。&lt;/p&gt;
&lt;p&gt;大量的梗图、广泛的传播、和蔼的社区氛围最终把mygo捧上了一个不可思议他的高度，也引来了大量的观众。这些观众喜欢mygo的点各有不同，众口难调之下mujica根本经不起审视。大量的观众可以造神，也可以彻底摧毁mujica的社区交流环境。在滑坡之下，迅速传播的抽象鉴证梗图（如爱音退队，ccc复辟）进一步加深了观众对于番剧的偏差认知，形成了滑坡的恶性循环，最终一去不复返。&lt;/p&gt;
&lt;h2 id="结尾"&gt;结尾
&lt;/h2&gt;&lt;p&gt;我感到悲伤，不仅仅是为mujica动画本身而悲伤，还是为社区的崩塌而悲伤。我知道mujica有他的缺点，但是崩塌也不该如此剧烈。我所怀念的mygo在23年那个秋天，是我备战考研的孤独旅途中为数不多的快乐的时间，我对于这部番剧怀着太多多余的感情，不忍心看到如此结局。我感觉自己就像《老无所依》里的那个逃难的人，过去一切我认为美好的事物最终都远去了，撕裂了，连回忆都受到了影响。在解构、抽象、虚无盛行的时代，我感到无所适从。我也许可以改变自己，融入新的浪潮，成为其中的一份子，但是我做不到。&lt;/p&gt;
&lt;p&gt;我做不到。我最终成为了他人口中的被提纯的结晶和孝子，我成为了继续买武士刀周边的人，也成为了wsd可以肆意妄为的助纣为虐者，我的不愿改变反而使我成为了自己最讨厌的模样。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id="3月30分界线"&gt;3月30分界线
&lt;/h1&gt;&lt;p&gt;mujica在这周也是完结了。回望这一个月，不得不感慨出了好多事情。出了考研分数和分数线，在出分数的时候我感觉天都塌了，出分数线后天是彻底塌了。一个月以来过的是行尸走肉，mujica也在一路走低的同时步入尾声，最终在写下这段的文字的前几天完结。&lt;/p&gt;
&lt;p&gt;该如何说呢，不得不承认这第十集除了live外的情节拍的确实非常糟糕，剧透的东西不断应验也彻底为这部动漫判了死刑。相比之下第十一集整整二十分钟的舞台的表演我觉得拍的还不错。舞台戏嘛，我在xb3里品鉴了多的去了。说实话如果没有剧透的话我觉得这段情节其实整的还行？可惜剧透彻底摧毁了这一段。第十二集的追妻回倒是中规中矩，我甚至觉得无聊。没办法，在十二集这个节点上实在无法继续爆了，这部动漫的乐子属性也没了。第十三集拍了整整一集的live，歌也好听，顿时感觉那一千大洋的限定cd还是有点价值的。live除了喜欢怼海玲的屁股外，各方面也非常优秀，初华的啧嘴让人听爽了。&lt;/p&gt;
&lt;p&gt;我该说mujica烂吗？但是这部动漫在观看中带给我的乐子是实实在在的，有趣的二创、假药和非常高的讨论热度也是实实在在的，歌也好听。但是mujica好吗？无法忽视的演出硬伤和意义不明的设定确实令人难以恭维，如果把十二集的时长拉到二十四集也许会好上不少。总得而言，我认为mujica说不上多好，但是也绝没评分所说的那么烂。就好像小明剑魔所说的那样，不要太在乎动漫的评分。&lt;/p&gt;
&lt;p&gt;最后，这番还会出第三部，感觉生活似乎又有了盼头，吃上瘾了属于是。虽然不知道会整什么活，但是希望在第三部出来的时候，我自己的想写的一些东西可以写完。&lt;/p&gt;</description></item><item><title>2024游戏总结</title><link>https://woodman3.github.io/p/2024%E6%B8%B8%E6%88%8F%E6%80%BB%E7%BB%93/</link><pubDate>Thu, 16 Jan 2025 20:55:25 +0800</pubDate><guid>https://woodman3.github.io/p/2024%E6%B8%B8%E6%88%8F%E6%80%BB%E7%BB%93/</guid><description>&lt;img src="https://woodman3.github.io/p/2024%E6%B8%B8%E6%88%8F%E6%80%BB%E7%BB%93/125346593_p0.png" alt="Featured image of post 2024游戏总结" /&gt;&lt;p&gt;总结下今年玩的游戏，按时间排序。评价标准：
t0：无可置疑的神作。
t1：很优秀。
t2：平庸中的优秀，或者感觉不适合自己。
t3：平庸&lt;/p&gt;
&lt;h2 id="马里奥惊奇"&gt;马里奥惊奇
&lt;/h2&gt;&lt;p&gt;多到惊人的创意，惊奇花有种磕多了的感觉，很有意思，也很快乐。除了某个五星跳跃关卡特别操蛋之外，其他大不能关卡难度把握的都很好，而且徽章系统可以逃课。列位t1。&lt;/p&gt;
&lt;h2 id="cocoon"&gt;cocoon
&lt;/h2&gt;&lt;p&gt;不错的美术，解密有点深度但是不多，流程偏短，最大的收获就是知道了另一款同类的烧脑游戏《parabox》，列位t2。&lt;/p&gt;
&lt;h2 id="p3r"&gt;p3r
&lt;/h2&gt;&lt;p&gt;年初玩的，一直听说是p系列的顶峰，但是说实话感觉剧情上还是比较传统，剧情确实比p5r强一点但也就那样。沟槽的爬塔实在不想评价，战斗系统有一些特色但是感觉不如p5，朝自己脑袋开枪的画面和大招非常酷，狗日的阿特拉斯商法不想评价。列位t2。&lt;/p&gt;
&lt;h2 id="密特罗德究极复刻"&gt;密特罗德究极复刻
&lt;/h2&gt;&lt;p&gt;有些画面实在有些暗，战斗部分简陋但是可以理解毕竟是老游戏了。久闻地图设计惊艳但并没有超出预期，球模式有些时候跳不上去让人高血压，跑图时间过长差评。放在今天依旧优秀但还是过于原汁原味。列位t2。&lt;/p&gt;
&lt;h2 id="逆转裁判12"&gt;逆转裁判1，2
&lt;/h2&gt;&lt;p&gt;剧情优秀，但是辩论时该出示啥证据、该去哪儿有时候确实想不到。列位t1。&lt;/p&gt;
&lt;h2 id="星空"&gt;星空
&lt;/h2&gt;&lt;p&gt;没打完，打了一个大支线，优化一坨，mod稀少（没有涩涩也就算了，像滚5一样的另一个人生这种拓展玩法的mod也没有有点无法忍受），星球重复度高，主线流程还没打完（感觉主线有点通马桶，可能是我还没玩到后面的原因），但是支线还是挺有意思的。有点老滚那味。没办法，这味独此一家。列位t2。&lt;/p&gt;
&lt;h2 id="星际拓荒"&gt;星际拓荒
&lt;/h2&gt;&lt;p&gt;这个游戏是我复试失败后玩的。印象深刻，剧情非常好，可以排入人生中最令我深刻的剧情之一了，立意深刻。解密也非常有意思，但是有些地方确实不太容易想到（我是真的不知道灯笼鱼那该怎么过，后面是看攻略才知道的）。宇宙的深邃与孤寂令人着迷，氛围营造的相当不错。相比之下DLC虽然也不错，但是还是相较于本体逊色了不少，但是瑕不掩瑜，依旧是一款神作。列位t0。&lt;/p&gt;
&lt;h2 id="史蒂芬奇的记忆"&gt;史蒂芬奇的记忆
&lt;/h2&gt;&lt;p&gt;游戏界的百年孤独，解密不多。作为纯粹以剧情为卖点的游戏，沉浸感和氛围感做的很好，一个家族的历史走马观花似的呈现，被浓缩在了不到三个小时的时间里，如梦亦如幻。我还额为写了一篇博客来评价如此神作。列位t0。&lt;/p&gt;
&lt;h2 id="恶魔城晓月圆舞曲"&gt;恶魔城：晓月圆舞曲
&lt;/h2&gt;&lt;p&gt;用手机在模拟器玩的，刷魂系统做的挺不错，剧情感觉有点草率。虽然是古老的游戏但是依旧令人着迷，但终究还是太古老了，切魂繁琐，动作系统古老，只能列位t2。&lt;/p&gt;
&lt;h2 id="传送门revolution"&gt;传送门:Revolution
&lt;/h2&gt;&lt;p&gt;作为一个同人游戏，可以说是相当不错了。但是解密已经还是比较僵硬，剧情聊胜于无，但是对于这类游戏来说算是优秀。列位t2。&lt;/p&gt;
&lt;h2 id="学园偶像大师"&gt;学园偶像大师
&lt;/h2&gt;&lt;p&gt;万代的凯子手游，沟槽的万代和沟槽的抽卡系统不想评价。gameplay做的还行但是深度和多样性还是不行。建模可爱，喜欢肥球。事实上直到写下这篇文章我每天上班都会闲着打一把。但是手游实在不行，福利和抽卡资源稀缺，不予排位。&lt;/p&gt;
&lt;h2 id="老头环dlc"&gt;老头环dlc
&lt;/h2&gt;&lt;p&gt;出生的难度设计，幽默的火炬人，狗屎的奖励怀疑在侮辱人，敷衍的地图，比起本体过之犹不及的狗日boss。我打完后也写了一篇blog来吐槽。列位t2。&lt;/p&gt;
&lt;h2 id="罪恶装备斗争"&gt;罪恶装备：斗争
&lt;/h2&gt;&lt;p&gt;搓招搓不出来，单人部分比较薄弱，感觉还是大乱斗跟适合我。列位t2。&lt;/p&gt;
&lt;h2 id="黑神话悟空"&gt;黑神话：悟空
&lt;/h2&gt;&lt;p&gt;中规中矩的优秀之作。但是这个场景我确实喜欢。详细评测在另一篇blog。（想列t2的，但是个人私人感情加分很多，列位t1）&lt;/p&gt;
&lt;h2 id="渎神2"&gt;渎神2
&lt;/h2&gt;&lt;p&gt;中规中矩的银河城，最终boss没打。部分地图做的不错，但是沟槽的跳跳乐还是很多。某些强制打怪的关卡很离谱。列位t2。&lt;/p&gt;
&lt;h2 id="动物井"&gt;动物井
&lt;/h2&gt;&lt;p&gt;在PGN的节目被推荐玩的，解密上非常惊艳，难以想象的脑洞，只有35m的大小更是惊为天人，完全开放的探索架构让每个人都有不同的游戏体验。可以说是银河城的里程碑，列位t0。&lt;/p&gt;
&lt;h2 id="幸福工厂"&gt;幸福工厂
&lt;/h2&gt;&lt;p&gt;买了想和群友玩的，但是实在太肝，自己又要备考，看着屎山一样的流水线实在没有优化的动力，感觉自己不适合。列位t2。&lt;/p&gt;
&lt;h2 id="死锁deadlock"&gt;死锁（deadlock）
&lt;/h2&gt;&lt;p&gt;还在内测的游戏，形式上是dota2+tf2的杂交。游玩体验是全程压力和操作拉满，40分钟的一局几乎没有喘息的时间，全是博弈，爽！国庆就沉迷这款游戏了，就好这口博弈深度高的游戏。可惜挂对于体验得破坏实在严重，社区对于这种上手太难得游戏也是褒贬不一。希望正式版不要削减博弈深度，不要砍反补系统。列位t1。&lt;/p&gt;
&lt;h2 id="鼓手余名十日谭"&gt;鼓手余名十日谭
&lt;/h2&gt;&lt;p&gt;mygo的同人作品，免费，精致。但是剧情太积极了，无法满足我扭曲的心灵（而且没有女同画面）。在同人作品里算非常不错的。列位t2。（其实想给t1的，但是感觉还是不太合适，和传送门:Revolution一个档位已经很高了）&lt;/p&gt;
&lt;h2 id="小丑牌"&gt;小丑牌
&lt;/h2&gt;&lt;p&gt;一个挺不错的数值游戏，我开第二把的时候就通了，但是深度和策略还是不行。今年这个游戏居然能拿最佳独立和最佳手游完全无法理解，提名年度更是幽默至极，感觉德不配位，不如杀戮尖塔，列位t3。&lt;/p&gt;
&lt;h2 id="杀戮尖塔"&gt;杀戮尖塔
&lt;/h2&gt;&lt;p&gt;这肉鸽前面打不明白，有不错的策略深度，但是感觉随机性还是太大了些，玩不太明白。有点上瘾。列位t2。&lt;/p&gt;
&lt;h2 id="米塔"&gt;米塔
&lt;/h2&gt;&lt;p&gt;毛子出品的惊喜之作，好久没玩惊悚类游戏了，可惜流程太短。米拉可爱，剧情有意思但是不多。列位t2。&lt;/p&gt;
&lt;h1 id="一些遗憾"&gt;一些遗憾
&lt;/h1&gt;&lt;p&gt;火纹engage一直到现在还没打完&amp;hellip;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id="展望2025"&gt;展望2025
&lt;/h1&gt;&lt;p&gt;2025最期待的游戏大概还是怪物猎人荒野和gta6，杀戮尖塔2和mp4也值得关注，希望ns2的性能足够能玩高清60fps的怪猎、mp4和xb。不知道Pragmata和终末地在2025还能不能玩到。&lt;/p&gt;</description></item><item><title>中国建国后的简史——《筚路维艰》</title><link>https://woodman3.github.io/p/%E4%B8%AD%E5%9B%BD%E5%BB%BA%E5%9B%BD%E5%90%8E%E7%9A%84%E7%AE%80%E5%8F%B2%E7%AD%9A%E8%B7%AF%E7%BB%B4%E8%89%B0/</link><pubDate>Sun, 08 Sep 2024 19:52:18 +0800</pubDate><guid>https://woodman3.github.io/p/%E4%B8%AD%E5%9B%BD%E5%BB%BA%E5%9B%BD%E5%90%8E%E7%9A%84%E7%AE%80%E5%8F%B2%E7%AD%9A%E8%B7%AF%E7%BB%B4%E8%89%B0/</guid><description>&lt;img src="https://woodman3.github.io/p/%E4%B8%AD%E5%9B%BD%E5%BB%BA%E5%9B%BD%E5%90%8E%E7%9A%84%E7%AE%80%E5%8F%B2%E7%AD%9A%E8%B7%AF%E7%BB%B4%E8%89%B0/100526387_p0.jpg" alt="Featured image of post 中国建国后的简史——《筚路维艰》" /&gt;&lt;h2 id="起始"&gt;起始
&lt;/h2&gt;&lt;p&gt;某日水群，一个群友发了一段很有意思的历史资料，具体是啥我已经忘了，但是我问了下其书的名字，这本书就是现在要讨论的书——《筚路维艰》。&lt;/p&gt;
&lt;h2 id="新民主义社会"&gt;新民主义社会
&lt;/h2&gt;&lt;p&gt;上一次把这段历史时期和其他时期详细的区分开，还是在初中的历史课堂上。令我惊讶的是原来但是中共的领导人不仅支持资本主义的发展，还要不少人认为这一段历史时期是不可跳过的。文中对于刘少奇的言论，四个自由的口号和这段时期内对于资本家的放任更是令人震惊。在联想到抗美援朝时期上海罐头厂把发霉的罐头拿去支援前线，不仅令人唏嘘。后面的三反五反也是历史书上从未提到的。但是本书也对三反五反比较略写，感觉这段时期也值得进一步调查。&lt;/p&gt;
&lt;h2 id="效仿苏联"&gt;效仿苏联
&lt;/h2&gt;&lt;p&gt;历史书上对于发展重工业这件事比较清淡描写。但是书中提到党认为应当先发展轻工业才能发展重工业，还认为重工业必须要在国外的援助下才能得以进行。这是为啥什么？值得思考。发展重工业的同时还要求老百姓提高储蓄率，这一点有是为什么？文中也没有提及。但是可以看出，建国后重工业的发展，苏联的工业大礼包应该实实在在的帮了很大的忙。
里面还提到了斯大林一开始对中共并不友好，苏联的工业大礼包是在抗美援朝之后才有的，那么问题来了，在此之前，甚至建国前和抗日时期，斯大林对于中共的态度有是如何的呢？更有趣的一点是：毛泽东在私下表示不喜欢斯大林，想要突破模范苏联的道路，并且在斯大林死后也跟着批判斯大林。尽管批评斯大林后面又在波匈事件后改观了，我们也许可以从中窥见中共和苏联的关系。
波匈事件是一个很大的事件，他使国内的双百政策变为了引蛇出洞，为之后的反右和一系列悲剧埋下了伏笔。但是这个事情本身却并未介绍。日后应该查查。
陈云提出的统招统购，榨干了农民，但是在当时，却并没有更好的方法，因为你到底还是要发展重工业。毛也提出了同时发展一些轻工业改善民生，但是发展的如何，我们不得而知。&lt;/p&gt;
&lt;h2 id="不再模仿苏联"&gt;不再模仿苏联
&lt;/h2&gt;&lt;p&gt;我们看到了在毛的个人崇拜和全党上下急于求成的作用下，各地疯狂的走向集体化，并且在之后看到了没有机械的情况下集体农业又把苏联的老路走了一遍，毛一直都想避免走苏联的路子，但最后还是走了一遍。
为了超越苏联，毛提出了自己的东西，显然这些东西并不太好，甚至可以说是非常糟糕。我们看到了信阳事件造成的惨状，看到了被称为天府之国的四川成了饥荒最终的地方。但是出乎意料的，大跃进和人民公社的原因有一部分竟然是中央权力的下放，基层只对中央负责却不对人民负责造成的，令人倍感意外。
饿死的都是农民，而城市里的人却饿死不多。这次事件在书中被定义成了人祸，主要原因是减产的情况下却提高了采购指标导致的，但是仔细想想，如果采购指标下降，城市里的人又该如何？彼时重工业的发展已经开始，城市里的人口在重工业发展的脚步中激增，如果不提高采购指标，并允许农民保留自留地，想想之前的粮价飞涨，城市里饿死人也许会造成更加可怕的影响，使中共在日后改革开放反对的声音更大，唉。
书中反复提到了一个标志性的事件——庐山会议，这是中央本来决定放缓使却反而把油门踩死的转折，也是毛个人崇拜、彭德怀等人遭到迫害的一次事件，日后也该留意这次事件。&lt;/p&gt;
&lt;h2 id="文革"&gt;文革
&lt;/h2&gt;&lt;p&gt;经过了一系列的铺垫，文革开始了。从建国的历史一路看过来，多少能明白文革发动的起因，也多少能明白文革发动具体所造成的影响。毫无疑问的是，文革确确实实是一场浩劫。造成的直接财产损失和人员伤亡数不胜数。但会过头来看，毛对于党内出现了走资派、官僚主义盛行、党内干部开始鱼肉百姓，成为了一个新的剥削阶层等等判断在如今的我们看来确实有一定的道理，至少这些问题在如今的党内是确确实实存在的。苏联的斯大林对此采取的方式是是用暴力机关直接对党内进行清洗。毛不想走斯大林的老路，于是他把希望寄于群众，于是我们就看到了文化大革命——这个也许是人类历史上最大的民粹运动，的发动。
但尽管不可否认文革造成了巨大的损失，但是他在事实上也清洗了国家内所有的高层和中层人员，使得日后的改革在高层和中层没有多少阻力。
有时候也会幻想另一条世界线，如果毛的去世稍微早一些，比如在邓被委以重任之前，那么也许国家当权的就是四人帮，邓派于四人帮的斗争也许会推迟改革开放的时间，甚至会使中国无法走上改革开放的道路。而如果毛去世的晚一些，那么有可能邓会再次被冷藏直到毛的去世，甚至死去，改革开放的进程被推迟或者由于邓的时日无多而走更多的弯路。
在文革中最重要的文件，那就是571工程纪要了。这一文件诞生于70年的庐山会议之后（另一个庐山会议，这个会议也很重要），直接导致了林彪事件。而这份直接批评毛的文件却被毛下令下发至党内干部，哪怕影响了毛的个人威信。而今天这个却成为了禁书。令人感叹。&lt;/p&gt;</description></item><item><title>聊聊国产第一个3a单机</title><link>https://woodman3.github.io/p/%E8%81%8A%E8%81%8A%E5%9B%BD%E4%BA%A7%E7%AC%AC%E4%B8%80%E4%B8%AA3a%E5%8D%95%E6%9C%BA/</link><pubDate>Wed, 04 Sep 2024 23:32:53 +0800</pubDate><guid>https://woodman3.github.io/p/%E8%81%8A%E8%81%8A%E5%9B%BD%E4%BA%A7%E7%AC%AC%E4%B8%80%E4%B8%AA3a%E5%8D%95%E6%9C%BA/</guid><description>&lt;img src="https://woodman3.github.io/p/%E8%81%8A%E8%81%8A%E5%9B%BD%E4%BA%A7%E7%AC%AC%E4%B8%80%E4%B8%AA3a%E5%8D%95%E6%9C%BA/st31010.jpg" alt="Featured image of post 聊聊国产第一个3a单机" /&gt;&lt;h2 id="一切的起源"&gt;一切的起源
&lt;/h2&gt;&lt;p&gt;这个游戏是我高中毕业那年的时候才知道的，当时游戏科学公布了一段实机演示。这段演示热度非常高，但是在我看来这些都是些空中楼阁，彼时的我并不认为，一家毫无积累的公司，能做出一个3a游戏。在我看来，尽管彼时中国已经有了一定数量的正版玩家，但是主流玩家终究还是以网游和手游为主，游戏收入的大头也在这里，没有给3a游戏发育的土壤。
后来我和同学聊天时，我同学激动的对我说，他非常期待时机中和四大天王对决的场面。我告诉他，一些大厂已经开始挖游戏科学的人了，我悲观的预测，这个游戏要么胎死腹中，要么又是一款虎头蛇尾，优化奇差的圈钱游戏，只会消耗国人对于国单的热情。而我的同学不以为意，他认为游科的人会忍住高薪的诱惑把游戏做完才跳走，这样那些员工才有更加优秀的简历。我在内心暗暗嘲笑我的同学在大学还没学贪心算法，不懂人心。
我那个玩原神的大学舍友也告诉我，尽管他玩盗版游戏，但是如果黑神话出了他一定会买一份来支持国产，我则直言他种不玩单机游戏的手游玩家还是不要在这上面浪费钱为好。他不悦的问我买不买，我回答如果风评不错我会考虑买一份。
彼时才2021年，我看到太多的人对于这个只有一段实机的游戏给予了不该有的厚望，我只是叹息，国单这些年什么鸟样，我还是知道的。但是steam比较引入注意的国单，还是三色绘恋这种galgame，出一个3a？怎么可能呢。&lt;/p&gt;
&lt;h2 id="沉淀"&gt;沉淀
&lt;/h2&gt;&lt;p&gt;在发布实机后，游科保持着一年发一段频率更新的游戏的开发进度。每次游科发一小段视频，都会有一些up主一本正经的分析。我只觉得好笑，一段演示有啥好分析的？好不好玩到手不就知道了？慢慢的，知乎也可是逐渐变成米乎，对于这个游戏逐渐也开始充斥着贬低，要么拿这个游戏拐米，要么嘲笑一波老钟，我也受够了在知乎吃屎，从此卸载了知乎。
后来这个游戏的质疑也开始逐渐变多，贴吧也开始有了不少串子，其中黑神话吧也出了不少乐事，比如吧主赛博乞讨，b站一如既往的给予厚望。而我在内心暗自嘲讽b站这些用户有多少会付钱呢？
后来有一次线下试玩，各大主播都给出了不错的评价，但是鉴于2077等游戏的教训，我依旧选择观望。
在公布发售日的时候，定价也一并公布了，268的定价，知乎一如既往的评价不如原神，同时嘲讽b站那些嫌定价低的压根不会出钱买。在当时的我看来，这个定价确实还挺合适的，当然，他的质量得过关。
后来公布了最终预告。在发售前夕，上架了一个性能测试的小工具，在这个时候我身边不少朋友已经预购了黑神话，而关于测试的梗图也在传播，我下载了测试工具，发现自己笔记本的3060居然跑的还挺不错，而在我拿到工资的那一天，我想了想，还是决定也预购一份，如果暴雷了就当是眼瞎了。而且彼时各大测评机构也公布了自己的评分，国内媒体清一色的满分，这般阵仗我以前也不是没见过，所以我只购买了标准版。哪怕到这个时候，我对游戏的质量依旧有一些怀疑。&lt;/p&gt;
&lt;h2 id="游玩"&gt;游玩
&lt;/h2&gt;&lt;p&gt;游戏正式发售的时候，我的一些朋友还想着请假去玩黑神话，而我则在公司看着群友的评价，看到群里没有骂声，我悬着的心也放下了一些，难道我国真的要有自己的3a大作了？抱着这一丝小小的疑问，我在下班后，也打开了游戏。
第一眼打开游戏，是十分惊艳的， 玩了太久的ns游戏，第一次看到虚幻5带来的游戏画面，竟有了一种刘姥姥进大观园的感觉。正式进入游戏就遇到了被人吐槽的空气墙，但是之前在群里已经知道，所以还好。
制作人在一开始曾经强调过，这个游戏不是类魂游戏而是类战神游戏，但是在我看来他还是吸收了不少魂类游戏的元素。整体体验跟像是只狼而不是其他人所说的仁王。&lt;/p&gt;
&lt;h3 id="地图设计"&gt;地图设计
&lt;/h3&gt;&lt;p&gt;整体的地图设计，其实挺不错的，有一些岔路，但不多。地图的整体颜色由于过于单一，所以看到岔路心里就有些烦。第三章苦海那儿四条岔路，实际上只有一条。但是这上来就给四条岔路确实有些让人摸不着头脑。同样是第三章的快活林，两条长岔路让人摸地图也不得不打开网上的攻略地图。第四章也存在同样的问题。而且第四章盘丝洞里不仅色彩单一，元素也大差不差，让人想起了嗜血代码里的教堂。
地图有时候又会有非常明显类魂的恶意这一点在浮屠界尤为明显，独木桥、
把你丢下悬崖的投技、扣你血上限的地图机制。幸好这种东西在游戏中只有浮屠界。而在第四章大把大把的毒怪、第五章的火池，你说这没学魂我是不信的。
但是到了第五章，地图一下回到了最原始的一本道。让人怀疑是不是开始赶工了，而到了第六章，直接给了筋斗云后，地图反而不像是箱庭而像是开放世界，以至于尽管第六章塞了不少东西，依旧被人诟病怀疑赶工。&lt;/p&gt;
&lt;h3 id="动作设计"&gt;动作设计
&lt;/h3&gt;&lt;p&gt;在我看来，黑神话的动作设计大于只狼，低于战神。如果说战神在动作这一块有80分的话，黑神话大概是70分，尽管碰不了传统的act游戏（当然在我看来战神其实更偏arpg一些），但是和大部分arpg相比还是优秀的。但是动作模组还是比较单调。比如三种架势居然共用同一套轻击模组，架势改变的仅仅是切手技和重击。轻击没有对应的蓄力攻击，有类似猎天使魔女的offset但是在教程中没有明确提到。枪的动作模组尽管一定程度上缓解了轻击模组的单调，但是我在游玩过程中只拿到了两把枪，其中一把甚至是整个游戏都要打完了才拿到的。
精魄和变身一定程度上丰富了游戏的战斗体验，但是精魄只能携带一种，变身的cd又有些长，又给了一种带着镣铐跳舞的感觉。精魄升级需要的资源不少，也导致了我40多个小时的游玩时间里使用的精魄其实就寥寥几种。
在预告中，出现了把金箍棒当回旋镖的片段，但是在游戏中主角反而没有这个动作，而这个动作被放在了最终boss上，后来有人经过尝试，发现这个动作也可以通过一定的手段使用出来。令人疑惑为什么这个动作像是被藏起来了一样。游戏中的主角其实缺乏远程攻击的手段但是由有着非常强大的防御远程攻击的能力，这也导致了第二章主角被老鼠射爆时不少人恨得咬牙切齿。几只老鼠在高处射你，他们打不了你可是你却打不到他们，你只能和老鼠干瞪眼，唯一的解法就是绕路。所幸这种情况在游戏中并不多见。
总体来说，黑神话的动作游戏其实是优秀的，但是距离顶尖还是有一定的差距。&lt;/p&gt;
&lt;h3 id="怪物设计"&gt;怪物设计
&lt;/h3&gt;&lt;p&gt;好不夸张的说，怪物设计这一块黑神话可以甩战神好几条街，前四章几乎没有换皮怪，怪物的战斗模组丰富。令人十分惊喜。可见其推料只充足。boss种类多到了一种奢侈的地步，隔壁老头环都不比上。各类怪物都要各自的背景故事直接写在资料里，而且这些背景故事的质量还非常不错。比类魂游戏高到不知道哪里去了。
在怪物的配置方面， 地图里几乎没有堆怪现象。仇恨也不是吸的很死。这点可以超过了市面上大部分的类魂游戏。
游戏中存在着令人破防的粪怪吗？有，但是不多，大部分boss的快慢刀比起隔壁老头环可以说是仁慈。有些boss数值给的很高（青背龙，敌毒），但是经过一定的练习还是能过去的。有些怪物比较大，玩家只能修脚，但是这些怪物在重击打出硬直后玩家也可以攻击其弱点。游戏中令我觉得不适的boss主要有两：百眼，身上的空气墙让我能空很多次，多动而且无法让他趴下给我一些的输出空间。其次便是紫色魔将，经常性的瞬移和防不胜防的激光差点让我破防。除了boss，一些小怪也有其粪点，第三章的高韧连击光头、会飞的同时还给你上冰冻buff的鸟人、出手毫无预兆的海上僧，得到了大部分人公认的粪怪评价。
但是游戏中依旧存在着一些设计出色的boss，比如寅虎，大开大合，闪避时的特写停顿，尽管难但是打起来依旧爽快。小黄龙也是，长连段但是并不急，有拼刀但是依旧可以识破。敌毒伤害爆炸但是自身血量也低，打起来摸清了规律也还好。黄眉的演出十分不错。大圣、二郎神等也是打起来有一种酣畅淋漓之感。
不仅如此，本作的一对多和多对一也做的不错，大量的1对多都是对方轮番上阵，但是同时又有一些配合，这一点在打四大天王时尤甚，本来1v4应该是非常困难的，但是实际上打起来非常爽快，尤其是处决的演出。而在多对1的时候，比如和老猪联手。这个时候老猪虽然输出不高，但是在关键时候会给你回血，还会吐槽你的表现，即没有“没了老猪就打不过”也没有“这老猪屁用没有”的感觉。和老头环对比起来实在是高下立判。（尤其是老头环打双铁处女那，我打到那里时恨不得把电脑砸了）。&lt;/p&gt;
&lt;h3 id="剧情"&gt;剧情
&lt;/h3&gt;&lt;p&gt;本作的剧情不乏批评之声，我的一些群友就直言第五章的剧情写的是一坨狗屎。但是对于评鉴过火焰纹章if的这种真狗屎的人来说，剧情差点只要别有一些政治上的原则性错误其实问题不大。更何况在我看来，本作的剧情其实不错，哪怕是第五章写的也不错。可能是我对剧情的接受程度比较高吧。
有人锐评猴哥是小丑，我不太明白其想法。我感觉当今对于任何失败的评价都扣上一个小丑的标签，多少有点让人不适。对于原作改编这种行为，我的看法和大多数人一致：别瞎改就成，但是怎么才算瞎改，怎么才算合理的改编，这里不同的人看法也不同。在我看来，黑神话的改编做的其实不错。而其他人对于黑神话是游科之前做的斗战神的继承，我觉得无可厚非，何必在乎这些细枝末节呢？
在讨论剧情之余，文中的台词和配音也是非常有意思。说来奇怪，在此之前我一直觉得2077的配音不错，但是在玩了自家的游戏之后，才明白中文配音应该是什么样子。六丁六甲、老猪、黄眉、二郎神的台词都没有任何违和生硬之处。
初次之外，藏在神影图中的小故事，没章结尾的动画，做的都非常优秀，尤其是第三章结尾的动画《屁》，于西方的性本恶、生来有罪论那套完全相悖，非常对我的胃口。&lt;/p&gt;
&lt;h2 id="社区"&gt;社区
&lt;/h2&gt;&lt;p&gt;在游玩的时候，社区氛围也挺不错，s1游戏版里几乎全是黑魂，上一次看到如此盛况还是老头环。就连知乎的态度都有了极大的改变，整体都因此看着顺眼了不少。
社区已经开始畅想今年的tga了，但说实话，不到一个月销量高达两千万，又何必在乎这个tga呢？有人锐评黑神话不如那些顶尖的大作，在我看来，黑神话可能确实需要一些打磨，但黑神话顶尖的美术，而且其他各项都不错，评质量拿下今年tga是完全没问题的。而且今年确实没啥其他更加优秀的大制作的作品了。但是由于黑神话硬刚欧美的政治正确，tga大抵确实拿不到了吧。&lt;/p&gt;
&lt;h2 id="展望"&gt;展望
&lt;/h2&gt;&lt;p&gt;对于国产3a这个命题，其实在现在已经明确了：中国确实能做出自己的3a单机。而且中国的玩家也完全养得起国产3a单机。而国产3a必须要传统文化吗？我看未必，在我看来国产3a只有是中国人做出来的就够了。一个土生土长的中国人的灵魂已经被打上了这片土地的烙印，无法轻易洗去。他们做出来的游戏哪怕故事是外国的，其内核也带上了这片土地独有的东西，这一点是我可否认的。
我希望未来能玩到中国人做的坑日战争的游戏，也希望能玩到战国春秋的游戏。也许这些游戏在五六年后，就会如井喷式的出现，对此，我抱着期待。&lt;/p&gt;</description></item><item><title>走进农民的生活，《江村经济》</title><link>https://woodman3.github.io/p/%E8%B5%B0%E8%BF%9B%E5%86%9C%E6%B0%91%E7%9A%84%E7%94%9F%E6%B4%BB%E6%B1%9F%E6%9D%91%E7%BB%8F%E6%B5%8E/</link><pubDate>Sat, 03 Aug 2024 15:29:07 +0800</pubDate><guid>https://woodman3.github.io/p/%E8%B5%B0%E8%BF%9B%E5%86%9C%E6%B0%91%E7%9A%84%E7%94%9F%E6%B4%BB%E6%B1%9F%E6%9D%91%E7%BB%8F%E6%B5%8E/</guid><description>&lt;img src="https://woodman3.github.io/p/%E8%B5%B0%E8%BF%9B%E5%86%9C%E6%B0%91%E7%9A%84%E7%94%9F%E6%B4%BB%E6%B1%9F%E6%9D%91%E7%BB%8F%E6%B5%8E/120930938_p0.png" alt="Featured image of post 走进农民的生活，《江村经济》" /&gt;&lt;p&gt;费孝通先生写了两本神书，分别是《乡土中国》和《江村经济》。这两本书不仅介绍了近代中国农村在建国前的种种情况。《乡土中国》介绍了了中国农村人民的精神思想和社会制度，其中对于礼制和德治的讲述令人印象颇为深刻，地域不同使得中医深入人心也在书中有一定的解答。而《江村经济》也是从农村入手，剖析了农村的生产方式，城镇对于农村的影响，婚姻和亲缘关系对于经济的影响，已经农村在那个年代改革所作的尝试和努力，这些内容直到今天有不小的借鉴意义，非常值得一看。&lt;/p&gt;
&lt;p&gt;对于农村纺织业的改革非常有意思，国家想要增加出口，农民想要增加收入。但是先进的生产方式不那么容易引进。由原本的分离的家庭小作坊转移到工厂需要资金和人力，但是这笔钱农民并不是很愿意出。工厂的钱大部分由政府的贷款完成，尽管工厂在第一年有盈利（1929年）但是在之后的两年都是亏损，即使工厂亏损农民依旧需要继续投钱，可以看出外地的倾销和政府无法进行价格管控对于改革是不利的。令人惊讶的是，这中改革制度是合作社的制度，看来哪怕是国民党也想通过这种社会主义制度来发展生产，但是就如作者所说，本来应该被投入改革的钱大部分被用以反共，实在令人叹惋。&lt;/p&gt;
&lt;p&gt;改革有可能带来的不仅是农民收入的提高，还有的是大部分原来在家从事纺织业妇女的失业，这些失业的妇女没有重新回到田地生产，而是进城打工。打工发的工资使得妇女有了个人收入，使妇女的地位上升。有一个例子，讲述了地位上升的妇女和厂中的男人偷情，导致被工厂开除，又被丈夫离婚，回到娘家的妇女地位还不如之前。&lt;/p&gt;
&lt;p&gt;在农村中，没有完善的信用体系，而农民又不会通过法律来维护自己的权力，导致了在某些时候高利贷把农民的土地剥脱。在一个例子中，一个农民借了7元，却要还30元，令人震惊。&lt;/p&gt;
&lt;p&gt;我觉得，中国农村家庭纺织业的变化和如今ai绘画对于产业的冲击，有一些相似性。但区别在于：纺织业尽管是农村家庭的主要收入来源，农村的主业依旧是耕地。但是画家如果借不到单子又没有丈夫（或者伴侣）的经济支撑，难以想象会发生什么。而且纺织业在以前的经济中占有一定分量，政府会引导和扶持，如今的插画行业可能就只能交由无形的大手了。但是乐观的看，插画这个行业可能会像肖像画一样萎缩，但是绘画作为爱好却不一定会受到多大的影响，只是方向可能会有所转变罢了。&lt;/p&gt;
&lt;p&gt;在书的末尾，介绍了农村的船运。对于这一行业的描写让我想起了《边城》，可惜我对于这篇小说的记忆已经不多。对于船业的描写让我感慨物流行业的暴利，这也让我更加疑惑：美国的邮政行业是如何做到亏损的？&lt;/p&gt;</description></item><item><title>回望时代的缝隙中的俄罗斯，《卡拉马佐夫兄弟》</title><link>https://woodman3.github.io/p/%E5%9B%9E%E6%9C%9B%E6%97%B6%E4%BB%A3%E7%9A%84%E7%BC%9D%E9%9A%99%E4%B8%AD%E7%9A%84%E4%BF%84%E7%BD%97%E6%96%AF%E5%8D%A1%E6%8B%89%E9%A9%AC%E4%BD%90%E5%A4%AB%E5%85%84%E5%BC%9F/</link><pubDate>Wed, 24 Jul 2024 23:20:11 +0800</pubDate><guid>https://woodman3.github.io/p/%E5%9B%9E%E6%9C%9B%E6%97%B6%E4%BB%A3%E7%9A%84%E7%BC%9D%E9%9A%99%E4%B8%AD%E7%9A%84%E4%BF%84%E7%BD%97%E6%96%AF%E5%8D%A1%E6%8B%89%E9%A9%AC%E4%BD%90%E5%A4%AB%E5%85%84%E5%BC%9F/</guid><description>&lt;img src="https://woodman3.github.io/p/%E5%9B%9E%E6%9C%9B%E6%97%B6%E4%BB%A3%E7%9A%84%E7%BC%9D%E9%9A%99%E4%B8%AD%E7%9A%84%E4%BF%84%E7%BD%97%E6%96%AF%E5%8D%A1%E6%8B%89%E9%A9%AC%E4%BD%90%E5%A4%AB%E5%85%84%E5%BC%9F/121061188_p0.jpg" alt="Featured image of post 回望时代的缝隙中的俄罗斯，《卡拉马佐夫兄弟》" /&gt;&lt;p&gt;俄国文学都有一个比较普遍且直观的特点——厚。在图书馆的时候往俄语文学那扫几眼，一般也没几本薄的书。&lt;/p&gt;
&lt;p&gt;但是俄国文学作为文学界的t0，不读几本，实在有些遗憾。这么多大师这么多书，那只能挑大师中的大师，杰作中的杰作。在挑书的时候我正试图找一些虚无主义相关的文学，一些外国读书网站推荐了《卡拉马佐夫兄弟》。在此之前我从未读过陀翁的书，于是乎我看了看这书的厚度，又想了想自己正在处于考研复习的阶段，果断放弃了这本书。考研结束后，时间空了出来，我也在这等待成绩到进厂打工的这半年里，断断续续的读完了这本书。&lt;/p&gt;
&lt;h2 id="背景"&gt;背景
&lt;/h2&gt;&lt;p&gt;这本书写于1878年，距离巴黎公社的失败已经过去了七年，但是社会社会的景愿却没有消失，陀翁在年轻的时候就开始对社会主义感兴趣，不知道他有是如何看待巴黎公社的失败的。陀翁出生于地主阶层，而写这本书时俄罗斯离废除了农奴制没过多久。陀翁在年轻时因为反对沙皇而入狱，差点被枪毙，但是他不会知道，在他死的50年后沙皇全家将被清算。他更不知道的是，距离他的死亡只剩三年，躺在病床上的他是否已经构思好了卡拉马佐夫这一巨著的下部，我们不得而知。&lt;/p&gt;
&lt;p&gt;文学史上有不少未完成的名著，但未完成并不妨碍他们在文学的历史上留下属于自己的痕迹。《城堡》如此，《红楼梦》如此，《卡拉马佐夫》亦是如此。&lt;/p&gt;
&lt;h2 id="人物"&gt;人物
&lt;/h2&gt;&lt;p&gt;这本小说除了毛子特有的大部头之位，还有的就是他那极度冗长的人名。里面的人名比《百年孤独》还有冗长，而且同一个人还有一些小名，这给初始阅读造成了极大的困难。但是万幸的是，书在一开始就有一个简要的人物表，囊括了书中出现的所有人物。而且在书的开头就花了一个章节来介绍主要人物的生平和性格，这也在一定程度上降低了阅读难度。&lt;/p&gt;
&lt;p&gt;有时候我可以看出作者对人物的偏爱。比如阿辽沙，一个虔诚的基督徒，天真而善良，人人都喜爱他。某种意义上这本书所写的就是阿辽沙一步一步变成圣徒的故事，如果这本书顺利写完的话。大哥米嘉，也许是作者心中俄罗斯人的化身，易怒，暴躁，鲁莽，浪费且花钱如流水。却又正直，信仰上帝。但是其他人可能就不被作者所喜爱了，二哥，一个进步主义者，理智，不相信上帝，认为宗教不过是一个被编造出来的故事，有点虚无主义的倾向，却在书的最后表现出了人格分裂，内心痛苦，疯疯癫癫。阿基津，社会主义者，却表现的像一个骗子、小人。以及私生子，一个身世悲惨，寡言少语的角色，受了些二哥的影响，最后自杀，被作者认为是恶魔。&lt;/p&gt;
&lt;h2 id="宗教"&gt;宗教
&lt;/h2&gt;&lt;p&gt;本书最为让人津津乐道的就是其中关于宗教的讨论了。但遗憾的是，我成长于中国，不信苍天不问鬼神，对于宗教的理解就是一个虚构的故事。难以理解书中的人不信教为啥就被如此批评，而且书中二哥也表达了他的观点：不信教不代表没有了道德。但是书中的其他人都对这点表示否定，在今天我们明白他是对的。&lt;/p&gt;
&lt;p&gt;除了宗教，书中的神迹、长老的话语都使我非常迷惑，在我看来这就是哄人的鬼把戏。在第二章时我在内心对于这位长老实在没什么好感，因为在我看来所谓神职人员都是拿着空饷骗吃骗喝的家伙。后来长老死时，身体散发出腐臭，我认为这应该时本书的转折，这意味着封建迷信终究敌不过物理定律。但是作者似乎更愿意描写阿辽沙在面对此景依旧在内心坚信上帝，让我很不自在。&lt;/p&gt;
&lt;h2 id="审判"&gt;审判
&lt;/h2&gt;&lt;p&gt;书中另外依旧反感的一点，那就是对于审判的态度。书中不断的强调大哥的内心如何受折磨，又如何描写加科夫的一副冷静的样子。大哥一开始还想着去西伯利亚赎罪，最后还是决定逃跑，在更早之前还有长老遇到的一个谋杀犯。我看到这都有些想笑，书中似乎在强调一个观点：一个人在心灵上受到的惩罚可以抵扣他在现实中犯下的罪过。在我看来如果一个人在内心中犯了罪应该得到心灵上的惩罚，在现实中犯了罪自然也应该得到现实上的惩罚。&lt;/p&gt;
&lt;p&gt;还有一点让人深思：大哥该死吗？站在上帝视角的我们知道，大哥是冤枉的，但是如果所以的证据都指向他，而他自己也在之前无数次扬言要弑父，他依旧该死吗？我们现实中遇到这种案件确实非常棘手，因为现实并没有所谓的上帝视角，在我们看来大哥就是有罪的。但是话有说回来，大哥真的没有弑父吗？也许是作者在玩弄叙述者的诡计呢？也许二哥所经历的不过是自己的妄想呢？我们不得而知。&lt;/p&gt;
&lt;h2 id="时代"&gt;时代
&lt;/h2&gt;&lt;p&gt;书中描写的时代，是一个处在变迁中的时代，不同的人代表着不同的思想。我无法得知作者代表着谁，但是可以从作者对于笔下人物的态度来猜测作者在思想上可能没那么激进。他依旧相信着宗教的力量，认为宗教可以拯救世人，而那些意图推翻宗教的人则是一群骗子、混蛋。&lt;/p&gt;
&lt;p&gt;我们从未来视角看来，多少会感受到一些不可理解之处，但是对于当下的自己来说，自己又何尝不是一个守旧的人呢？我无法理解短视频的好处，无法与互联网上的变性人共情，抵触如今的虚无主义和解构主义的思潮，依旧信仰着民族和国家的叙事。我有与陀翁有何区别呢？陀翁留下的巨著对于人性何社会的描写令人叹服，而我留下的小作文又有几人会理解呢？&lt;/p&gt;</description></item><item><title>前缀和算法及其分段版本的并行化方法</title><link>https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/</link><pubDate>Wed, 24 Jul 2024 15:03:27 +0800</pubDate><guid>https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/</guid><description>&lt;img src="https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/120645705_p0.png" alt="Featured image of post 前缀和算法及其分段版本的并行化方法" /&gt;&lt;p&gt;cmu15418在2012年的课程里还有讲这个算法，但是现在我在他的课程大纲上已经看不到这个算法的讲解。
国内外关于这个算法的资料大多数也是少的可怜。故作此文。&lt;/p&gt;
&lt;p&gt;前缀和一般有两种形式，一种在计算时会加上当前的元素（inclusive），另一种则不会（exclusive），本文所述皆为后者。&lt;/p&gt;
&lt;p&gt;本文为简便起见，皆使用openmp的方式并行。&lt;/p&gt;
&lt;h2 id="基础前缀和"&gt;基础前缀和
&lt;/h2&gt;&lt;h3 id="串行"&gt;串行
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;exclusive_scan_seq&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;OP&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;很简单，没啥好说的&lt;/p&gt;
&lt;h3 id="并行"&gt;并行
&lt;/h3&gt;&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/cmu-1.PNG"
width="1431"
height="1076"
srcset="https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/cmu-1_hu_83a2e827359a0f49.PNG 480w, https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/cmu-1_hu_47ddcca186833c7d.PNG 1024w"
loading="lazy"
alt="cmu课件配图"
class="gallery-image"
data-flex-grow="132"
data-flex-basis="319px"
&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;exclusive_scan_par&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;OP&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(;&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#pragma omp parallel for
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#pragma unroll
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-=&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(;&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#pragma omp parallel for
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#pragma unroll
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-=&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;temp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="n"&gt;temp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;程序的前半部分我称之为前向传播（在论文原文中为up-sweep），后半部分我称之为反向传播（down-sweep）。&lt;/p&gt;
&lt;p&gt;cmu15418的ppt给的配图里的数组长度刚好为2的幂次方，但是如果数组不为2的幂次方，那么情况会有些许麻烦。
想要理解算法的全过程，可以试着先理解反向传播，在去看正向传播。因为我们不难注意到：初始值是在反向传播的过程中才开始被加入到数组中的。
而根据前缀和的定义，在反向传播的过程中，这个初始值势必会传播到数组上的所有位置。记住这一点，反向传播的过程就好理解多了。&lt;/p&gt;
&lt;p&gt;我们不难发现，数组的最后一个元素实际上不影响后续的操作，因为反向过程会把数组的最后一个元素设置为初始值，所以我们可以略过最后一个元素。&lt;/p&gt;
&lt;p&gt;尽管他的复杂度也为$O(n)$，但是根据实际测试（openmp的线程数设置为16），其所消耗的时间依旧比串行版本更久，
查看编译器生成的汇编后发现，并行版本的前缀和每次循环所需要的指令比串行版本的多的多，而且编译器不会自动做向量化处理。
通过perf工具还会发现并行版本对cache的访问次数是串行的十倍左右，而且局部性也不太好。&lt;/p&gt;
&lt;h2 id="分段前缀和"&gt;分段前缀和
&lt;/h2&gt;&lt;p&gt;相比传统前缀和，我们额外增加了一个&lt;code&gt;flags&lt;/code&gt;来把数组分成大小不同的几段，用&lt;code&gt;1&lt;/code&gt;来表是一个段的开始，&lt;code&gt;0&lt;/code&gt;来表示处于一个段中。
一般来说，&lt;code&gt;flags&lt;/code&gt;的第一个元素为&lt;code&gt;1&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id="串行-1"&gt;串行
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;exclusive_seg_scan_seq&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;OP&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="并行-1"&gt;并行
&lt;/h3&gt;&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/cmu-2.PNG"
width="1421"
height="1067"
srcset="https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/cmu-2_hu_2dfb15ce20271c98.PNG 480w, https://woodman3.github.io/p/%E5%89%8D%E7%BC%80%E5%92%8C%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%AE%B5%E7%89%88%E6%9C%AC%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%96%B9%E6%B3%95/cmu-2_hu_675a52459a4fcac.PNG 1024w"
loading="lazy"
alt="cmu课件配图"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="319px"
&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OP&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;exclusive_seg_scan_par&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size_t&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;OP&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;fb&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;fb&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(;&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#pragma omp parallel for
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#pragma unroll
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-=&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;|=&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(;&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#pragma omp parallel for
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cp"&gt;#pragma unroll
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;-=&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;temp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fb&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="nf"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;temp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;op&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;offset&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="n"&gt;temp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;这个代码我虽然无法完全理解，但是他运行的结果和串行版本一致，&lt;a class="link" href="https://github.com/Woodman3/hpc_algorithm.git" target="_blank" rel="noopener"
&gt; 源码在此 &lt;/a&gt;，如果有纰漏的情况还请指出。&lt;/p&gt;
&lt;p&gt;在课程的ppt中，可能是默认初始值为0的缘故，反向的过程有些bug，毕竟在初始值为0的情况下，&lt;code&gt;+ 0&lt;/code&gt;和啥也不写没区别。&lt;/p&gt;
&lt;p&gt;前向过程很好理解，因为flags如果不为0,那么我们可以肯定这一次求和会涉及到其他段。&lt;/p&gt;
&lt;p&gt;在反向过程中，我们每次都操作都像是在修改一颗树上的两个节点，于是我们把&lt;code&gt;a[i]&lt;/code&gt;称为左节点，&lt;code&gt;a[i+offset]&lt;/code&gt;称之为右节点，以便理解。&lt;/p&gt;
&lt;p&gt;如果在一次求和中，如果左节点恰为他那个段的最后一位，那么他的值显然是不被右节点所需要的，且此时的右树不需要其他多余的值，那么我们直接给右节点赋予初始值即可。这就是第一个if的目的。&lt;/p&gt;
&lt;p&gt;如果左节点的flags为1,那么这意味着他在前向过程中已经积累了它所处的段到他这个节点的所有累加的值，这个值有可能被他后面的节点所用到，
而他后面的节点正好在右节点的子树中，我们需要把他的值与初始值相加以传递给左节点后面的节点。
而我们在第一个if中已经排除了他是本段最后一个节点的情况。&lt;/p&gt;
&lt;p&gt;如果左节点的flags为0,意味着左树只是他所在段的一部分，而在他的前面还有段的其他部分。
他的段的其他部分在上一次的后向过程中已经被存在了右节点中，故我们需要把他与右节点相加。&lt;/p&gt;
&lt;h2 id="参考"&gt;参考
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a class="link" href="https://www.cs.cmu.edu/afs/cs/academic/class/15418-s12/www/lectures/24_algorithms.pdf" target="_blank" rel="noopener"
&gt;cmu&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>记录下自己去过的博物馆</title><link>https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/</link><pubDate>Sat, 20 Jul 2024 23:18:15 +0800</pubDate><guid>https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/</guid><description>&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/120784400_p0.jpg" alt="Featured image of post 记录下自己去过的博物馆" /&gt;&lt;h2 id="引"&gt;引
&lt;/h2&gt;&lt;p&gt;今天去了回安徽博物馆，感触颇多，感觉多少得写点东西。&lt;/p&gt;
&lt;p&gt;在过去，我去博物馆的次数少之又少，第一是因为我读书生活时的城市几乎没啥博物馆，第二是我没怎么去外地旅游，去外地旅游时也没去博物馆的这个意识。但是我还是想回顾一下自己这么多年来所去的博物馆及其收获，以及这些博物馆的异同。&lt;/p&gt;
&lt;h2 id="未成年阶段"&gt;未成年阶段
&lt;/h2&gt;&lt;p&gt;我记忆中第一个去的博物馆应该是我小时去香港时旅游时所去的一个蜡像纪念馆？当然把一个十分钟就可以看完的纪念馆说成一个博物馆多少有些牵强。这个纪念馆是我去香港时在口岸中的一本香港旅游手册中看到的。但是等我兴冲冲的到达这个什么夫人的蜡像纪念馆后，才发现这个馆小的可怜，仅有的几个蜡像我也没多少印象了，那么在此略过罢了。&lt;/p&gt;
&lt;p&gt;如果纪念馆不算博物馆的话，那我去的第一个博物馆应该是深圳书城旁边的一个博物馆，但是我忘记我具体是啥时候去的了，只记得自己是一个人去的。我对这个博物馆唯一的印象就是里面没多少东西，大抵讲了一下深圳这个小城市的历史，尽管深圳没啥历史可言。里面我唯一记得的一件展品就是一个明代的火铳，在此之前我一直以为火枪完全是欧洲传来的。&lt;/p&gt;
&lt;p&gt;比起以上两个没啥东西的博物馆，倒是有另一个地方给了我不错的印象，那就是厦门的铁道文化公园。那是我去厦门玩时，走出了厦门大学却不知道去哪儿好时在地图上发现了这个地方然后顺便去的。里面有个隧道里有不少图框，在介绍铁道的同时还讲解的了厦门的历史。&lt;/p&gt;
&lt;h2 id="北京"&gt;北京
&lt;/h2&gt;&lt;p&gt;大一时去了北京玩，第一站自然是故宫&amp;hellip;旁边的中山公园。如果把故宫算作博物馆的话，那么故宫的展品就是故宫自己。故宫很大，我也走的很累。所幸的是，我去北京的时候正值21年初，也就是正好疫情。所以北京各大景点的人都少的可怜。所以体验非常好。故宫中的珍宝馆里我记得有个可以写字的机器小人，其他就一概忘得差不多了。但是严谨来说，故宫里正儿八百放在玻璃柜里的展品也没多少。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%95%85%E5%AE%AB.JPEG"
width="1920"
height="1080"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%95%85%E5%AE%AB_hu_77fac62c618f7fd5.JPEG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%95%85%E5%AE%AB_hu_ae64eac47a230328.JPEG 1024w"
loading="lazy"
alt="疑似故宫"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
&gt;&lt;/p&gt;
&lt;p&gt;上午去了故宫后，下午就去了故宫对面的国博了，国博里的东西确实多，严格来说国博是我第一个去的大型博物馆，而我也是刘姥姥进了大观园，涨了不少见识。第一次到大型博物馆的我此时还不知道博物馆原来还划分了不同的展区，不同展区的主题自然也不同。尽管是疫情期间，但是四羊方尊那儿还是围了不少人。四羊方尊所在的那个主题展厅介绍了中国的文化历史，从北京人到清朝。不少只能在历史课本上见到的东西在此处看到了实物，那是我在心里暗叹北京学生的幸福，不仅可以在周末来博物馆切实体验历史的厚度高考难度还低。这大抵就是国博给我的最深的感受吧。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%9B%BD%E5%8D%9A.JPEG"
width="1080"
height="1920"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%9B%BD%E5%8D%9A_hu_a62e04b5bdf052c7.JPEG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%9B%BD%E5%8D%9A_hu_9bf43f1713b038bd.JPEG 1024w"
loading="lazy"
alt="国博"
class="gallery-image"
data-flex-grow="56"
data-flex-basis="135px"
&gt;&lt;/p&gt;
&lt;p&gt;国博之后便是军博。坦白而言这个军博给我的印象远比国博深刻，因为我来之前以为军博可能就像红军宣传片？但是军博里面不仅介绍了从古至今的武器发展，还有大量的现代兵器，各种枪械囊括中外。地下甚至还有坦克大炮。我至今依旧记得脚下那架战斗机的残骸。我后来听到别人要去北京时都会告诉他：一定要去一趟军博！&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A1.JPEG"
width="1035"
height="1840"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A1_hu_e2713379dab3b089.JPEG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A1_hu_ecdaaefa822913b.JPEG 1024w"
loading="lazy"
alt="给康熙送的袖剑"
class="gallery-image"
data-flex-grow="56"
data-flex-basis="135px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A2.JPEG"
width="1644"
height="924"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A2_hu_6ead1bde1df9bd62.JPEG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A2_hu_b3ce5164e5e9e953.JPEG 1024w"
loading="lazy"
alt="刀"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="427px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A3.JPEG"
width="791"
height="1406"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A3_hu_679b9dbb567a0a22.JPEG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%86%9B%E5%8D%9A3_hu_a3609e348e8b34ec.JPEG 1024w"
loading="lazy"
alt="最喜欢的一集"
class="gallery-image"
data-flex-grow="56"
data-flex-basis="135px"
&gt;&lt;/p&gt;
&lt;p&gt;那段时候我还去了一个叫红砖美术馆的地方，里头有不少现代艺术作品，其中有一个房间中吊着不少东西，这是我唯一还记得的里头的艺术品。那应该是我去的第一个美术馆，但是里面的东西太少，又太现代，门票要一百多大洋，感觉有点亏。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%BA%A2%E7%A0%961.JPEG"
width="2048"
height="1536"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%BA%A2%E7%A0%961_hu_ba26041f51028ea1.JPEG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%BA%A2%E7%A0%961_hu_76d02df4b95eabf9.JPEG 1024w"
loading="lazy"
alt="红砖1"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%BA%A2%E7%A0%962.JPEG"
width="2048"
height="1536"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%BA%A2%E7%A0%962_hu_660b0f83788fb701.JPEG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%BA%A2%E7%A0%962_hu_ff75bf70cb298984.JPEG 1024w"
loading="lazy"
alt="红砖2"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;后来随着疫情越发越收紧，我再也没出去旅游。等到放开的时候，我又很不幸的要准备考研，在这个期间自然就没去其他博物馆了。考研结束后的那个寒假，mygo里的两个成员会出席北京的一个漫展，于是我又一次去了北京。这一次我去了北京的美术馆看了看，里头有雕塑展和画展。这是我第一次去正经的美术馆。也许感受到了一些美学的熏陶？&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8C%97%E7%BE%8E1.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8C%97%E7%BE%8E1_hu_429be3715b1eb3f6.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8C%97%E7%BE%8E1_hu_f966e799d7715f1a.JPG 1024w"
loading="lazy"
alt="挺喜欢的画"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8C%97%E7%BE%8E2.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8C%97%E7%BE%8E2_hu_9b9e7ef7306e6f38.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8C%97%E7%BE%8E2_hu_d3ab85b33af40440.JPG 1024w"
loading="lazy"
alt="外国雕塑"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;除了北京美术馆，我还去了一趟清华的艺术博物馆。馆内也多少介绍了一下清华的历史及其著名校友。有一个展子的展品是3d打印的艺术品，在观看的时候我一直在想这玩意是如果做到在打印的时候不塌的。还有个展子展出了一些特别的画，与其说是画不如更像是浮雕，作者使用大量的油墨在画布上营造出了一种立体的效果。四楼有个康有为的个人生平展（也有可能是梁启超，我老是把这两个弄混）在观展的时候我老是在想这个人后面是不是反对辛亥革命的墙头草，但展子也没提这一档子事。还有几个展子介绍了家具和印章文化。也是在这个时候我才知道制章者会在自己做的印章上留下些自己的痕迹来表明这个印章是自己刻的。最后还有一个小展子要额外的门票，我钱不多，就没去看，清华艺博对于清华的学生免费我多少可以理解，但是对于清华附中的学生也是免费的，让我感叹人世的参差（后来我朋友告诉我附中的人的饭卡甚至在清华内部刷）。看完展子我还去和我在网上认识的一个网友面基，这是我第一次和网友线下见面。进了清华艺博后可以直接去清华校园内部，不需要预约，算是清华大学的一个bug，关于清华大学还有一个神奇之处，清华食堂负一楼的一家披萨食堂使用手机点菜，但是点完之后只会有一个报错界面，朋友告诉我这就算成功了，着实草台。&lt;/p&gt;
&lt;h2 id="广州"&gt;广州
&lt;/h2&gt;&lt;p&gt;在回家的路上，我顺道去了下广州玩了下。目的地自然也就是各类博物馆和美术馆了。时间紧迫所以只去了南越王博物馆，这个博物馆有两个分馆，一个分馆在介绍墓穴的基础上还介绍了一下广东的历史，那时我也才知道以前广东可以算作南蛮之类，在古代的分量可能没那么重，但是广窑也有出厂自己的特色瓷器。另一个分馆不仅在展出墓穴发掘物的同时还展出了香港富商的捐赠的私人收藏漆器。汉代的漆器大多只有红黑二色，但是红黑二色确实好看。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8D%97%E8%B6%8A%E7%8E%8B.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8D%97%E8%B6%8A%E7%8E%8B_hu_6f696ea91493bafc.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8D%97%E8%B6%8A%E7%8E%8B_hu_488b8c24e31d32be.JPG 1024w"
loading="lazy"
alt="可爱的文字"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;回家后，大学同学要来广东看fgo的一个嘉年华，我就也去了一趟广州再玩几天。那是和同学一起去了十三行博物馆。那是我第一次与其他人结拜去博物馆，截止至目前也是唯一一次。博物馆展出了明朝后广东作为全国海关时的贸易状况，政策施行，以及一些当时的贸易品。展品不少都有西方风格，朋友赞叹不已，然而我只觉得朋友吵闹。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8D%81%E4%B8%89%E8%A1%8C.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8D%81%E4%B8%89%E8%A1%8C_hu_7af12e1539b364e6.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%8D%81%E4%B8%89%E8%A1%8C_hu_e9690ee584947e6c.JPG 1024w"
loading="lazy"
alt="十三行"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;后面又去了广东美术馆，那次展览里有闽南的竹楼建筑，也是我第一次在美术馆内看到建筑 ，里头的不少现代的展品我虽然多少看不懂，但是多少也能从中体会到作者对于当下时代的一些无声锐评。美术馆内的展品不一定对口味，但是能让人少一些对于现代的或后现代艺术的偏见。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%B9%BF%E7%BE%8E.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%B9%BF%E7%BE%8E_hu_40386a67375f1713.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%B9%BF%E7%BE%8E_hu_9bbda1f205fc0c2c.JPG 1024w"
loading="lazy"
alt="似乎是雕塑？"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;美术馆对面是广东华侨博物馆，里面的展品大多来自广东华侨的捐赠，介绍了老广人去东南亚和美国打工的历史，以及这些人在多年建国后或改革开放后依旧想着回国的故事。当时还有一个特别展览，介绍抗日战争时期美国飞虎队的故事。然而尽管介绍了老美的国际主义精神，但是并没有提及为啥国军的空军力量如此薄弱。&lt;/p&gt;
&lt;p&gt;最后一站中山纪念馆，里头介绍了孙中山一生的生平，也介绍了广东在近代时的革命历史。也就是在这我才知道原来孙中山曾经差点信了基督教。在此之前我一直听说孙文是国父，却不太清楚他具体干了啥。现在才知道他以前也是学医的，后来为革命筹钱而奔走四方，几次革命的失败与再次革命也是这个时候才了解。&lt;/p&gt;
&lt;p&gt;综合来说，广东的南越王博物馆补全了广东古代的历史，十三行博物馆和孙中山纪念馆补全的近代的历史，华侨博物馆也在一定程度上介绍了当代的历史，都是非常值得一去的博物馆。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%B2%A5.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%B2%A5_hu_251c2f75132b3d2d.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%B2%A5_hu_58d6d5fb14ab5b29.JPG 1024w"
loading="lazy"
alt="原本有粥联动，但是人太多，没去成"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;h2 id="武汉"&gt;武汉
&lt;/h2&gt;&lt;p&gt;后来考研复试失败，我原本的旅游计划全部都被替换成了求职找工作，毕业后没回家直接就去了公司入职。入职后的第二周，我去武汉听惘闻的演出。于是顺道也去了武汉的博物馆和美术馆。&lt;/p&gt;
&lt;p&gt;我到武汉博物馆时已经快四点了，而博物馆五点闭馆。这点时间看不了啥，于是我买了张编钟演出的票，不得不说除了最后的用编钟演奏命运交响曲有点不伦不类之外，其他曲目都非常不错。我也是此时才知道编钟的演出不是只有一个人在敲。底部有个最大的编钟自始至终也没有被敲响过，也不知如此之大的种对应的是哪个音。演出结束后已经是四点半，我去了二楼摆放越王勾践剑的地方看了看，那个展品被围得水漏不通，保安在现场怒吼要人们不要拍照，看完快走。我挤不进去，故没能一睹此剑的风采，非常遗憾。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%AD%A6%E5%8D%9A.JPEG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%AD%A6%E5%8D%9A_hu_e58165e4a5ffcb9d.JPEG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%AD%A6%E5%8D%9A_hu_56b949f60033e939.JPEG 1024w"
loading="lazy"
alt="幽默中西结合"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;第二天本想再去一次武汉博物馆，但是没有预约，周天当天预约是没有票的。所以只能去了武汉博物馆旁边的武汉美术馆。美术馆的一楼展示了漆画，漆画有点像漆器，大多数画都是使用大色块组合而成，说实话还挺好看。二楼展示的比较杂，没有明确的品类。四楼有个介绍武汉自辛亥革命后的美术发展了历史，非常有意思。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%AD%A6%E7%BE%8E.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%AD%A6%E7%BE%8E_hu_f0d57ed02dadbccf.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%AD%A6%E7%BE%8E_hu_844fc3d22a81a172.JPG 1024w"
loading="lazy"
alt="喜欢的画"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;去玩美术馆后还有一个中午的时间，我就顺道去了趟江汉关博物馆，江海关博物馆很像广东的十三行博物馆。武汉历史上也是中国被迫开放的口岸，但是无论进口还是出口都比不上另外三个大港口（沪津广），博物馆内展品虽没十三行华丽，但是装饰不错，对于革命历史的介绍也比十三行详细不少。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%B1%9F%E6%B1%89%E5%85%B3.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%B1%9F%E6%B1%89%E5%85%B3_hu_c27d9700e8e10705.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E6%B1%9F%E6%B1%89%E5%85%B3_hu_df08ac854850ee00.JPG 1024w"
loading="lazy"
alt="武汉高光时刻"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;第二次去武汉，我还是没能预约上武汉博物馆，于是我去了辛亥革命纪念馆，纪念馆分为南北两个馆，南馆主要还是展览1840到辛亥革命的始末，还提了一嘴自立军。自立军因为没钱而失败实在有些搞笑，但是我开始想：这么多起义和革命的钱都是哪儿来的？只是靠参加人员和其他人的自发捐款吗？为什么海外人士会捐助？在接受捐助的时候是否有其他交易（比如起事成功分些利益给他人）？为什么这么多革命的纪念馆只是对这段历史如流水账一样讲述却没有更深入的挖掘？革命的目的，是”共和“还是”驱除鞑虏“，为什么对于其中的民族主义思潮几乎没有讲述？这些疑问有些扰乱了我的心情，后面的展子就没怎么看了。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E8%87%AA%E7%AB%8B%E5%86%9B.jpg"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E8%87%AA%E7%AB%8B%E5%86%9B_hu_d589f5184eed508a.jpg 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E8%87%AA%E7%AB%8B%E5%86%9B_hu_da367ebd84b0a2b8.jpg 1024w"
loading="lazy"
alt="没钱而失败的起义"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%AD%B9%E9%92%B1.jpg"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%AD%B9%E9%92%B1_hu_891abc07bdd1165f.jpg 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E7%AD%B9%E9%92%B1_hu_ca6519fc400daac5.jpg 1024w"
loading="lazy"
alt="搞钱的方法"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;北馆离南馆只有一条马路的距离，里头主要是鄂军政府的旧址，我感觉和广东的中山纪念堂没啥区别，而且要钱并且我没时间，就没进去，外面看了下就走了。&lt;/p&gt;
&lt;h2 id="安徽"&gt;安徽
&lt;/h2&gt;&lt;p&gt;安徽博物馆也分旧馆和新馆。我第一次去博物院的时候，看到旧馆更近一些，就先去了旧馆。旧馆虽然外观看上去有些破旧，但是里面却意外的干净整洁。因为去的时候时间比较晚了，我也只参观了两个展区，一个是关于安微的红色革命历史，安徽作为红军早期的活动地带，而且也是淮海战役的主战场。关于这方面的资料远比以前所看的博物馆都要详实。在介绍战争的时候有一本日本人写的书，题目里有支那二字，但是大部分人似乎还不太了解这两个字是对于我国的蔑称。另一个展馆介绍了安徽的地理环境和中国古代和现代对抗黄河泛滥而做出的大量努力。这种改造山海的精神对我来说很是震撼。参观的时候我甚至在想这种大修水利和基建的举动能不能做到游戏里。&lt;/p&gt;
&lt;p&gt;一周过后我又去了新馆。进安徽博物馆需要排一个非常长的队，这是因为博物馆需要安检导致的，无可厚非。馆内的导引上说安徽的历史文化占了四个展厅，但是第四个展厅实际上展出的是一个星空主题展。三个展区分别介绍了原始社会、夏朝到汉朝，汉到明朝。可是并没有近代史，也许是因为这一部分在旧馆的缘故。安徽博物馆之行给我最大的感触莫过于，安徽在古代估摸也是个不错的地方，这片土地的历史和故事远远大于广东和北京，楚国的历史、徽商的富有、安徽祭祖文化，中都、文房四宝皆是安徽特产都使我对这片土地有了更加深刻的印象。同时馆内还有一个希腊文化展，但是这个展子也是需要额外买票，还需要排队一个小时，所以我就没去。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%BE%BD%E5%8D%9A.JPG"
width="4032"
height="3024"
srcset="https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%BE%BD%E5%8D%9A_hu_a49ff54a1373a951.JPG 480w, https://woodman3.github.io/p/%E8%AE%B0%E5%BD%95%E4%B8%8B%E8%87%AA%E5%B7%B1%E5%8E%BB%E8%BF%87%E7%9A%84%E5%8D%9A%E7%89%A9%E9%A6%86/%E5%BE%BD%E5%8D%9A_hu_23730d725d8c6b11.JPG 1024w"
loading="lazy"
alt="投降"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
&gt;&lt;/p&gt;
&lt;p&gt;我后来有去了一趟新馆，特意看了一下希腊的展子。不知道为什么，感觉里面的展品都特别新，但是说明并没有说是复制品，雕像并没有保护措施，很难想象这些雕像是几千年前的，同时期中国的文物都是破破烂烂的，这还是修复后的样子。&lt;/p&gt;
&lt;p&gt;安徽美术馆里展出的大部分都是些画作，我更喜欢现代的画作，有一种莫名的张力。&lt;/p&gt;
&lt;h2 id="杭州"&gt;杭州
&lt;/h2&gt;&lt;p&gt;中秋节的时候去了趟杭州，只去了杭州美术馆，里面有一些现代艺术展品，展出的形式非常新颖，比如游戏、影视和实物。还有齐白石的个人展。在看个人展的时候，我在思考：如果齐白石的家属找人画一幅画，声称这是齐白石生前画的，然后拍出齐白石作品的价格，会如何呢？这中行为甚至在齐白石自己也可以这么干。&lt;/p&gt;
&lt;h2 id="上海"&gt;上海
&lt;/h2&gt;&lt;p&gt;第一次去上海时，先是去了鲁迅纪念馆，很小的纪念馆，在鲁迅公园里面，介绍了鲁迅的事迹和生平，还展览了一些信件。但毕竟只是个个人纪念馆，体量有些小。&lt;/p&gt;
&lt;p&gt;上海美术宫是印在课本上的标志性建筑，肯定得去看看。展出的内容和传统的美术馆差不多，但是具体展出了啥我也忘记了。&lt;/p&gt;
&lt;p&gt;这天的最后一点时间去了上海当代艺术博物馆，这个馆看上去大，实际上展出的内容少的可怜，但是展出的东西都挺有意思，有稀奇古怪的小电影，有类似《泉》那样的实物展品。&lt;/p&gt;
&lt;p&gt;第二次来上海的时候，和朋友去了水族馆和世博会博物馆。水族馆非常漂亮，就是人有些多，在海底隧道那儿比较挤，有企鹅和海豹，可惜没有北极熊。世博会博物馆这种主题展览我非常喜欢，不仅中西结合，还把历史上的重要发明也顺带讲了一些。&lt;/p&gt;
&lt;p&gt;第三次来上海时去了上海博物馆东馆和船舶博物馆，东馆这种不需要预约的机制很好，但是里面展出的还是太泛泛了，里面有一个货币的展览很不错，但是其实伴随着货币的历朝历代的一些经济改革也可以顺便提及一下，比如在介绍交子的时候可以插入的介绍王安石变法在经济上的措施，但是没有。十分可惜。&lt;/p&gt;
&lt;p&gt;船舶博物馆在一个非常偏远的地方——临港新城，去这地方最快的办法就是坐大班车——一种一小时一班的地铁。为了赶最近的大班车我和朋友不得不提前结束在东馆的游览，撒开脚丫子跑向地铁站，最后勉强赶上了。然后在大班车上又站了快一个小时。我对船舶博物馆的期望是像北京的兵器博物馆一样，但是实际上船舶博物馆对战舰的着墨并不多。更多的是中国造船的历史、航运的一些科普、以及在角落的几个战舰模型，甚至不是最新的模型，对此我比较失望。&lt;/p&gt;
&lt;h2 id="南京"&gt;南京
&lt;/h2&gt;&lt;h2 id="结语"&gt;结语
&lt;/h2&gt;&lt;p&gt;至此为止，我也算是一个小小的博物馆爱好者了，可以说我去一个城市都会优先去他的博物馆。逛了这么多博物馆，有时候我会发现一些博物馆会把自己的展品送去其他地方参展，甚至北京的美术馆内就会借其他省份博物馆的展品，但是北京博物馆自己的展品却少有外出的时候，令我再次感慨世界的参差。&lt;/p&gt;</description></item><item><title>gcc中-l选项的位置问题</title><link>https://woodman3.github.io/p/gcc%E4%B8%AD-l%E9%80%89%E9%A1%B9%E7%9A%84%E4%BD%8D%E7%BD%AE%E9%97%AE%E9%A2%98/</link><pubDate>Wed, 17 Jul 2024 13:32:09 +0800</pubDate><guid>https://woodman3.github.io/p/gcc%E4%B8%AD-l%E9%80%89%E9%A1%B9%E7%9A%84%E4%BD%8D%E7%BD%AE%E9%97%AE%E9%A2%98/</guid><description>&lt;img src="https://woodman3.github.io/p/gcc%E4%B8%AD-l%E9%80%89%E9%A1%B9%E7%9A%84%E4%BD%8D%E7%BD%AE%E9%97%AE%E9%A2%98/99947891_p0.jpg" alt="Featured image of post gcc中-l选项的位置问题" /&gt;&lt;p&gt;使用fftw库时发现连接器死活找不到符号。增加了-L并检查了LIBRARY_PATH都包含了对应库的路径。&lt;/p&gt;
&lt;h2 id="解决方法"&gt;解决方法
&lt;/h2&gt;&lt;p&gt;把 -lfftw3 放在输出文件后面即可。官网的FAQ里甚至也提到了这个错误的解决方法&amp;hellip;&lt;/p&gt;
&lt;h2 id="原理"&gt;原理
&lt;/h2&gt;&lt;p&gt;以下是来自gcc手册对此的解释：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;It makes a difference where in the command you write this option; the linker searches and processes libraries and object
files in the order they are specified. Thus, foo.o -lz bar.o searches library z after file foo.o but before bar.o
If bar.o refers to functions in z, those functions may not be loaded.&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>Glassman快速傅里叶变换</title><link>https://woodman3.github.io/p/glassman%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/</link><pubDate>Fri, 12 Jul 2024 20:45:43 +0800</pubDate><guid>https://woodman3.github.io/p/glassman%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/</guid><description>&lt;img src="https://woodman3.github.io/p/glassman%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/121575678_p0.png" alt="Featured image of post Glassman快速傅里叶变换" /&gt;&lt;h2 id="文前"&gt;文前
&lt;/h2&gt;&lt;p&gt;在优化某个粒子计算的程序时，发现分配2核所耗的时间比1核、4核、8核都久，十分疑惑，经过查找后发现是由于一处傅里叶变换的耗时过大导致，在研究这个傅里叶变换时就顺便把其中的要点记下来。&lt;/p&gt;
&lt;h2 id="符号约定"&gt;符号约定
&lt;/h2&gt;&lt;p&gt;为方便起见，本文中所有矩阵的元素的下标从0开始&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;本文中所有$w$的上标皆为幂，请不要与行号列号搞混&lt;/strong&gt;&lt;/p&gt;
$$
n,m:行、列下标，范围若无特殊说明皆为0到N-1\\
n_A,m_A,同为下标但是范围为0到A-1\\
i=\sqrt{-1}\\
w_N=e^{-2{\pi}i/N}\\
W_N:傅里叶变换矩阵，大小为N*N\\
W_N中位置为(n,m)元素的值为w_N^{nm}\\
$$&lt;h2 id="前置知识"&gt;前置知识
&lt;/h2&gt;&lt;h3 id="离散傅里叶变换的矩阵形式"&gt;离散傅里叶变换的矩阵形式
&lt;/h3&gt;&lt;p&gt;对于离散傅里叶变换，其变换可以写为矩阵形式：&lt;/p&gt;
$$
v=W_Nu
$$&lt;h3 id="张量积"&gt;张量积
&lt;/h3&gt;&lt;p&gt;也称克罗内克积，记为$\otimes$ ，我们对于张量积的定义为：&lt;/p&gt;
$$
A\otimes B=\begin{bmatrix}
a_{11}B&amp;\cdots&amp;a_{1n}B\\
\vdots&amp;\ddots&amp;\vdots\\
a_{m1}B&amp;\cdots&amp;a_{mn}B
\end{bmatrix}
$$&lt;p&gt;值得注意的是，如果你去查阅[2]这篇论文的话，你会发现他对于张量积的定义与我们上述的定义相反，我在此采取上述定义，因为维基百科也是这么定义的。&lt;/p&gt;
&lt;p&gt;除此之外，还有一些性质是我们在后文中会用到的，在此列出。&lt;/p&gt;
&lt;h4 id="结合性"&gt;结合性
&lt;/h4&gt;$$
(A \otimes B) \otimes C = A \otimes (B \otimes C)
$$&lt;h4 id="混合乘积性质"&gt;混合乘积性质
&lt;/h4&gt;&lt;p&gt;如果$A$、$B$、$C$和$D$是四个矩阵，且矩阵乘积$AC$和$BD$存在，那么：&lt;/p&gt;
$$
(A \otimes B)(C \otimes D)=AC\otimes BD
$$&lt;h4 id="疑似分配律"&gt;疑似分配律
&lt;/h4&gt;&lt;p&gt;&lt;del&gt;这个是我自己推出来的，维基上没写，我也不确定是否严谨，但是这个规律对后面的推导用处不小，故列出，若$A$ 和$B \otimes C$ 为大小相等的方阵，那么&lt;/del&gt;
这就是前面混合积性质的拓展，感谢@DavidWang19指出&lt;/p&gt;
$$
(AB)\otimes C^2 = (A\otimes C)(B \otimes C)
$$&lt;h4 id="与向量乘法"&gt;与向量乘法
&lt;/h4&gt;&lt;p&gt;$vec(V)$表示把矩阵v按列堆叠为一个列向量。
&lt;/p&gt;
$$
(A\otimes B)vec(V) = vec(BVA^T)
$$&lt;h2 id="矩阵的分解"&gt;矩阵的分解
&lt;/h2&gt;&lt;p&gt;我们先假设&lt;/p&gt;
$$
N=AB
$$&lt;p&gt;那么变换的矩阵的每一个元素可以分解为&lt;/p&gt;
$$
\begin{aligned}
w_N^{nm} &amp;= w_N^{n(m_A+Am_B)}\\
&amp;=w_N^{nm_A}w_{AB}^{Anm_B}\\
&amp;=w_N^{nm_A}w_B^{nm_B}
\end{aligned}
$$&lt;p&gt;令:&lt;/p&gt;
$$
\gamma_{N,A}^n:=\{w_N^{n*0},w_N^{n*1}...w_N^{n*(A-1)}\}\\
$$&lt;p&gt;后文简写为$\gamma^n$ ，我们可以把$W$ 矩阵中的第$n$ 行写为&lt;/p&gt;
$$
\{\gamma^nw^{n*0}_B,\gamma^nw^{n*1}_B...\gamma^nw^{nm_B}_B\}
$$&lt;p&gt;我们可以把$W$ 矩阵的前$B$行进一步分解：&lt;/p&gt;
$$
W_{0:B-1,:}=
\begin{bmatrix}
\gamma^0&amp;0&amp;...&amp;0\\
0&amp;\gamma^1&amp;...&amp;0\\
\vdots&amp;\vdots&amp;\ddots&amp;0\\
0&amp;0&amp;\cdots&amp;\gamma^{(B-1)}
\end{bmatrix}\begin{bmatrix}
I_A&amp;I_A&amp;...&amp;I_A\\
I_A&amp;w^{1}_BI_A&amp;...&amp;w_B^{1*(B-1)}I_A\\
\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\
I_A&amp;w_B^{(B-1)*1}I_A&amp; ... &amp;w_B^{(B-1)*(B-1)}I_A
\end{bmatrix}
$$&lt;p&gt;我们发现了一些有趣的规律，于是进一步分解整个矩阵为&lt;/p&gt;
$$
W=
\begin{bmatrix}
\gamma^0&amp;0&amp;...&amp;0\\
0&amp;\gamma^1&amp;...&amp;0\\
\vdots&amp;\vdots&amp;\ddots&amp;0\\
0&amp;0&amp;\cdots&amp;\gamma^{B-1}\\
\gamma^B&amp;0&amp;...&amp;0\\
0&amp;\gamma^{B+1}&amp;...&amp;0\\
\vdots&amp;\vdots&amp;\ddots&amp;0\\
0&amp;0&amp;\cdots&amp;\gamma^{AB-1}\\
\end{bmatrix}\begin{bmatrix}
I_A&amp;I_A&amp;...&amp;I_A\\
I_A&amp;w^{1}_BI_A&amp;...&amp;w_B^{1*(B-1)}I_A\\
\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\
I_A&amp;w_B^{(B-1)*1}I_A&amp;...&amp;w_B^{(B-1)*(B-1)} I_A
\end{bmatrix}
$$&lt;p&gt;我们记左边的矩阵为 $F^{A,B}$ ，表示每个 $\gamma$ 有$A$ 个元素，每一行有$B$个$\gamma$那么原式化简可得&lt;/p&gt;
$$
W_N = F^{A/B} (W_B \otimes I_A)
$$&lt;p&gt;我们成功提出了一个更小的矩阵，现在我们拓展一下$N=N_1N_2...N_k$ ，这么递归下去，可以得到&lt;/p&gt;
$$
\begin{aligned}
W_N &amp;= F^{N_1,N/N_1} (W_{N_2...N_k} \otimes I_{N_1})\\
&amp;= F^{N_1,N/N_1} ((F_{N_2,N_3...N_k}(W_{N_3...N_k} \otimes I_{N_2}))\otimes I_{N_1})\\
&amp;=F^{N_1,N/N_1}((F^{N_2,N_3...N_k} \otimes I_{N_1})(W_{N_3...N_k}\otimes I_{N_2}\otimes I_{N_1}))\\
&amp;=F^{N_1,N/N_1}(F^{N_2,N_3...N_k} \otimes I_{N_1})(F^{N_3,N_4...N_k}\otimes I_{N_1}\otimes I_{N_2})...(F^{N_{k-1},N_k} \otimes I_{N_1} \otimes ... \otimes I_{N_{k-2}})(W_{N_k} \otimes ...)
\end{aligned}
$$&lt;p&gt;又因为&lt;/p&gt;
$$
I_{N_1} \otimes I_{N_2} = I_{N_1N_2}
$$&lt;p&gt;于是各种符号可以简化以下，比如令
&lt;/p&gt;
$$
\begin{aligned}
F_t = F^{N_t,N_{t+1}...} \otimes I_{N_1} \otimes ... \otimes I_{N_{t-1}}
&amp;=F^{N_t,N_{t+1}...} \otimes I_{N_1N_2...N_{t-1}}
\end{aligned}
$$&lt;p&gt;
便有了&lt;/p&gt;
$$
W_N = F_1F_2...F_k
$$&lt;p&gt;至此，这就是glassman的基本思想：把一个大矩阵分解成一堆简单的矩阵，下面介绍具体算法如何实现。&lt;/p&gt;
&lt;h2 id="实现"&gt;实现
&lt;/h2&gt;&lt;p&gt;让我们再次回到起点，我们的目标是计算这么一个简单的式子：&lt;/p&gt;
$$
v=W_Nu
$$&lt;p&gt;经过分解，可以化简为&lt;/p&gt;
$$
v=F_1F_2...F_ku
$$&lt;p&gt;矩阵乘法符合结合律，所以我们从右往左计算，我们发现每一步都可以作一定程度上的化简，比如把$v$分块重组为一个矩阵$V$：&lt;/p&gt;
$$
\begin{aligned}
F_t v =F^{N_t,N_{}...N_k} \otimes I_{N_1N_2...N_{t-1}} v\\
&amp;=vec(I_{N_1N_2...N_{t-1}} V F^{N_t,N_{}...N_k}) \\
&amp;=vec(V(F^{N_t,N_{}...N_k})^T))
\end{aligned}
$$&lt;p&gt;然后递归求和即可。&lt;/p&gt;
&lt;h2 id="代码"&gt;代码
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;complex&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;complex&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;worker&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;complex&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;*=&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;/=&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;complex&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cos&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;M_PI&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="n"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;M_PI&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;complex&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cstep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;ic&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;ic&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;ic&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;vr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;vr&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;vr&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;complex&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;complex&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;gamma&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;vr&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;gamma&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;gamma&lt;/span&gt;&lt;span class="o"&gt;*=&lt;/span&gt;&lt;span class="n"&gt;cstep&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;ic&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;vr&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;cstep&lt;/span&gt;&lt;span class="o"&gt;*=&lt;/span&gt;&lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="复杂度"&gt;复杂度
&lt;/h2&gt;&lt;p&gt;算法的循环次数为$O(n(N_1+N_2+...+N_k))$在最坏的情况下，比如这个数是质数，他的复杂度高达$O(n^2)$，事实上，把项目中里的glassman算法替换为fftw的库的话，可以提高不少的速度。&lt;/p&gt;
&lt;h2 id="引用"&gt;引用
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;[1] J. A. Glassman, &amp;ldquo;A Generalization of the Fast Fourier Transform,&amp;rdquo; in IEEE Transactions on Computers, vol. C-19, no. 2, pp. 105-116, Feb. 1970, doi: 10.1109/T-C.1970.222875.
keywords: {Cooley-Tukey algorithm, discrete Fourier transform, fast Fourier transform, mixed radix, spectral analysis.},&lt;/li&gt;
&lt;li&gt;[2][impl] Warren E. Ferguson,
A simple derivation of Glassman&amp;rsquo;s general N fast fourier transform,
Computers &amp;amp; Mathematics with Applications,
Volume 8, Issue 6,
1982,
Pages 401-411,
ISSN 0898-1221,
&lt;a class="link" href="https://doi.org/10.1016/0898-1221%2882%2990016-5" target="_blank" rel="noopener"
&gt;https://doi.org/10.1016/0898-1221(82)90016-5&lt;/a&gt;.
(&lt;a class="link" href="https://www.sciencedirect.com/science/article/pii/0898122182900165" target="_blank" rel="noopener"
&gt;https://www.sciencedirect.com/science/article/pii/0898122182900165&lt;/a&gt;)
Abstract: A simple derivation of Glassman&amp;rsquo;s general N fast Fourier transform, and corresponding FORTRAN program, is presented. This fast Fourier transform is based upon a representation of the discrete Fourier transform matrix as a product of sparse matrices.&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>pgc++编译时指定c++版本则无法编译</title><link>https://woodman3.github.io/p/pgc-%E7%BC%96%E8%AF%91%E6%97%B6%E6%8C%87%E5%AE%9Ac-%E7%89%88%E6%9C%AC%E5%88%99%E6%97%A0%E6%B3%95%E7%BC%96%E8%AF%91/</link><pubDate>Mon, 08 Jul 2024 17:48:02 +0800</pubDate><guid>https://woodman3.github.io/p/pgc-%E7%BC%96%E8%AF%91%E6%97%B6%E6%8C%87%E5%AE%9Ac-%E7%89%88%E6%9C%AC%E5%88%99%E6%97%A0%E6%B3%95%E7%BC%96%E8%AF%91/</guid><description>&lt;img src="https://woodman3.github.io/p/pgc-%E7%BC%96%E8%AF%91%E6%97%B6%E6%8C%87%E5%AE%9Ac-%E7%89%88%E6%9C%AC%E5%88%99%E6%97%A0%E6%B3%95%E7%BC%96%E8%AF%91/120269913_p0.png" alt="Featured image of post pgc++编译时指定c++版本则无法编译" /&gt;&lt;h2 id="背景"&gt;背景
&lt;/h2&gt;&lt;p&gt;由于需要在曙光的超算上用openacc写程序，但是我所在的分区只有pgi编译器。在使用pgc++或者nvc++时，一旦指定的c++版本大于11，编译器就会出现以下错误。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;/opt/rh/devtoolset-7/root/usr/include/c++/7/type_traits&amp;#34;&lt;/span&gt;, line 347: error:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; class &lt;span class="s2"&gt;&amp;#34;std::__is_floating_point_helper&amp;lt;long double&amp;gt;&amp;#34;&lt;/span&gt; has already been
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; defined
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; struct __is_floating_point_helper&amp;lt;__float128&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; ^
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;/opt/rh/devtoolset-7/root/usr/include/c++/7/bits/std_abs.h&amp;#34;&lt;/span&gt;, line 102: error:
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;std::abs(long double)&amp;#34;&lt;/span&gt; has already been defined
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; abs&lt;span class="o"&gt;(&lt;/span&gt;__float128 __x&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; ^
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="m"&gt;2&lt;/span&gt; errors detected in the compilation of &lt;span class="s2"&gt;&amp;#34;main.cpp&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="解决"&gt;解决
&lt;/h2&gt;&lt;p&gt;这个错误的原因是因为曙光超算在登陆时会自动加载一些模块，使用&lt;code&gt;module list&lt;/code&gt;查看已加载的模块，发现除了我自己手动加载的pgi模块，还有mpi和一个基础的编译器模块，把这两个模块卸除，只留下pgi模块，即可正常编译。&lt;/p&gt;</description></item><item><title>将我与宫崎老贼的爱恨情仇，弃置于此</title><link>https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/</link><pubDate>Sat, 06 Jul 2024 16:30:11 +0800</pubDate><guid>https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/</guid><description>&lt;img src="https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/120060943_p0.png" alt="Featured image of post 将我与宫崎老贼的爱恨情仇，弃置于此" /&gt;&lt;p&gt;今天的凌晨零点半，我打通了老头环的dlc。回望自己与魂类游戏的种种过往，总得有个总结。米凯拉丢个身体还得写个小作文，那么我这么多年的魂游经历，写篇博客也是顺理成章的吧。&lt;/p&gt;
&lt;h2 id="起始魂3"&gt;起始——魂3
&lt;/h2&gt;&lt;p&gt;从成就的获取时间来看，我是在2017年的圣诞节前几天开始玩的魂3，刚上高中的我即将完成高中第一个学期的学业，在圣诞节促销的期间买下了这款久闻盛名的游戏。&lt;/p&gt;
&lt;p&gt;我的起始职业选的法师，因为我想当法爷。尽管在开玩前就知道了黑魂难，但是当我死在墓地旁边的宝石结晶虫手下时，我发现我还是低估了这个游戏的难度。我不服气，于是用法师开局自带的那把短剑和结晶虫打了四个小时。四个小时后，我终于干死了这头畜生，而此时，我还没打古达，所以以至于我打古达的时候，觉得这boss还挺简单。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/ds3.jpg"
width="1920"
height="1080"
srcset="https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/ds3_hu_60cc023f5269ae44.jpg 480w, https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/ds3_hu_a97bab5f4ec98feb.jpg 1024w"
loading="lazy"
alt="终于打死了宝石结晶虫"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
&gt;&lt;/p&gt;
&lt;p&gt;在一开始的时候，我会对照着黑魂wiki给的地图和黑桐谷歌的攻略一点一点的舔图。尽管我作为一个法师，我却依旧怀着一颗近战的心，在前期，我的武器从一开始给的短剑，过渡到了后面的结晶老者的刺剑，中期的武器就是朴素的直剑加上魔力附魔。拿到隐身后，宫崎老贼的很多阴谋就变成了笑话。打boss就是躲在远处biubiubiu就好了，这个打法一直持续到了我遇到了不死队。&lt;/p&gt;
&lt;p&gt;不死队人多， 而且一个滑铲可以干的我妈都不认识，在网上大伙都说不死队最好的打法是背刺，但是我发现怎么都背刺不了（后来我才知道原来背刺的时候要推摇杆往前，只按攻击是不会背刺的）。于是我用盾反打背刺，甚至去找黑骑士练了好久的基本功。到后面看到不死队队长在我面前倒下时，我忽然意识到自己确实是变强了。&lt;/p&gt;
&lt;p&gt;当然后面并非没有逃课，打沙立万时我企图盾反，死麻了之后招了个npc，在远处biubiubiu，很轻松就过了。但是逃得课总得补回来，当我再一次遇到古达时，我便被狠狠的补了一课。古达的出招一板一眼，几乎都能盾反（除了体术）。在用小皮盾最后一次弹开古达的大矛时，在最后一次把手中的利刃从古达的身体里拔出时，我注视着这个倒在地上的英雄似乎依旧挣扎着想要起来，但是他却倒了下去，化为了一团白烟，也作为魂，化作了我的力量。不仅仅是游戏数据上的，我切实的感觉自己的技术似乎有那么一点长进。&lt;/p&gt;
&lt;p&gt;古达后面的很多boss我都没遇到什么麻烦。直到dlc的隐藏boss，黑龙。我作为一个近战法师，遇到的最大问题居然是输出不够。我当时有两个打法，第一是灵魂矛不断biubiubiu，但是需要把黑龙打死需要不少次法术，这意味着我需要留大量的蓝瓶，而且必须要把灵魂矛打在黑龙的头上，就游玩体验上，和近战差不多。第二种打法是用月光大剑打头，如果想要贪输出的话，也要用战技，这意味着依旧需要预留一些蓝瓶。瓶子给了蓝瓶，那么红瓶也就变少了，容错率自然也就变低了。极低的容错率，使我在这个boss上耗了太多太多时间。也就是在这一刻，一款boss能否过，似乎变成了一个运气的游戏。&lt;/p&gt;
&lt;p&gt;后面我逛贴吧，发现黑龙可以用水银蒸气。于是原来我打黑龙要带的七个蓝瓶一下就缩减成了三个，而且不需要冒险去特意攻击，用这种方法，我仅用了三次就击败了鏖战了十个小时的黑龙。&lt;/p&gt;
&lt;p&gt;现在回想那段时光，我很庆幸自己在正确的时间玩到了这么一款游戏，那时的我有时间，有耐心，很乐意在一个boss上不断的尝试大量的时间，而且boss也都很板正，大多了也就自然过了（除了那头黑龙）。打过了黑魂后，我觉得世界上没啥游戏可以难到我（后来发现我错了），我认为自己只有不断的尝试，不断的背板，可以打通大部分所谓的高难游戏。&lt;/p&gt;
&lt;h2 id="只狼"&gt;只狼
&lt;/h2&gt;&lt;p&gt;时间来到了两年后，只狼发售了。在这款游戏公布之初，酷爱盾反的我就对这种专注于弹反的玩法表现出了十足的兴趣。于是在即将升入高三的那个盛夏。我决定把只狼作为我在高三阶段的最后一次放纵。我预购了只狼。那时我周五回家后，便打开电脑开始玩只狼，一直玩到周天去上学的那个晚上。&lt;/p&gt;
&lt;p&gt;只狼都游玩过程中没遇到什么卡太久的boss，过了蝴蝶夫人和赤鬼后几乎就是一路平川了。哪怕是打玄一郎也没遇到太大困难。唯一的例外就是那个无头精英怪。诡异的慢刀和舍不得用道具让我放弃了这个精英怪。我先走的修罗线，于是在老年一心那里卡了很久。但是打过了之后，发现也就那样。后面打年轻一心时，也就打了几次就过了。&lt;/p&gt;
&lt;p&gt;由于只狼的打法单一，一般来说在b站上看过别人怎么打之后，自己打就大概有个思路了，后面就是不断的背板并增加熟练度，慢慢自然也就过了。那时候随着越来越多的人通关，只狼相关的视频也从boss打法视频变成了打了各种奇怪mod的狼花式吊打一心。&lt;/p&gt;
&lt;p&gt;后来只狼更新了他的连战模式，并且增加了一个新的技能。上了大学的我兴致勃勃的把这个游戏又下了回来，但是发现自己在新模式中连鬼刑部都打不过，后面便卸载了。&lt;/p&gt;
&lt;h2 id="血源"&gt;血源
&lt;/h2&gt;&lt;p&gt;上了大学后，我发现社团的值班室里有一台ps4，而且上面装了血源。为了玩这个游戏，我每周值班那天都会从学校的西区跑到东区。那段日子的雪很大，但是浇不灭我对于游戏的热情。后面我学长把他的ps4借给了我，我也得以在寒假打通这个直到今天依旧ps独占的游戏。&lt;/p&gt;
&lt;p&gt;血源给我留下最深印象的，居然是他的掉帧问题。我依旧记得在某些场景打个内脏暴击会把帧数从30帧打到15帧。血瓶和子弹的设计也使我不得不小心翼翼探图。虚血的设计是的我拿着我的锯肉刀砍翻了整个亚楠。甚至在打学姐都没失败几次，硬是蛮过了除了孤儿之外的所有boss。&lt;/p&gt;
&lt;p&gt;地牢由于没什么吸引我的，而且我时间急迫（比较ps4还得还回去），所以我没去打地牢。&lt;/p&gt;
&lt;p&gt;写到这里的时候，我发现我玩过的所有魂系dlc，里头的难度都十分变态，dlc的最终boss可以说是比本体阴间了不少。可是说这个也算是魂游的老毛病了。&lt;/p&gt;
&lt;h2 id="老头环"&gt;老头环
&lt;/h2&gt;&lt;p&gt;在老头环发布之初，我便对这个游戏充满了期待，由于担心自己的电脑带不动，我还在换了一台笔记本电脑。在23年，恰好学校由于疫情不让我返校，这便给我玩老头环创造了绝佳的环境。于是，在老头环开启的那个晚上，我打开了steam，满怀期待的等待这那个启动游戏变为可以启动。&lt;/p&gt;
&lt;p&gt;老头环比起血源和只狼，更加像是一款正统的魂系游戏，主角可以跳、可以蹲，可以在防御后反击，可以直接削韧，甚至可以骑马在交界地漫游。这些对于角色机能的加强给了我很大的惊喜。和魂3时一样，我在出生的墓地耗费了不少时间，但是在面对打一下只掉一点血的树灵时，我选择了暂时的离开。在一开始我并没有走大路，因此没遇上大树守卫。由于一开始往上走，我打到噩兆妖怪时手里依旧只有着一个+0的木棒，连件衣服都没有。被妖鬼的大棒打死几次后，我意识到了这个游戏和以往的魂系不一样，他是一个开放世界。&lt;/p&gt;
&lt;p&gt;于是，我改道往下走，因为看到论坛上说下面那个岛上有个小圆盾。我拿到了第一把特大剑。把手中的武器强化后，我再次回到了那座城。我惊讶的发现弹反一次居然无法处决，打出来的硬直甚至不够我的特大剑挥一下。更让我惊讶的是几下跳劈也可以出处决，不等的风险居然可以获得相同的收益，自那时起，我便再也没怎么用过盾反了（除了打神皮使者）。&lt;/p&gt;
&lt;p&gt;在推进地图后，我又在论坛上听说了一个强大的战技——猎奇步伐。于是乎，我拿着一把装着猎奇步伐的厚重巨剑，打穿了整个游戏。在这一百多个小时中，除了打女武神我最终恼羞成怒的换上重甲之外，全程都是一身清凉的嘎子剑战士。&lt;/p&gt;
&lt;p&gt;老头环的dlc出时，我已经开始了工作，没有大量的时间花费在游戏上。我看着被削过后的猎犬步伐，如同一位老伙计一样，再一次踏上了幽影之地的旅程。&lt;/p&gt;
&lt;p&gt;尽管人还在上班，但是断断续续还是花了40个小时打完了dlc。我看着老头环140小时的游戏时间，陷入了沉思。在面对最终boss的时候，我把手中血血怪手臂的战技又换回了猎犬步伐，再一次穿上了打女武神时的那套重甲。在经历了几次尝试后，终于还是打过了。可是为何我的内心却再也没有了战胜对手的喜悦之情呢？我知道手中的武器被戏称为轮椅。我知道我在游玩过程中面对的挫败屈指可数。我知道我在死亡后之后在这一小块的空隙里打打手游。&lt;/p&gt;
&lt;p&gt;是的，我再也回不到2017年的那个冬天了，我无法拿出四个小时不停的挑战同一个boss。我不知到是不是电脑显卡老化的缘故，在游玩dlc的时候只有打开游戏的半小时时不怎么掉帧。一旦游玩时间增加，这个游戏的掉帧就会越来越严重，将军从空中飞下辟出的五连斩好像劈在了我的显卡上，我根本无法看清他的动作，跟不可能闪避。但是我依旧打败了他，以我的繁文缛节作为代价。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/elden_ring.jpg"
width="2560"
height="1600"
srcset="https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/elden_ring_hu_e93def979ef09083.jpg 480w, https://woodman3.github.io/p/%E5%B0%86%E6%88%91%E4%B8%8E%E5%AE%AB%E5%B4%8E%E8%80%81%E8%B4%BC%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87%E5%BC%83%E7%BD%AE%E4%BA%8E%E6%AD%A4/elden_ring_hu_4e862a3ccd992c5a.jpg 1024w"
loading="lazy"
alt="和将军"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="384px"
&gt;&lt;/p&gt;
&lt;p&gt;我还能享受一场酣畅淋漓的战斗吗？我那被生活压弯的脊梁哪怕在我现在的桌前都无法挺直，又有何颜面去面对将军呢？将军的那两把刀是那么的快，b战上的人说想靠闪避将军的那两刀只有80ms的反应时间。我躲不过第二刀，我也无法逃离那个一事无成的自己。七年前的我认为世上没有可以难到我的游戏，七年后的我只能在桌前抱怨自己的周末有这么毫无意义的过去了。&lt;/p&gt;
&lt;p&gt;魂游变了，他不再是那个小众游戏， 我也变了，我不再是那个在天上自由飘来飘去的云了。游戏的社区不再是对于剧情和好哥哥的讨论而是哪把轮椅强。我也如同一只被阉割了的猪一般，只能在桌前写着属于自己的小作文。&lt;/p&gt;</description></item><item><title>MPI的RMA机制笔记</title><link>https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/</link><pubDate>Wed, 26 Jun 2024 13:59:16 +0800</pubDate><guid>https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/</guid><description>&lt;img src="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/119833826_p0.jpg" alt="Featured image of post MPI的RMA机制笔记" /&gt;&lt;h2 id="介绍"&gt;介绍
&lt;/h2&gt;&lt;p&gt;Remote Memory Accese（RMA）是MPI中的一种单边通信机制。具体来说，类似于cuda的统一内存，MPI划出了一块内存空间，称之为窗口（window），所有的进程都可以访问或修改这一块内存并且不需要显示的同步操作。&lt;/p&gt;
&lt;p&gt;在下文中，我将遵循MPI标准中的定义，以源（origin）或源进程来指代调用RMA操作的进程，以目标（target）或目标进程来指代被访问内存的进程。&lt;/p&gt;
&lt;h2 id="初始化"&gt;初始化
&lt;/h2&gt;&lt;p&gt;MPI提供了四种初始化函数，如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;MPI_WIN_CREATE&lt;/strong&gt; 每个调用此函数的进程都会暴露一块已经被本地分配的内存。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MPI_WIN_ALLOCATE&lt;/strong&gt; 与上一个的不同在于，用户不需要提前分配好内存。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MPI_WIN_ALLOCATE_SHARED&lt;/strong&gt; 在上一个的基础上，其他进程可以直接读写window。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MPI_WIN_CREATE_DYNAMIC&lt;/strong&gt; 创建出的内存大小是动态的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="mpi_win_create"&gt;MPI_WIN_CREATE
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;MPI_WIN_CREATE(base, size, disp_unit, info, comm, win)&lt;/p&gt;
&lt;p&gt;IN base initial address of window (choice)&lt;/p&gt;
&lt;p&gt;IN size
size of window in bytes (non-negative integer)&lt;/p&gt;
&lt;p&gt;IN
disp_unit
local unit size for displacements, in bytes (positive
integer)&lt;/p&gt;
&lt;p&gt;IN
info
info argument (handle)&lt;/p&gt;
&lt;p&gt;IN
comm
intra-communicator (handle)&lt;/p&gt;
&lt;p&gt;OUT
win
window object (handle)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;其中，若&lt;code&gt;size&lt;/code&gt;指定为&lt;code&gt;0&lt;/code&gt;，则不会暴露内存。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;disp_unit&lt;/code&gt; 为缩放系数，一般而言指定为&lt;code&gt;0&lt;/code&gt;（不缩放）或&lt;code&gt;sizeof(type)&lt;/code&gt;。（标准中说在异构环境下也可正确的缩放）。但是我在&lt;a class="link" href="https://enccs.github.io/intermediate-mpi/one-sided-routines/#window-creation" target="_blank" rel="noopener"
&gt;其他教程&lt;/a&gt;可以看到代码中同时在&lt;code&gt;size&lt;/code&gt; 和 &lt;code&gt;disp_unit&lt;/code&gt; 中使用了 &lt;code&gt;sizeof(type)&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;不同进程创建的窗口在大小上可能是不同的，但是同一块内存可能映射到不同的窗口上。对重叠窗口的并发通信可能有未知的结果。&lt;/p&gt;
&lt;p&gt;一个窗口可以在进程里的任意一块内存上被创建，但是，如果使用&lt;code&gt;MPI_ALLOC_MEM&lt;/code&gt;来分配内存的性能表现会更好，在一些系统上使用字节对齐的内存也会有更好的性能。&lt;/p&gt;
&lt;h3 id="mpi_win_allocate"&gt;MPI_WIN_ALLOCATE
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;MPI_WIN_ALLOCATE(size, disp_unit, info, comm, baseptr, win)&lt;/p&gt;
&lt;p&gt;IN size size of window in bytes (non-negative integer)&lt;/p&gt;
&lt;p&gt;IN disp_unit local unit size for displacements, in bytes (positive integer)&lt;/p&gt;
&lt;p&gt;IN info info argument (handle)&lt;/p&gt;
&lt;p&gt;IN comm intra-communicator (handle)&lt;/p&gt;
&lt;p&gt;OUT baseptr initial address of window (choice)&lt;/p&gt;
&lt;p&gt;OUT win window object (handle)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;size&lt;/code&gt; 为0依旧是有效的。&lt;/p&gt;
&lt;p&gt;对于&lt;code&gt;MPI_ALLOC_MEM&lt;/code&gt; 和 &lt;code&gt;MPI_FREE_MEM&lt;/code&gt; 的准则也对这个函数有效。（这里的准则指的是这块内存你需要手动释放，并且&lt;code&gt;baseptr&lt;/code&gt;的类型是&lt;code&gt;*void&lt;/code&gt;）。&lt;/p&gt;
&lt;p&gt;可以在&lt;code&gt;info&lt;/code&gt;中设置内存对齐参数。&lt;/p&gt;
&lt;h3 id="mpi_win_allocate_shared"&gt;MPI_WIN_ALLOCATE_SHARED
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;MPI_WIN_ALLOCATE_SHARED(size, disp_unit, info, comm, baseptr, win)&lt;/p&gt;
&lt;p&gt;IN
size
size of local window in bytes (non-negative integer)&lt;/p&gt;
&lt;p&gt;IN
disp_unit
local unit size for displacements, in bytes (positive
integer)&lt;/p&gt;
&lt;p&gt;IN
info
info argument (handle)&lt;/p&gt;
&lt;p&gt;IN
comm
intra-communicator (handle)&lt;/p&gt;
&lt;p&gt;OUT
baseptr
address of local allocated window segment (choice)&lt;/p&gt;
&lt;p&gt;OUT
win
window object (handle)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这里分配的内存是连续的并且是根据内存的秩（rank）排的，除非你在&lt;code&gt;info&lt;/code&gt;里指定了&lt;code&gt;alloc_shared_noncontig&lt;/code&gt;。如果你指定了这个参数，那么库会优化共享内存碎片的布局，可能会优化性能。&lt;/p&gt;
&lt;p&gt;如果使用了连续内存，那么只有第一个进程的内存会被对齐。如果没用，那么每一个进程的内存都会被对齐。&lt;/p&gt;
&lt;h2 id="通信"&gt;通信
&lt;/h2&gt;&lt;p&gt;所有的通信函数都是非阻塞的。&lt;/p&gt;
&lt;p&gt;当源进程调用了一个同步过程或一个刷新过程时，操作结束。基于请求的操作会在源进程使用测试或等待（test or wait 我也不知道这是啥）过程时完成。&lt;/p&gt;
&lt;p&gt;对于本地通信缓冲区的RMA操作只有在上一个操作结束后才会开始。&lt;/p&gt;
&lt;p&gt;对于同一块内存的读写冲突会带来位置后果。但是同时的累加操作会顺利进行就好像他们是有序的一样。&lt;/p&gt;
&lt;p&gt;你可以将&lt;code&gt;MPI_PROC_NULL&lt;/code&gt;作为目标，但是依旧会用同步方法来关闭这个时期（epoch）&lt;/p&gt;
&lt;h2 id="内存模型"&gt;内存模型
&lt;/h2&gt;&lt;p&gt;在理解内存模型前，先提出两个概念：公有内存和私有内存。我们假设公有内存是所有进程都可以访问的内存，容量大。私有内存是每个进程独有的内存，访问快。对于不同的机器，这两块内存可能是一致的，也可能不是。一致的内存布局允许我们直接更新公有内存。而不一致的内存需要额外的RMA操作来更新公有内存。因此针对这两种情况，MPI提出了两种内存模型，分别为&lt;strong&gt;RMA unified&lt;/strong&gt;和&lt;strong&gt;RMA separate&lt;/strong&gt;，可以通过&lt;code&gt;MPI_WIN_MODEL&lt;/code&gt;来设置。&lt;/p&gt;
&lt;h3 id="separate-model"&gt;separate model
&lt;/h3&gt;&lt;p&gt;在这种模型中，每个变量在进程内存里都只有一个实例，但是对于每个窗口而言都有多个公有备份。对于本地内存的更新操作会影响到其他窗口的公有备份。对于私有备份的更新操作也会影响到进程内存。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.1.png"
width="872"
height="552"
srcset="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.1_hu_75950ab0631c44ff.png 480w, https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.1_hu_a85944c912ac9a04.png 1024w"
loading="lazy"
alt="seprate model"
class="gallery-image"
data-flex-grow="157"
data-flex-basis="379px"
&gt;&lt;/p&gt;
&lt;h3 id="unified-model"&gt;unified model
&lt;/h3&gt;&lt;p&gt;私有和公有拷贝是相同的，不需要额外的RMA操作，允许用户忽略一些同步调用并隐形的提高性能。&lt;/p&gt;
&lt;p&gt;需要架构上的支持。&lt;/p&gt;
&lt;h2 id="同步"&gt;同步
&lt;/h2&gt;&lt;p&gt;RMA模型把通信分为了两种类型，如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;active target communication&lt;/strong&gt; 直译就是积极通信，在这种通信模式下，源进程和目标进程都会显式参与通信，通信方法分别为&lt;code&gt;fence&lt;/code&gt; 和 &lt;code&gt;SPCW&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;passive target communication&lt;/strong&gt; 消极通信，这种模式下只有源进程会显示的参与通信，通信方法为&lt;code&gt;lock&lt;/code&gt; 和 &lt;code&gt;lock_all&lt;/code&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="时期epoch"&gt;时期（epoch）
&lt;/h3&gt;&lt;p&gt;在介绍同步之前，先介绍时期这个概念。RMA模型中所有的通信操作都必须在一个时期中进行。需要目标进程通过同步操作来暴露时期（exposure epoch）和源进程也需要一个同步操作来访问时期（access epoch）。&lt;/p&gt;
&lt;h3 id="pscwpost-start-complete-wait"&gt;PSCW(Post-Start-Complete-Wait)
&lt;/h3&gt;&lt;p&gt;PSCW分别是四个不同的操作，目标进程使用Post的操作等价于打开一个暴露时期，而Wait等价于关闭这个暴露时期。源进程的Start则是打开一个访问时期，Complete 为关闭访问时期。
其具体流程用标准的一张图即可解释：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.2.png"
width="920"
height="839"
srcset="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.2_hu_d99f38c506ce9c9d.png 480w, https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.2_hu_8fe1fd5a75583b05.png 1024w"
loading="lazy"
alt="12.2"
class="gallery-image"
data-flex-grow="109"
data-flex-basis="263px"
&gt;&lt;/p&gt;
&lt;p&gt;这种post必须在start前，wait必须在complete后的模式称之为强同步（strong synchronization）。但是强同步一般太理想化，所以如果不遵循这个顺序的情况，称此为弱同步（weak synchronization）。如下图&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.3.png"
width="914"
height="729"
srcset="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.3_hu_52c16686ab1de9b6.png 480w, https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.3_hu_c3274dbbceac6eea.png 1024w"
loading="lazy"
alt="12.3"
class="gallery-image"
data-flex-grow="125"
data-flex-basis="300px"
&gt;&lt;/p&gt;
&lt;p&gt;MPI允许弱同步模式。&lt;/p&gt;
&lt;h3 id="fence"&gt;Fence
&lt;/h3&gt;&lt;p&gt;如果是在BSP范式下，编写PSCW显然十分封锁，但是我们还有另一个法宝——Fence！其差别和对比也可以用一张图来很好的表示（出自一位大牛的paper）&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/5.png"
width="1249"
height="435"
srcset="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/5_hu_98a6b87af336df14.png 480w, https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/5_hu_2a8d92a6d65355c0.png 1024w"
loading="lazy"
alt="5"
class="gallery-image"
data-flex-grow="287"
data-flex-basis="689px"
&gt;&lt;/p&gt;
&lt;h3 id="lock"&gt;Lock
&lt;/h3&gt;&lt;p&gt;这里的锁和我们一般在多线程中的锁很像，但是lock操作等同于打开一个时期，并不会建立一个临界区！锁分为排他的（exculsive）和共享的（shared）。排他锁同时之会允许一个进程访问，而共享锁允许其他持有共享锁的进程访问目标进程。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.4.png"
width="912"
height="908"
srcset="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.4_hu_edd053ebf4480177.png 480w, https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/12.4_hu_587a3637c8484a22.png 1024w"
loading="lazy"
alt="12.4"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="241px"
&gt;&lt;/p&gt;
&lt;p&gt;注意，两个源进程的顺序是不确定的！&lt;/p&gt;
&lt;p&gt;如果使用锁，那么在时期内的所有RMA操作只会在解锁的时候完成，所以RMA在提供锁的同时，也提供了Flush操作，用来同步用。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/6.png"
width="1212"
height="443"
srcset="https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/6_hu_8688fee7a87193f6.png 480w, https://woodman3.github.io/p/mpi%E7%9A%84rma%E6%9C%BA%E5%88%B6%E7%AC%94%E8%AE%B0/6_hu_c9892e7265bb1fc1.png 1024w"
loading="lazy"
alt="6"
class="gallery-image"
data-flex-grow="273"
data-flex-basis="656px"
&gt;&lt;/p&gt;
&lt;h2 id="参考"&gt;参考
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a class="link" href="https://htor.inf.ethz.ch/publications/img/MPI_RMA_and_advanced_MPI.pdf" target="_blank" rel="noopener"
&gt;eth_pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://enccs.github.io/intermediate-mpi/one-sided-routines/" target="_blank" rel="noopener"
&gt;enccs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://htor.inf.ethz.ch/publications/img/mpi3-rma-overview-and-model.pdf" target="_blank" rel="noopener"
&gt;paper&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://wgropp.cs.illinois.edu/courses/cs598-s16/lectures/lecture34.pdf" target="_blank" rel="noopener"
&gt;wgropp.34&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://wgropp.cs.illinois.edu/courses/cs598-s16/lectures/lecture35.pdf" target="_blank" rel="noopener"
&gt;wgropp.35&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://www.mpi-forum.org/docs/mpi-4.1/mpi41-report.pdf" target="_blank" rel="noopener"
&gt;mpi-standard&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>自定义MPI的错误处理函数</title><link>https://woodman3.github.io/p/%E8%87%AA%E5%AE%9A%E4%B9%89mpi%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/</link><pubDate>Tue, 25 Jun 2024 15:24:09 +0800</pubDate><guid>https://woodman3.github.io/p/%E8%87%AA%E5%AE%9A%E4%B9%89mpi%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/</guid><description>&lt;img src="https://woodman3.github.io/p/%E8%87%AA%E5%AE%9A%E4%B9%89mpi%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/119764162_p0.png" alt="Featured image of post 自定义MPI的错误处理函数" /&gt;&lt;p&gt;MPI的标准中认为标准规定的数据的传输都是可靠传输，不需要规定如何处理错误，有些实现可能会有不可靠传输机制，错误的处理就由具体的实现来处理。但是各种由于其他方面引起的错误依旧客观存在，所以标准中依旧规定了一些错误码的种类并且允许用户自己实现错误处理。&lt;/p&gt;
&lt;p&gt;前排提醒，文中的所以函数只是标准中约定的函数，实际需要调用的函数根据所使用的语言可能有所不同，请以标准和实现为准。&lt;/p&gt;
&lt;h2 id="error-handing"&gt;Error Handing
&lt;/h2&gt;&lt;p&gt;MPI中用户可自定义的错误处理函数可以分为四种类型，分别为&lt;code&gt;Communicator&lt;/code&gt; &lt;code&gt;Windows&lt;/code&gt; &lt;code&gt;Files&lt;/code&gt; &lt;code&gt;Sessions&lt;/code&gt;。其错误发生的操作和所调用的函数之间的关系如下：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://woodman3.github.io/p/%E8%87%AA%E5%AE%9A%E4%B9%89mpi%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/MPI_Error_invoke.png"
width="1069"
height="700"
srcset="https://woodman3.github.io/p/%E8%87%AA%E5%AE%9A%E4%B9%89mpi%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/MPI_Error_invoke_hu_c1ebeecb0d36e33e.png 480w, https://woodman3.github.io/p/%E8%87%AA%E5%AE%9A%E4%B9%89mpi%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/MPI_Error_invoke_hu_53cefd5498dd62c4.png 1024w"
loading="lazy"
alt="hander_invoke"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="366px"
&gt;&lt;/p&gt;
&lt;p&gt;MPI还提供了三种错误处理函数，如下&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;MPI_ERRORS_ARE_FATAL&lt;/strong&gt; 调用它会终止所有的进程，等效于一个有着所有进程的通讯器调用MPI_ABORT，且MPI_ABORT的错误码都是由实现指定的。（这里可能读起来有点拗口，但是笔者不太会翻译英语长句，可以参考具体标准文档）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MPI_ERRORS_ABORT&lt;/strong&gt; 如果在Session内调用，之会在本地进程内终止。在其他情况下会终止其相关通信器的进程。其错误码也是由具体实现指定。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MPI_ERRORS_RETURN&lt;/strong&gt; 返回错误码，但是不做其他事。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;实现一般会提供其他错误处理函数。但是在一般情况下，&lt;code&gt;MPI_ERRORS_ARE_FATAL&lt;/code&gt;是默认的错误处理函数。&lt;/p&gt;
&lt;p&gt;用户可以使用 &lt;code&gt;MPI_XXX_CREATE_ERRHANDLER&lt;/code&gt; &lt;code&gt;MPI_XXX_SET_ERRHANDLER&lt;/code&gt; &lt;code&gt;MPI_XXX_GET_ERRHANDLER&lt;/code&gt; &lt;code&gt;MPI_XXX_FREE_ERRHANDLER&lt;/code&gt; 来创建、设置、获取和释放回调函数，其中 &lt;code&gt;XXX&lt;/code&gt; 为&lt;code&gt;COMM&lt;/code&gt; &lt;code&gt;WIN&lt;/code&gt; &lt;code&gt;FILE&lt;/code&gt; 或 &lt;code&gt;SESSION&lt;/code&gt;。值得注意的是，回调函数在MPI里是一个不透明对象，对于用户而言是不可见的，只能用句柄来访问。&lt;/p&gt;
&lt;h2 id="error-code-and-class"&gt;Error code and class
&lt;/h2&gt;&lt;p&gt;有关错误码具体含义完全由具体实现来决定，除了&lt;code&gt;MPI_SUCCESS&lt;/code&gt;，他的值默认为0，含义显而易见。&lt;/p&gt;
&lt;p&gt;尽管标准没有给出具体的错误码，但是便准由一系列错误类（Error Class），规定了不同种类的错误。或者说，错误类就是最基础的错误码。一个错误码可能属于不同的错误类，可以使用 &lt;code&gt;MPI_ERROR_CLASS&lt;/code&gt; 来把错误码和错误类关联起来。所以错误码需要遵循以下约束：&lt;/p&gt;
$$
0 = MPI\_SUCCESS &lt; MPI\_T\_ERR\_XXX \leq MPI\_ERR\_LASTCODE
$$&lt;h2 id="如何做呢"&gt;如何做呢
&lt;/h2&gt;&lt;p&gt;那么在MPI中处理错误，我们已经有了一个清晰的路线：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;自己定义一个错误类。&lt;/li&gt;
&lt;li&gt;把你想要错误码和错误类关联起来。&lt;/li&gt;
&lt;li&gt;给你的错误吗添加描述。&lt;/li&gt;
&lt;li&gt;移除联系（标准是这么写的，移除啥联系标准也没说，我认为是默认的错误处理函数与你定义的通信器之间的联系）&lt;/li&gt;
&lt;li&gt;使用你自己的错误处理函数。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="参考"&gt;参考
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://www.mpi-forum.org/docs/mpi-4.1/mpi41-report.pdf" target="_blank" rel="noopener"
&gt;mpi-standard&lt;/a&gt;&lt;/p&gt;</description></item><item><title>MPI4.1标准的一些相关术语</title><link>https://woodman3.github.io/p/mpi4.1%E6%A0%87%E5%87%86%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD/</link><pubDate>Mon, 24 Jun 2024 10:44:44 +0800</pubDate><guid>https://woodman3.github.io/p/mpi4.1%E6%A0%87%E5%87%86%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD/</guid><description>&lt;img src="https://woodman3.github.io/p/mpi4.1%E6%A0%87%E5%87%86%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD/119071465_p0.png" alt="Featured image of post MPI4.1标准的一些相关术语" /&gt;&lt;h2 id="程序规范"&gt;程序规范
&lt;/h2&gt;&lt;p&gt;在标准中对于参数的说明有三种类型，如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;IN&lt;/strong&gt; 仅使用但不更新&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;OUT&lt;/strong&gt; 仅更新但不使用&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;INOUT&lt;/strong&gt; 皆有&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这个说明仅仅是只是告诉你参数会被如何使用，但是并不会强制落实到具体的实现上。&lt;/p&gt;
&lt;p&gt;在这先提一嘴，MPI中有一类不透明类型，被称之为&lt;code&gt;opaque type&lt;/code&gt;。指的是无法被用户直接访问，只能通过句柄访问，其大小和形状对用户不可见的类型，如&lt;code&gt;groups&lt;/code&gt; &lt;code&gt;datatypes&lt;/code&gt; &lt;code&gt;communicators&lt;/code&gt;等。如果一个不透明类型被作为参数，那么他的参数说明为OUT或INOUT，哪怕其句柄并未被更新。&lt;/p&gt;
&lt;p&gt;如果一个参数在一个进程中为IN，但是在另一个线程中为OUT，那么他的类型说明为INOUT。&lt;/p&gt;
&lt;p&gt;如果参数说明为OUT或INOUT，那么这个参数不能有其他别名（或者说其他指针？），如标准指出以下程序是不被允许的。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;copyIntBuffer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;pin&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;pout&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;pout&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;pin&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nf"&gt;copyIntBuffer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="c1"&gt;// it is forbidden
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="术语"&gt;术语
&lt;/h2&gt;&lt;p&gt;在标准中，&lt;code&gt;message data bufferr&lt;/code&gt;为进程中接受者或收发者的缓冲区，&lt;code&gt;file data buffer&lt;/code&gt;为MPI的I/O程序建立的缓冲区，&lt;code&gt;data buffer&lt;/code&gt;的语义为两者之一，具体情况具体分析。&lt;/p&gt;
&lt;h3 id="mpi操作mpi-operation"&gt;MPI操作（MPI Operation）
&lt;/h3&gt;&lt;p&gt;一个MPI操作是由MPI库函数所构成的一系列数据传输或同步操作，由四个步骤组成。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;初始化（Initialization）接受参数表但不会动缓冲区里数据。&lt;/li&gt;
&lt;li&gt;启动（starting）接受缓冲区的控制权。注意，一般初始操作（initiation）包括了前两个步骤。&lt;/li&gt;
&lt;li&gt;完成（Completion）返回缓冲区的控制权并告知参数已经更新完成。注意，一个MPI操作只有在实行了这个阶段才能算完成（complete）。&lt;/li&gt;
&lt;li&gt;释放（Freeing）返回剩下参数表的控制权。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;MPI操作分为形式，分别为阻塞（Blocking），非阻塞（Nonblocking）和持久（Persistent），区别如下：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;阻塞操作&lt;/strong&gt;：四个阶段全在一个过程调用（Procedure call）里。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;非阻塞操作&lt;/strong&gt;：前两个阶段在一个非阻塞过程调用里，而后两个阶段在另一个阻塞或非阻塞的过程调用里。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;持久操作&lt;/strong&gt;：每个阶段都在一个单独的过程里，过程为阻塞或非阻塞。
划开一个发送操作，在开始阶段结束时会有一个额外的调用来启动每一部分的接收者缓存。
划开一个接收操作，在操作结束前会允许用户访问接受缓存来确认数据是否正确接受。（这一部分有些怪，但是标准文档就是这么写的）&lt;/p&gt;
&lt;p&gt;开始阶段也被称为激活阶段（active），初始化和完全阶段也被称为失活阶段（inactive，我不知道如何翻译，姑且就这么叫好了）。&lt;/p&gt;
&lt;p&gt;激活通信和I/O操作也被称之为挂起（pending）操作，注意到一个挂起操作可以是一个开始但还没完成的持久或非阻塞操作，抑或是一个还未完成的阻塞操作（比如一个正在等待信息的接受操作）&lt;/p&gt;
&lt;p&gt;从另一个角度，操作也可以分为群体通信或非群体通信&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;群体操作&lt;/strong&gt;：一个群中的一个进程或一群进程而言，操作会也可能不会在群的所有进程开始前完成（挺拗口）。可能是阻塞、非阻塞或持久操作。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;非群体操作&lt;/strong&gt;：上述的补集。&lt;/p&gt;
&lt;p&gt;有时一个操作在需要其他相关操作启动了才可以完成，比如一个接收操作需要发送操作启动了才能完成。这个现象被称之为使能（enabled）。但是有些mpi的实现会把使能优化，让一个操作在使能前就完成了。&lt;/p&gt;
&lt;p&gt;有些操作是先验使能（pirori enabled）的，比如一个缓存发送操作不需要接受操作启动即可完成。&lt;/p&gt;
&lt;p&gt;一旦一个操作是使能的，那么这个操作必须完成。一个操作可能在启动阶段前就已经是使能的了。比如接收操作。&lt;/p&gt;
&lt;p&gt;使能的要求是不对称的，一个操作可能需要他所有相关的操作都完成了启动，但是自己却不一定需要启动。&lt;/p&gt;
&lt;h3 id="mpi过程mpi-procedure"&gt;MPI过程（MPI Procedure)
&lt;/h3&gt;&lt;p&gt;过程也可以分为两种，如下所示：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;非本地（Nonlocal）&lt;/strong&gt;：过程需要其他相关的过程在另一个进程中被调用才能返回，那么称之为非本地的。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;本地（Local）&lt;/strong&gt;：上述补集&lt;/p&gt;
&lt;h2 id="参考"&gt;参考
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://www.mpi-forum.org/docs/mpi-4.1/mpi41-report.pdf" target="_blank" rel="noopener"
&gt;mpi-standard&lt;/a&gt;&lt;/p&gt;</description></item><item><title>std::excution介绍及其在nvidia gpu中的使用</title><link>https://woodman3.github.io/p/stdexcution%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%85%B6%E5%9C%A8nvidia-gpu%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/</link><pubDate>Sun, 23 Jun 2024 19:46:35 +0800</pubDate><guid>https://woodman3.github.io/p/stdexcution%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%85%B6%E5%9C%A8nvidia-gpu%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/</guid><description>&lt;img src="https://woodman3.github.io/p/stdexcution%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%85%B6%E5%9C%A8nvidia-gpu%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/119683453_p0.jpg" alt="Featured image of post std::excution介绍及其在nvidia gpu中的使用" /&gt;&lt;h1 id="文前"&gt;文前
&lt;/h1&gt;&lt;p&gt;老板叫我去查查标准库离有没有类似openmp那种并行方法，在查阅了相关资料后冰箱老板汇报后，这个方法并没有被采用。我把在此期间所查的资料整理于此作为知识备份，以便日后查阅使用。&lt;/p&gt;
&lt;p&gt;值得一提的是，笔者并没有实际编写或执行过相应的代码，所以本文仅供参考，一切以实际为准。如有错误，烦请指出。&lt;/p&gt;
&lt;h1 id="标准库"&gt;标准库
&lt;/h1&gt;&lt;p&gt;在cpp17中，标准库中增加了&lt;code&gt;std::execution&lt;/code&gt;，并引入了执行策略（&lt;code&gt;execution_policy&lt;/code&gt;），粗略来说，一些执行策略可以使一部分算法和循环操作并行运行并自动向量化。以下为四种执行策略类型（最后一种是cpp20引入的）&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;std::execution::sequenced_policy&lt;/code&gt;
最基本的串行策略，不表。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;std::execution::parallel_policy&lt;/code&gt;
并行策略，类似openmp的并行化操作，值得一提的是，线程的执行顺序是不确定的。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;std::execution::parallel_unsequenced_policy&lt;/code&gt;
同上，但是明确指出了循环顺序不确定，指示编译器可以向量化。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;std::execution::unsequenced_policy&lt;/code&gt;
不会进行并行操作，但是指示编译器可以向量化&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果使用并行化策略，那么线程安全是由程序员自己负责的。&lt;/p&gt;
&lt;p&gt;值得一提的是，我们传入算法的执行策略并不是一个类型，而是一个实例，标准库并没有告诉我们如何创建一个实例，只是提供了以上四种类型所对应的实例，如下所示。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;std::execution::seq&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;std::execution::par&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;std::execution::par_unseq&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;std::execution::unseq&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果想使用执行策略，常见的话可以在&lt;code&gt;for_each&lt;/code&gt;和&lt;code&gt;for_each_n&lt;/code&gt;中的第一个参数中传入执行策略。如果你需要规约和扫描操作，可以在&lt;code&gt;reduce&lt;/code&gt;和&lt;code&gt;inclusive_scan&lt;/code&gt;中使用即可。事实上，大部分&lt;a class="link" href="https://zh.cppreference.com/w/cpp/header/algorithm" target="_blank" rel="noopener"
&gt;algorithm&lt;/a&gt;中和&lt;a class="link" href="https://zh.cppreference.com/w/cpp/header/numeric" target="_blank" rel="noopener"
&gt;numeric&lt;/a&gt;的算法都是允许传入执行策略的。&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://zh.cppreference.com/w/cpp/algorithm/execution_policy_tag" target="_blank" rel="noopener"
&gt;cppreference&lt;/a&gt;中暗示以后可能会有更丰富的策略（比如&lt;code&gt;std::parallel::cuda&lt;/code&gt; 和 &lt;code&gt;std::parallel::opencl&lt;/code&gt;）。但是笔者对此抱有怀疑态度。&lt;/p&gt;
&lt;p&gt;涉及到执行策略的两篇主要提案，分别是&lt;a class="link" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2300r9.html#design-schedulers" target="_blank" rel="noopener"
&gt;P2300R9&lt;/a&gt;和&lt;a class="link" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/p0443r14.html" target="_blank" rel="noopener"
&gt;P0443R14&lt;/a&gt;。其中前者是对后者更近一步的意见。笔者想在其中找到关于如何管理调度策略和管理并行资源的更近一步的资料，由于时间关系，我只看了前一篇，但奈何是在太长太长，而且其中大部分都是在谈&lt;code&gt;sender&lt;/code&gt;和&lt;code&gt;recevier&lt;/code&gt;机制，和老板要求没啥关系，而提案中关于我想要的部分仅仅只有一&lt;a class="link" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2300r9.html#design-schedulers" target="_blank" rel="noopener"
&gt;小部分&lt;/a&gt;,没有更进一步的尝试，所以我只能就此作罢。&lt;/p&gt;
&lt;h1 id="gpu上并行"&gt;gpu上并行
&lt;/h1&gt;&lt;p&gt;那么标准库里的方法可不可以把线程放进gpu中执行呢，就像opanacc那样？答案是可以的，但是目前笔者查到的相关资料仅限于nvidia的gpu，至于另外两家我就不知道了。想要在gpu上并行可以使用nvidia的nvc++编译器，在编译选项中加上&lt;code&gt;-stdpar&lt;/code&gt;即可，编译器会自动完成其中的操作。其中要注意的点如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;只支持前三种策略，其中使用第一种不会进行并行化。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;主机和设备之间的数据移动是自动进行的，但是移动方式又有两种方式，分别为Managed Memory Mode和Unified Memory Mode，具体区别可以参考&lt;a class="link" href="https://docs.nvidia.com/hpc-sdk/archive/24.5/compilers/hpc-compilers-user-guide/index.html#acc-mem-unified" target="_blank" rel="noopener"
&gt;这里&lt;/a&gt;，粗略来说，前者是由程序手动完成数据移动，而后者是硬件上有一块cpu和gpu都可以访问的内存。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果你不想引入额外的数据传输开销，就不要在&lt;a class="link" href="https://developer.nvidia.com/blog/multi-gpu-programming-with-standard-parallel-c-part-2/#do_not_touch_data_on_the_cpu" target="_blank" rel="noopener"
&gt;cpu部分的代码碰数据&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果想要多卡运算，需要与MPI结合&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;申请内存是不需要&lt;code&gt;__device__&lt;/code&gt;之类的指示符的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;尽管使用正常编写cpp方式来分配内存就好了，但是如果想要更快的效率，可以考虑使用&lt;a class="link" href="https://developer.nvidia.com/blog/multi-gpu-programming-with-standard-parallel-c-part-2/#communicate_through_pinned_memory" target="_blank" rel="noopener"
&gt;pinned memory&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果使用Managed Memory Mode的话，循环内只能访问在堆上分配的内存，而不能访问在栈上分配的内存（全局变量也不可以）。因此&lt;code&gt;std::vector&lt;/code&gt;中的元素可以被访问，但是&lt;code&gt;std::array&lt;/code&gt;中的反而不行。Unified Memory Mode则没有这种限制。具体差别&lt;a class="link" href="https://docs.nvidia.com/hpc-sdk/archive/24.5/compilers/hpc-compilers-user-guide/index.html#stdpar-cpp-unified-memory" target="_blank" rel="noopener"
&gt;在这&lt;/a&gt;，总体来说，推荐后一种方式。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;不能传入函数指针，只能传入lambda表达式，因为使用函数指针调用函数时会传入一个多态object，会调用虚表。（这里我也很疑惑，但是官网就是这么&lt;a class="link" href="https://docs.nvidia.com/hpc-sdk/archive/24.5/compilers/hpc-compilers-user-guide/index.html#stdpar-cpp-function-pointers" target="_blank" rel="noopener"
&gt;写的&lt;/a&gt;）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;计算能力由编译器自动指定。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;除此之位，nvc++还支持不少很新的东西，比如多维数组，线性函数库，或者自己实现一个sender和receiver，可以在文档中查看。&lt;/p&gt;
&lt;h1 id="参考"&gt;参考
&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class="link" href="https://en.cppreference.com/w/cpp/header/execution" target="_blank" rel="noopener"
&gt;cppreference&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class="link" href="https://docs.nvidia.com/hpc-sdk/archive/24.5/compilers/hpc-compilers-user-guide/index.html#stdpar-use" target="_blank" rel="noopener"
&gt;nvc++ pragram guide&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class="link" href="https://developer.nvidia.com/blog/multi-gpu-programming-with-standard-parallel-c-part-2/" target="_blank" rel="noopener"
&gt;nvidia blog&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>What Remains of Edith Finch——游戏里的百年孤独</title><link>https://woodman3.github.io/p/what-remains-of-edith-finch%E6%B8%B8%E6%88%8F%E9%87%8C%E7%9A%84%E7%99%BE%E5%B9%B4%E5%AD%A4%E7%8B%AC/</link><pubDate>Fri, 31 May 2024 22:58:55 +0800</pubDate><guid>https://woodman3.github.io/p/what-remains-of-edith-finch%E6%B8%B8%E6%88%8F%E9%87%8C%E7%9A%84%E7%99%BE%E5%B9%B4%E5%AD%A4%E7%8B%AC/</guid><description>&lt;img src="https://woodman3.github.io/p/what-remains-of-edith-finch%E6%B8%B8%E6%88%8F%E9%87%8C%E7%9A%84%E7%99%BE%E5%B9%B4%E5%AD%A4%E7%8B%AC/119019483_p0.jpg" alt="Featured image of post What Remains of Edith Finch——游戏里的百年孤独" /&gt;&lt;p&gt;《What Remains of Edith Finch》这款游戏的剧情时间很短，大概两个小时出头，游戏没有任何解密和收集要素（除了一些成就）。但是就是这短短两个小时的剧情，让这个游戏被誉为游戏界的《百年孤独》。这个称呼对于这款游戏可以说是当之无愧的。两个小时里Finch家族四代人的故事给人留下的震撼让人惊呼第九艺术。&lt;/p&gt;
&lt;p&gt;Finch家族的存在的一个诅咒，这个家族的每一个人似乎都无法寿终正寝，游戏就围绕着这个家族成员的死亡展开。游戏以倒叙的视角，从家族的最后一个人回到家族的屋子里开始，讲述家族的跨越了四代人的故事。&lt;/p&gt;
&lt;p&gt;每个人离去的方式千奇百怪，而描绘的方式也有时比较隐晦：有的人在饥饿的幻想中死去、有的人进入了自己画中的世界失踪，有的人在凿开了地下室的墙后被火车撞死，有的人在自己想象中的王国里走向了断头台。甚至游戏里叙事的主体——也没有明确的死法。&lt;/p&gt;
&lt;p&gt;游戏的剧情在完整的同时，把几乎所有的游玩时间的充分的利用起来。游戏只有行走而没有奔跑，这个设计很好，因为这个游戏几乎没有任何赶路的环节，一条路走到底没有回头路。家族的历史在玩家在老屋行走的过程中从主角的回忆中缓缓流出，极为流畅。在这一点上甚至也和《百年孤独》类似——没有一句废话。&lt;/p&gt;
&lt;p&gt;在游戏的末尾，家族的最后一个人立在自己母亲的坟前，为她献花。家族的每一个人在出生时就修好了墓碑，除了他，他可以打破这个诅咒吗？游戏没有给出结果。&lt;/p&gt;</description></item><item><title>关于python调用动态库获取字符串这件事</title><link>https://woodman3.github.io/p/%E5%85%B3%E4%BA%8Epython%E8%B0%83%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%99%E4%BB%B6%E4%BA%8B/</link><pubDate>Sat, 25 May 2024 18:04:54 +0800</pubDate><guid>https://woodman3.github.io/p/%E5%85%B3%E4%BA%8Epython%E8%B0%83%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%99%E4%BB%B6%E4%BA%8B/</guid><description>&lt;img src="https://woodman3.github.io/p/%E5%85%B3%E4%BA%8Epython%E8%B0%83%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%99%E4%BB%B6%E4%BA%8B/ug0nba.jfif" alt="Featured image of post 关于python调用动态库获取字符串这件事" /&gt;&lt;h1 id="问题的提出"&gt;问题的提出
&lt;/h1&gt;&lt;p&gt;假设我们的动态库代码如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nf"&gt;new_str&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="nf"&gt;malloc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nf"&gt;strcpy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nf"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;str: %p&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;使用如下命令编译&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;gcc -fPIC -shared -o libtest.so test.c
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;我们可以很轻松的写出（有一点危险）的调用方法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ctypes&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;lib&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;CDLL&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;./libtest.so&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new_str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;restype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;c_char_p&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new_str&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;我们十分顺利的获得了字符串！但是注意到，我们的字符串是分配在堆上的，这个字符串是什么时候被释放掉的呢？
我做了一个小实验，在一个死循环里不断的获取字符串，不一会儿这个小小的python程序的内存占用就到达了100%，看上去这些内存并没有释放。于是我们编写一个对应的释放函数&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;free_str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nf"&gt;free&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;在我试图把指针传回给动态库的时候，我注意到&lt;code&gt;data&lt;/code&gt;的类型是&lt;code&gt;bytes&lt;/code&gt;，也就是说如果你就这么调用如下代码的话&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;free_str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;是会报错的。事实上，哪怕你不指定函数的返回类型，或者指定返回类型为&lt;code&gt;c_void_p&lt;/code&gt;，你都无法把这个指针传给动态库。
&lt;code&gt;ctypes&lt;/code&gt;在调用动态库的时候，默认会把动态库方法的返回类型设置为&lt;code&gt;int&lt;/code&gt;如果你把这个整形打印出来和动态库那边的指针作比较，你会发现这两个的值完全不同。&lt;/p&gt;
&lt;h1 id="解决方法"&gt;解决方法
&lt;/h1&gt;&lt;p&gt;把动态库的放回类型设置为&lt;code&gt;POINTER(c_char)&lt;/code&gt;即可，代码如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ctypes&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;lib&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;CDLL&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;./libtest.so&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new_str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;restype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;POINTER&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c_char&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new_str&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cast&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c_char_p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;free_str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;运行后发现内存占用没有增长，说明内存被成功释放。&lt;/p&gt;</description></item><item><title>关于如何在windows下打开摄像头这件事</title><link>https://woodman3.github.io/p/%E5%85%B3%E4%BA%8E%E5%A6%82%E4%BD%95%E5%9C%A8windows%E4%B8%8B%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%99%E4%BB%B6%E4%BA%8B/</link><pubDate>Sat, 18 May 2024 21:48:53 +0800</pubDate><guid>https://woodman3.github.io/p/%E5%85%B3%E4%BA%8E%E5%A6%82%E4%BD%95%E5%9C%A8windows%E4%B8%8B%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%99%E4%BB%B6%E4%BA%8B/</guid><description>&lt;img src="https://woodman3.github.io/p/%E5%85%B3%E4%BA%8E%E5%A6%82%E4%BD%95%E5%9C%A8windows%E4%B8%8B%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%99%E4%BB%B6%E4%BA%8B/118584014_p0.png" alt="Featured image of post 关于如何在windows下打开摄像头这件事" /&gt;&lt;h1 id="起因"&gt;起因
&lt;/h1&gt;&lt;p&gt;在下girl band cry种子的时候发现字幕组推荐使用mpv播放器，了解到mpv+anime4k之后，忽然觉得正在用的potplayer似乎没那么香了。在准备投入mpv的怀抱之前，还有最后一件事需要解决：potplayer除了用了播放视频之外，我还用它来采集视频，比如ns的游戏画面。那么，mpv也可以用来采集游戏视频吗？&lt;/p&gt;
&lt;p&gt;在此之前，我不是没有试过别的采集方案。我分别用obs player和vlc来采集视频，但是这两种方案都有相同的缺点——延迟非常大。于是我也只能继续用potplayer，mpv会不一样吗？&lt;/p&gt;
&lt;h1 id="potplayer采集的缺点"&gt;potplayer采集的缺点
&lt;/h1&gt;&lt;p&gt;potplayer采集的视频延迟不大，但是如果声音延迟会逐渐变大，而且会有不少杂音。所以我一直都不会有potplayer去采集音频，而是直接在windows的声音设置的麦克风里开启侦听选项，延迟会小不少。&lt;/p&gt;
&lt;h1 id="摄像头"&gt;摄像头
&lt;/h1&gt;&lt;p&gt;采集视频时，选项里既有笔记本自带的摄像头，也有采集卡。所以我认为打开摄像头和打开采集卡本质上是一回事，所以我起了这么一个标题。在linux上打开摄像头十分简单，arch wiki对此有详细的&lt;a class="link" href="https://wiki.archlinux.org/title/webcam_setup" target="_blank" rel="noopener"
&gt;介绍&lt;/a&gt;，在此就不说了。然而很不幸的是我使用的是windows，wsl里也没有我的摄像头。那么如何在windows下打开摄像头呢？&lt;/p&gt;
&lt;p&gt;最常见的方法是使用windows自带的相机应用，延迟也低。但是这种方法无法全屏，很是遗憾。&lt;/p&gt;
&lt;h1 id="设备名"&gt;设备名
&lt;/h1&gt;&lt;p&gt;不同于linux可以直接在&lt;code&gt;\dev\&lt;/code&gt;下查看设备名，windows下可以在设备管理器来查看设备名，也可以用ffmpeg来查看。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-powershell" data-lang="powershell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;ffmpeg&lt;/span&gt; &lt;span class="n"&gt;-list_devices&lt;/span&gt; &lt;span class="n"&gt;true&lt;/span&gt; &lt;span class="o"&gt;-f&lt;/span&gt; &lt;span class="n"&gt;dshow&lt;/span&gt; &lt;span class="n"&gt;-i&lt;/span&gt; &lt;span class="n"&gt;dummy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id="mpv-和-mpvnet"&gt;mpv 和 mpv.net
&lt;/h1&gt;&lt;p&gt;我并没有直接使用mpv，而是使用mpv.net。我在mpv.net打开选项里没有看到设备，但是可以使用命令行打开摄像头。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-powershell" data-lang="powershell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;mpvnet&lt;/span&gt; &lt;span class="n"&gt;av&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="p"&gt;//&lt;/span&gt;&lt;span class="n"&gt;dshow&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;Integrated Camera&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;遗憾的是，这样打开后的视频延迟也非常慢，我怀疑mpv打开会好一些，mpv打开的命令类似：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-powershell" data-lang="powershell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;mpv&lt;/span&gt; &lt;span class="n"&gt;av&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="p"&gt;//&lt;/span&gt;&lt;span class="n"&gt;dshow&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;Integrated Camera&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;打开的延迟也很大，远远不如potplayer。&lt;/p&gt;
&lt;h1 id="ffplay"&gt;ffplay
&lt;/h1&gt;&lt;p&gt;但是我在这过程中发现了另一个延迟不大的方法，那就是装ffmpag时附带的ffplay来打开摄像头&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-powershell" data-lang="powershell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;ffplay&lt;/span&gt; &lt;span class="o"&gt;-f&lt;/span&gt; &lt;span class="n"&gt;dshow&lt;/span&gt; &lt;span class="n"&gt;-i&lt;/span&gt; &lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;Integrated Camera&amp;#34;&lt;/span&gt; &lt;span class="n"&gt;-fs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;-fs&lt;/code&gt;是全屏显示用的，如无必要也可以去掉&lt;/p&gt;</description></item><item><title>族长的秋天——别了，马尔克斯</title><link>https://woodman3.github.io/p/%E6%97%8F%E9%95%BF%E7%9A%84%E7%A7%8B%E5%A4%A9%E5%88%AB%E4%BA%86%E9%A9%AC%E5%B0%94%E5%85%8B%E6%96%AF/</link><pubDate>Mon, 13 May 2024 21:20:14 +0800</pubDate><guid>https://woodman3.github.io/p/%E6%97%8F%E9%95%BF%E7%9A%84%E7%A7%8B%E5%A4%A9%E5%88%AB%E4%BA%86%E9%A9%AC%E5%B0%94%E5%85%8B%E6%96%AF/</guid><description>&lt;img src="https://woodman3.github.io/p/%E6%97%8F%E9%95%BF%E7%9A%84%E7%A7%8B%E5%A4%A9%E5%88%AB%E4%BA%86%E9%A9%AC%E5%B0%94%E5%85%8B%E6%96%AF/118504369_p0.jpg" alt="Featured image of post 族长的秋天——别了，马尔克斯" /&gt;&lt;p&gt;​ 我是在五月二号的晚上读完这本书的，在大多数人都望而生畏的《百年孤独》面前，《族长的秋天》更加晦涩难懂。我读了十几页才忽然发现这十几页全在一个自然段里，书中每一个段都大概有30页长，全书总共6个自然段。一个自然段几乎没几个句号。大量的长句有时让我怀疑自己在做考研英语的阅读理解，尽管我看的是中文。书中有时候会在三种人称之间切换，让人看不明白主语到底时谁，这给阅读造成了极大的困难。与大部分现代小说一样，书中几乎没有一句多余的描写，马尔克斯诗歌一般的语句让写小说的人越读越害怕。有几句让我想起了《红辣椒》中里发了疯的人们，我很喜欢这种像是疯子写出来的语句。&lt;/p&gt;
&lt;p&gt;​ 书中的族长——也就是那个独裁者，在最踏上军旅的起初，为的只是看海。后来他把自己的总统府修在了一个可以随时看到加勒比海，然而在故事的结尾，加勒比海却被卖给了外国人，不可谓让人感到讽刺。故事的开头，也就是在族长的视角中，自己是一位令人爱戴的领袖，也许直到他死时他也这么认为。这种印象在他找到自己的替身时逐渐破碎，而在他把自己的兄弟烹饪时，一个残暴的暴君形象就开始从这段充斥着鲜血的文字中溢出了。&lt;/p&gt;
&lt;p&gt;​ 马尔克斯的小说我读的也不算少了，最开始接触的《百年孤独》，后面读的《霍乱时期的爱情》，也许是在中间又也许是在后来读的《没有人给他写信的上校》、《枯枝败叶》。《百年孤独》我一开始买来纯粹是觉得这本书的书名很有意思，彼时我对于魔幻现实主义和马尔克斯毫无了解。在翻了十几页后，还在初中的我被书中的长人名和极高的信息量整的头晕脑花。于是此书在很长的一段时间被我束之高阁。不知多久过后的一天，我因无聊便从书架上取本书来看，这一取便取到了蒙灰已久的《百年孤独》。然后我着魔似的在两天内看完了这本书，那个被暴雨淹没的马孔多从此在我的内心留下了无法磨灭的痕迹。&lt;/p&gt;
&lt;p&gt;​ 于《百年孤独》相比，《霍乱时期的爱情》也是一本优秀的小说，但是就给我内心留下的震撼而言，并没有《百年孤独》那么大，也许是因为后者并不是魔幻现实主义小说的缘故。唯一令我印象深刻只有结尾一生一世罢了。而其他两本，《上校》被我的一位初中同学借走，直到今天他也没有还我。《枯枝败叶》是我在高中时看的，只记得有一段把光比喻成猛兽的描写被我抄了下来。这两部书的情节我完全没有印象了。&lt;/p&gt;
&lt;p&gt;​ 马尔克斯笔下的许多人物，族长，奥雷利亚诺，那个一直在追寻自己初恋的小伙子，都是孤独的。族长的孤独和奥雷利亚诺很像，就如奥雷利亚诺回到马孔多时时刻划着一个连自己母亲都不的入内的圈，族长的孤独也是由他自己造成的，他从来没信任过任何人，包括自己的母亲。直到他在自己最后一次锁上自己屋内的三道门阀，死在自己的屋中时。只有母鸡和秃鹰找到了他。&lt;/p&gt;
&lt;p&gt;​ 最后再说回《族长的秋天》，我是在s1的论坛上听说了这本小说，论坛上的人认为这本书是马尔克斯的巅峰之作。就语言艺术上，这本书可以说是登峰造极。在魔幻现实上，这本书也高出了《百年孤独》一截。但是不知为何，那种一口气读完的怅然若失之感，在读完这本书后并没有。也许是年纪大了，再也无法静下心来读书罢。在读这本书时，我考研的复试失败了，也没有选择调剂。想着一边找工作一边二战。在看面经的时候对于生活非常迷茫。读到最后，我已经失去了耐心。只想着快快读完，好像在刷题一样看书。读完的第二天，我的舍友凌晨三点爬起来要去海边看海，我在四点的时候也去了，自己一个人。我到了海边才问舍友他们在哪，然后赶过去和他们会合。在海边等待着日出时，我想起了书中的族长，他对于海洋的迷恋只出现了寥寥几次，但是却比其他特征更加让人印象深刻。一个暴君，喜欢看海？哈哈。&lt;/p&gt;
&lt;p&gt;​ 这应该是我看的最后一本马尔克斯的小说吧，别了，马尔克斯。&lt;/p&gt;
&lt;p&gt;​&lt;/p&gt;</description></item><item><title>cublas的gemv踩坑</title><link>https://woodman3.github.io/p/cublas%E7%9A%84gemv%E8%B8%A9%E5%9D%91/</link><pubDate>Mon, 13 May 2024 18:57:13 +0800</pubDate><guid>https://woodman3.github.io/p/cublas%E7%9A%84gemv%E8%B8%A9%E5%9D%91/</guid><description>&lt;img src="https://woodman3.github.io/p/cublas%E7%9A%84gemv%E8%B8%A9%E5%9D%91/112545261_p0.png" alt="Featured image of post cublas的gemv踩坑" /&gt;&lt;p&gt;gemv是我接触的第一个cublas function，然而由于cublas中矩阵是按列保存的，所以对于一个$ m*n$的按行保存的矩阵$A$，调用的正确姿势是&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;cublasSgemv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;handle&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;CUBLAS_OP_T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;beta&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可能是按列储存的原因，cublas的gemv效率相比于自己手写的kernel低不少，但是自己手写的kernel和cublas的可能有一定的精度差异&lt;/p&gt;</description></item></channel></rss>